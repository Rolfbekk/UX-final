(()=>{var e={};e.id=414,e.ids=[414],e.modules={694:(e,t,s)=>{"use strict";var n,r,i,a,o,l,c,u,h,d,p,f,m,g,y,w,b,_,v,x,A,S,I,$,E,O,k,R,T,P,N,C,M,L,j,D,U,W,B,q,F,H,z,X,J,K,V,Y,Z,G,Q,ee,et,es,en,er,ei,ea,eo,el,ec,eu,eh,ed,ep,ef,em,eg,ey,ew,eb,e_,ev,ex,eA,eS;let eI,e$,eE,eO;function ek(e,t,s,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function eR(e,t,s,n){if("a"===s&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}s.d(t,{Ay:()=>ns});let eT=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return eT=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^s()&15>>+e/4).toString(16))};function eP(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eN=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eC extends Error{}class eM extends eC{constructor(e,t,s,n){super(`${eM.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new ej({message:s,cause:eN(t)});let r=t?.error;return 400===e?new eU(e,r,s,n):401===e?new eW(e,r,s,n):403===e?new eB(e,r,s,n):404===e?new eq(e,r,s,n):409===e?new eF(e,r,s,n):422===e?new eH(e,r,s,n):429===e?new ez(e,r,s,n):e>=500?new eX(e,r,s,n):new eM(e,r,s,n)}}class eL extends eM{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class ej extends eM{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eD extends ej{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eU extends eM{}class eW extends eM{}class eB extends eM{}class eq extends eM{}class eF extends eM{}class eH extends eM{}class ez extends eM{}class eX extends eM{}class eJ extends eC{constructor(){super("Could not parse response content as the length limit was reached")}}class eK extends eC{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class eV extends Error{constructor(e){super(e)}}let eY=/^[a-z][a-z0-9+.-]*:/i,eZ=e=>eY.test(e),eG=e=>(eG=Array.isArray)(e),eQ=eG;function e0(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let e1=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eC(`${e} must be an integer`);if(t<0)throw new eC(`${e} must be a positive integer`);return t},e2=e=>{try{return JSON.parse(e)}catch(e){return}},e3=e=>new Promise(t=>setTimeout(t,e)),e4="5.8.3",e6=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,e8=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e4,"X-Stainless-OS":e9(Deno.build.os),"X-Stainless-Arch":e5(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e4,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e4,"X-Stainless-OS":e9(globalThis.process.platform??"unknown"),"X-Stainless-Arch":e5(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,n=s[2]||0,r=s[3]||0;return{browser:e,version:`${t}.${n}.${r}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e4,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e4,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},e5=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",e9=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",e7=()=>eI??(eI=e8());function te(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function tt(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return te({start(){},async pull(e){let{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function ts(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function tn(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let tr=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),ti="RFC3986",ta=e=>String(e),to={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:ta},tl=(e,t)=>(tl=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),tc=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function tu(e,t){if(eG(e)){let s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}let th={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},td=function(e,t){Array.prototype.push.apply(e,eG(t)?t:[t])},tp={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=tc[n];continue}if(n<2048){s[s.length]=tc[192|n>>6]+tc[128|63&n];continue}if(n<55296||n>=57344){s[s.length]=tc[224|n>>12]+tc[128|n>>6&63]+tc[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=tc[240|n>>18]+tc[128|n>>12&63]+tc[128|n>>6&63]+tc[128|63&n]}a+=s.join("")}return a},encodeValuesOnly:!1,format:ti,formatter:ta,indices:!1,serializeDate:e=>(e$??(e$=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},tf={};function tm(e){let t;return(eE??(eE=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tg(e){let t;return(eO??(eO=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class ty{constructor(){n.set(this,void 0),r.set(this,void 0),ek(this,n,new Uint8Array,"f"),ek(this,r,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tm(e):e;ek(this,n,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),n=0;for(let t of e)s.set(t,n),n+=t.length;return s}([eR(this,n,"f"),s]),"f");let i=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eR(this,n,"f"),eR(this,r,"f")));){if(t.carriage&&null==eR(this,r,"f")){ek(this,r,t.index,"f");continue}if(null!=eR(this,r,"f")&&(t.index!==eR(this,r,"f")+1||t.carriage)){i.push(tg(eR(this,n,"f").subarray(0,eR(this,r,"f")-1))),ek(this,n,eR(this,n,"f").subarray(eR(this,r,"f")),"f"),ek(this,r,null,"f");continue}let e=null!==eR(this,r,"f")?t.preceding-1:t.preceding,s=tg(eR(this,n,"f").subarray(0,e));i.push(s),ek(this,n,eR(this,n,"f").subarray(t.index),"f"),ek(this,r,null,"f")}return i}flush(){return eR(this,n,"f").length?this.decode("\n"):[]}}n=new WeakMap,r=new WeakMap,ty.NEWLINE_CHARS=new Set(["\n","\r"]),ty.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let tw={off:0,error:200,warn:300,info:400,debug:500},tb=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(tw,e))return e;tS(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(tw))}`)}};function t_(){}function tv(e,t,s){return!t||tw[e]>tw[s]?t_:t[e].bind(t)}let tx={error:t_,warn:t_,info:t_,debug:t_},tA=new WeakMap;function tS(e){let t=e.logger,s=e.logLevel??"off";if(!t)return tx;let n=tA.get(t);if(n&&n[0]===s)return n[1];let r={error:tv("error",t,s),warn:tv("warn",t,s),info:tv("info",t,s),debug:tv("debug",t,s)};return tA.set(t,[s,r]),r}let tI=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class t${constructor(e,t,s){this.iterator=e,i.set(this,void 0),this.controller=t,ek(this,i,s,"f")}static fromSSEResponse(e,t,s){let n=!1,r=s?tS(s):console;async function*i(){if(n)throw new eC("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(let n of tE(e,t))if(!s){if(n.data.startsWith("[DONE]")){s=!0;continue}if(null===n.event||n.event.startsWith("response.")||n.event.startsWith("transcript.")){let t;try{t=JSON.parse(n.data)}catch(e){throw r.error("Could not parse message into JSON:",n.data),r.error("From chunk:",n.raw),e}if(t&&t.error)throw new eM(void 0,t.error,void 0,e.headers);yield t}else{let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new eM(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}}s=!0}catch(e){if(eP(e))return;throw e}finally{s||t.abort()}}return new t$(i,t,s)}static fromReadableStream(e,t,s){let n=!1;async function*r(){let t=new ty;for await(let s of ts(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new t$(async function*(){if(n)throw new eC("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let e=!1;try{for await(let t of r())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(eP(e))return;throw e}finally{e||t.abort()}},t,s)}[(i=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new t$(()=>n(e),this.controller,eR(this,i,"f")),new t$(()=>n(t),this.controller,eR(this,i,"f"))]}toReadableStream(){let e;let t=this;return te({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:n}=await e.next();if(n)return t.close();let r=tm(JSON.stringify(s)+"\n");t.enqueue(r)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*tE(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eC("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eC("Attempted to iterate over a response with no body")}let s=new tk,n=new ty;for await(let t of tO(ts(e.body)))for(let e of n.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of n.flush()){let t=s.decode(e);t&&(yield t)}}async function*tO(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?tm(s):s,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tk{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){let s=e.indexOf(":");return -1!==s?[e.substring(0,s),t,e.substring(s+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function tR(e,t){let{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(tS(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller,e):t$.fromSSEResponse(s,t.controller,e);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?tT(await s.json(),s):await s.text()})();return tS(e).debug(`[${n}] response parsed`,tI({retryOfRequestLogID:r,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function tT(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class tP extends Promise{constructor(e,t,s=tR){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,a.set(this,void 0),ek(this,a,e,"f")}_thenUnwrap(e){return new tP(eR(this,a,"f"),this.responsePromise,async(t,s)=>tT(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eR(this,a,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}a=new WeakMap;class tN{constructor(e,t,s,n){o.set(this,void 0),ek(this,o,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eC("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eR(this,o,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(o=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tC extends tP{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tR(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tM extends tN{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tL extends tN{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var e;let t=this.getPaginatedItems(),s=t[t.length-1]?.id;return s?{...this.options,query:{..."object"!=typeof(e=this.options.query)?{}:e??{},after:s}}:null}}let tj=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tD(e,t,s){return tj(),new File(e,t??"unknown_file",s)}function tU(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tW=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tB=async(e,t)=>({...e,body:await tF(e.body,t)}),tq=new WeakMap,tF=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tq.get(t);if(s)return s;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tq.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>tJ(s,e,t))),s},tH=e=>e instanceof Blob&&"name"in e,tz=e=>"object"==typeof e&&null!==e&&(e instanceof Response||tW(e)||tH(e)),tX=e=>{if(tz(e))return!0;if(Array.isArray(e))return e.some(tX);if(e&&"object"==typeof e){for(let t in e)if(tX(e[t]))return!0}return!1},tJ=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,tD([await s.blob()],tU(s)));else if(tW(s))e.append(t,tD([await new Response(tt(s)).blob()],tU(s)));else if(tH(s))e.append(t,s,tU(s));else if(Array.isArray(s))await Promise.all(s.map(s=>tJ(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>tJ(e,`${t}[${s}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},tK=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,tV=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&tK(e),tY=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function tZ(e,t,s){if(tj(),tV(e=await e))return e instanceof File?e:tD([await e.arrayBuffer()],e.name);if(tY(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tD(await tG(n),t,s)}let n=await tG(e);if(t||(t=tU(e)),!s?.type){let e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tD(n,t,s)}async function tG(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tK(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tW(e))for await(let s of e)t.push(...await tG(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class tQ{constructor(e){this._client=e}}function t0(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let t1=Object.freeze(Object.create(null)),t2=((e=t0)=>function(t,...s){let n;if(1===t.length)return t[0];let r=!1,i=[],a=t.reduce((t,n,a)=>{/[?#]/.test(n)&&(r=!0);let o=s[a],l=(r?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??t1)??t1)?.toString)&&(l=o+"",i.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+n+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(o));)i.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new eC(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(t0);class t3 extends tQ{list(e,t={},s){return this._client.getAPIList(t2`/chat/completions/${e}/messages`,tL,{query:t,...s})}}let t4=e=>e?.role==="assistant",t6=e=>e?.role==="tool";class t8{constructor(){l.add(this),this.controller=new AbortController,c.set(this,void 0),u.set(this,()=>{}),h.set(this,()=>{}),d.set(this,void 0),p.set(this,()=>{}),f.set(this,()=>{}),m.set(this,{}),g.set(this,!1),y.set(this,!1),w.set(this,!1),b.set(this,!1),ek(this,c,new Promise((e,t)=>{ek(this,u,e,"f"),ek(this,h,t,"f")}),"f"),ek(this,d,new Promise((e,t)=>{ek(this,p,e,"f"),ek(this,f,t,"f")}),"f"),eR(this,c,"f").catch(()=>{}),eR(this,d,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},eR(this,l,"m",_).bind(this))},0)}_connected(){this.ended||(eR(this,u,"f").call(this),this._emit("connect"))}get ended(){return eR(this,g,"f")}get errored(){return eR(this,y,"f")}get aborted(){return eR(this,w,"f")}abort(){this.controller.abort()}on(e,t){return(eR(this,m,"f")[e]||(eR(this,m,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eR(this,m,"f")[e];if(!s)return this;let n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(eR(this,m,"f")[e]||(eR(this,m,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{ek(this,b,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){ek(this,b,!0,"f"),await eR(this,d,"f")}_emit(e,...t){if(eR(this,g,"f"))return;"end"===e&&(ek(this,g,!0,"f"),eR(this,p,"f").call(this));let s=eR(this,m,"f")[e];if(s&&(eR(this,m,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eR(this,b,"f")||s?.length||Promise.reject(e),eR(this,h,"f").call(this,e),eR(this,f,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eR(this,b,"f")||s?.length||Promise.reject(e),eR(this,h,"f").call(this,e),eR(this,f,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function t5(e){return e?.$brand==="auto-parseable-response-format"}function t9(e){return e?.$brand==="auto-parseable-tool"}function t7(e,t){let s=e.choices.map(e=>{var s,n;if("length"===e.finish_reason)throw new eJ;if("content_filter"===e.finish_reason)throw new eK;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let s=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:t9(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=t,n=e.message.content,s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(n):JSON.parse(n):null):null}}});return{...e,choices:s}}function se(e){return!!t5(e.response_format)||(e.tools?.some(e=>t9(e)||"function"===e.type&&!0===e.function.strict)??!1)}c=new WeakMap,u=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,b=new WeakMap,l=new WeakSet,_=function(e){if(ek(this,y,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new eL),e instanceof eL)return ek(this,w,!0,"f"),this._emit("abort",e);if(e instanceof eC)return this._emit("error",e);if(e instanceof Error){let t=new eC(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eC(String(e)))};class st extends t8{constructor(){super(...arguments),v.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),t6(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(t4(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eC("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eR(this,v,"m",x).call(this)}async finalMessage(){return await this.done(),eR(this,v,"m",A).call(this)}async finalFunctionToolCall(){return await this.done(),eR(this,v,"m",S).call(this)}async finalFunctionToolCallResult(){return await this.done(),eR(this,v,"m",I).call(this)}async totalUsage(){return await this.done(),eR(this,v,"m",$).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=eR(this,v,"m",A).call(this);t&&this._emit("finalMessage",t);let s=eR(this,v,"m",x).call(this);s&&this._emit("finalContent",s);let n=eR(this,v,"m",S).call(this);n&&this._emit("finalFunctionToolCall",n);let r=eR(this,v,"m",I).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eR(this,v,"m",$).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eR(this,v,"m",E).call(this,t);let r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(t7(r,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:r="auto",stream:i,...a}=t,o="string"!=typeof r&&r?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(t9(e)){if(!e.$callback)throw new eC("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);let h="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:r,tools:h,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new eC("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:r,arguments:i}=e.function,a=u[r];if(a){if(o&&o!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}try{t="function"==typeof a.parse?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:s,content:e});continue}let l=await a.function(t,this),c=eR(this,v,"m",O).call(this,l);if(this._addMessage({role:n,tool_call_id:s,content:c}),o)return}}}}v=new WeakSet,x=function(){return eR(this,v,"m",A).call(this).content??null},A=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(t4(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eC("stream ended without producing a ChatCompletionMessage with role=assistant")},S=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t4(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},I=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t6(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},$=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},E=function(e){if(null!=e.n&&e.n>1)throw new eC("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},O=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class ss extends st{static runTools(e,t,s){let n=new ss,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}_addMessage(e,t=!0){super._addMessage(e,t),t4(e)&&e.content&&this._emit("content",e.content)}}let sn={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class sr extends Error{}class si extends Error{}let sa=(e,t)=>{let s=e.length,n=0,r=e=>{throw new sr(`${e} at position ${n}`)},i=e=>{throw new si(`${e} at position ${n}`)},a=()=>(h(),n>=s&&r("Unexpected end of input"),'"'===e[n])?o():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||sn.NULL&t&&s-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||sn.BOOL&t&&s-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||sn.BOOL&t&&s-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||sn.INFINITY&t&&s-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||sn.MINUS_INFINITY&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||sn.NAN&t&&s-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u(),o=()=>{let a=n,o=!1;for(n++;n<s&&('"'!==e[n]||o&&"\\"===e[n-1]);)o="\\"===e[n]&&!o,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(a,++n-Number(o)))}catch(e){i(String(e))}else if(sn.STR&t)try{return JSON.parse(e.substring(a,n-Number(o))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,h();let i={};try{for(;"}"!==e[n];){if(h(),n>=s&&sn.OBJ&t)return i;let r=o();h(),n++;try{let e=a();Object.defineProperty(i,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(sn.OBJ&t)return i;throw e}h(),","===e[n]&&n++}}catch(e){if(sn.OBJ&t)return i;r("Expected '}' at end of object")}return n++,i},c=()=>{n++;let s=[];try{for(;"]"!==e[n];)s.push(a()),h(),","===e[n]&&n++}catch(e){if(sn.ARR&t)return s;r("Expected ']' at end of array")}return n++,s},u=()=>{if(0===n){"-"===e&&sn.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(sn.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}i(String(s))}}let a=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=s||sn.NUM&t||r("Unterminated number literal");try{return JSON.parse(e.substring(a,n))}catch(s){"-"===e.substring(a,n)&&sn.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){i(String(e))}}},h=()=>{for(;n<s&&" \n\r	".includes(e[n]);)n++};return a()},so=e=>(function(e,t=sn.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return sa(e.trim(),t)})(e,sn.ALL^sn.NUM);class sl extends st{constructor(e){super(),k.add(this),R.set(this,void 0),T.set(this,void 0),P.set(this,void 0),ek(this,R,e,"f"),ek(this,T,[],"f")}get currentChatCompletionSnapshot(){return eR(this,P,"f")}static fromReadableStream(e){let t=new sl(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new sl(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eR(this,k,"m",N).call(this);let r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),r))eR(this,k,"m",M).call(this,e);if(r.controller.signal?.aborted)throw new eL;return this._addChatCompletion(eR(this,k,"m",D).call(this))}async _fromReadableStream(e,t){let s;let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eR(this,k,"m",N).call(this),this._connected();let r=t$.fromReadableStream(e,this.controller);for await(let e of r)s&&s!==e.id&&this._addChatCompletion(eR(this,k,"m",D).call(this)),eR(this,k,"m",M).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new eL;return this._addChatCompletion(eR(this,k,"m",D).call(this))}[(R=new WeakMap,T=new WeakMap,P=new WeakMap,k=new WeakSet,N=function(){this.ended||ek(this,P,void 0,"f")},C=function(e){let t=eR(this,T,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},eR(this,T,"f")[e.index]=t),t},M=function(e){if(this.ended)return;let t=eR(this,k,"m",W).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=eR(this,k,"m",C).call(this,e);for(let t of(e.finish_reason&&(eR(this,k,"m",j).call(this,e),null!=n.current_tool_call_index&&eR(this,k,"m",L).call(this,e,n.current_tool_call_index)),s.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(eR(this,k,"m",j).call(this,e),null!=n.current_tool_call_index&&eR(this,k,"m",L).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):s?.type)}}},L=function(e,t){if(eR(this,k,"m",C).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=eR(this,R,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:t9(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},j=function(e){let t=eR(this,k,"m",C).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=eR(this,k,"m",U).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},D=function(){if(this.ended)throw new eC("stream has ended, this shouldn't happen");let e=eR(this,P,"f");if(!e)throw new eC("request ended without sending any chunks");return ek(this,P,void 0,"f"),ek(this,T,[],"f"),function(e,t){var s;let{id:n,choices:r,created:i,model:a,system_fingerprint:o,...l}=e;return s={...l,id:n,choices:r.map(({message:t,finish_reason:s,index:n,logprobs:r,...i})=>{if(!s)throw new eC(`missing finish_reason for choice ${n}`);let{content:a=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new eC(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eC(`missing function_call.arguments for choice ${n}`);if(!l)throw new eC(`missing function_call.name for choice ${n}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...i,index:n,finish_reason:s,logprobs:r,message:{...c,role:u,content:a,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:r,type:i,id:a,...o}=t,{arguments:l,name:c,...u}=r||{};if(null==a)throw new eC(`missing choices[${n}].tool_calls[${s}].id
${sc(e)}`);if(null==i)throw new eC(`missing choices[${n}].tool_calls[${s}].type
${sc(e)}`);if(null==c)throw new eC(`missing choices[${n}].tool_calls[${s}].function.name
${sc(e)}`);if(null==l)throw new eC(`missing choices[${n}].tool_calls[${s}].function.arguments
${sc(e)}`);return{...o,id:a,type:i,function:{...u,name:c,arguments:l}}})}}:{...i,message:{...c,content:a,role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&se(t)?t7(s,t):{...s,choices:s.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,eR(this,R,"f"))},U=function(){let e=eR(this,R,"f")?.response_format;return t5(e)?e:null},W=function(e){var t,s,n,r;let i=eR(this,P,"f"),{choices:a,...o}=e;for(let{delta:a,finish_reason:l,index:c,logprobs:u=null,...h}of(i?Object.assign(i,o):i=ek(this,P,{...o,choices:[]},"f"),e.choices)){let e=i.choices[c];if(e||(e=i.choices[c]={finish_reason:l,index:c,message:{},logprobs:u,...h}),u){if(e.logprobs){let{content:n,refusal:r,...i}=u;Object.assign(e.logprobs,i),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},u)}if(l&&(e.finish_reason=l,eR(this,R,"f")&&se(eR(this,R,"f")))){if("length"===l)throw new eJ;if("content_filter"===l)throw new eK}if(Object.assign(e,h),!a)continue;let{content:o,refusal:d,function_call:p,role:f,tool_calls:m,...g}=a;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&eR(this,k,"m",U).call(this)&&(e.message.parsed=so(e.message.content))),m)for(let{index:t,id:s,type:n,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,a),s&&(o.id=s),n&&(o.type=n),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e)return!1;let s=e.tools?.find(e=>e.function?.name===t.function.name);return t9(s)||s?.function.strict||!1}(eR(this,R,"f"),o)&&(o.function.parsed_arguments=so(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new t$(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sc(e){return JSON.stringify(e)}class su extends sl{static fromReadableStream(e){let t=new su(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new su(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}}class sh extends tQ{constructor(){super(...arguments),this.messages=new t3(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(t2`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(t2`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",tL,{query:e,...t})}delete(e,t){return this._client.delete(t2`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(let t of e??[]){if("function"!==t.type)throw new eC(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eC(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>t7(t,e))}runTools(e,t){return e.stream?su.runTools(this._client,e,t):ss.runTools(this._client,e,t)}stream(e,t){return sl.createChatCompletion(this._client,e,t)}}sh.Messages=t3;class sd extends tQ{constructor(){super(...arguments),this.completions=new sh(this._client)}}sd.Completions=sh;let sp=Symbol("brand.privateNullableHeaders"),sf=e=>{let t=new Headers,s=new Set;for(let n of e){let e=new Set;for(let[r,i]of function*(e){let t;if(!e)return;if(sp in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let n of(e instanceof Headers?t=e.entries():eQ(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=eQ(n[1])?n[1]:[n[1]],r=!1;for(let n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}(n)){let n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===i?(t.delete(r),s.add(n)):(t.append(r,i),s.delete(n))}}return{[sp]:!0,values:t,nulls:s}};class sm extends tQ{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:sf([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class sg extends tQ{create(e,t){return this._client.post("/audio/transcriptions",tB({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class sy extends tQ{create(e,t){return this._client.post("/audio/translations",tB({body:e,...t,__metadata:{model:e.model}},this._client))}}class sw extends tQ{constructor(){super(...arguments),this.transcriptions=new sg(this._client),this.translations=new sy(this._client),this.speech=new sm(this._client)}}sw.Transcriptions=sg,sw.Translations=sy,sw.Speech=sm;class sb extends tQ{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(t2`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",tL,{query:e,...t})}cancel(e,t){return this._client.post(t2`/batches/${e}/cancel`,t)}}class s_ extends tQ{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t2`/assistants/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t2`/assistants/${e}`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",tL,{query:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(t2`/assistants/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sv extends tQ{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sx extends tQ{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sA extends tQ{constructor(){super(...arguments),this.sessions=new sv(this._client),this.transcriptionSessions=new sx(this._client)}}sA.Sessions=sv,sA.TranscriptionSessions=sx;class sS extends tQ{create(e,t,s){return this._client.post(t2`/threads/${e}/messages`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(t2`/threads/${n}/messages/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t2`/threads/${n}/messages/${e}`,{body:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t2`/threads/${e}/messages`,tL,{query:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete(t2`/threads/${n}/messages/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sI extends tQ{retrieve(e,t,s){let{thread_id:n,run_id:r,...i}=t;return this._client.get(t2`/threads/${n}/runs/${r}/steps/${e}`,{query:i,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...r}=t;return this._client.getAPIList(t2`/threads/${n}/runs/${e}/steps`,tL,{query:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let s$=e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}},sE=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class sO extends t8{constructor(){super(...arguments),B.add(this),F.set(this,[]),H.set(this,{}),z.set(this,{}),X.set(this,void 0),J.set(this,void 0),K.set(this,void 0),V.set(this,void 0),Y.set(this,void 0),Z.set(this,void 0),G.set(this,void 0),Q.set(this,void 0),ee.set(this,void 0)}[(F=new WeakMap,H=new WeakMap,z=new WeakMap,X=new WeakMap,J=new WeakMap,K=new WeakMap,V=new WeakMap,Y=new WeakMap,Z=new WeakMap,G=new WeakMap,Q=new WeakMap,ee=new WeakMap,B=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new q;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=t$.fromReadableStream(e,this.controller);for await(let e of n)eR(this,B,"m",et).call(this,e);if(n.controller.signal?.aborted)throw new eL;return this._addRun(eR(this,B,"m",es).call(this))}toReadableStream(){return new t$(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let r=new q;return r._run(()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.submitToolOutputs(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))eR(this,B,"m",et).call(this,e);if(a.controller.signal?.aborted)throw new eL;return this._addRun(eR(this,B,"m",es).call(this))}static createThreadAssistantStream(e,t,s){let n=new q;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let r=new q;return r._run(()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return eR(this,G,"f")}currentRun(){return eR(this,Q,"f")}currentMessageSnapshot(){return eR(this,X,"f")}currentRunStepSnapshot(){return eR(this,ee,"f")}async finalRunSteps(){return await this.done(),Object.values(eR(this,H,"f"))}async finalMessages(){return await this.done(),Object.values(eR(this,z,"f"))}async finalRun(){if(await this.done(),!eR(this,J,"f"))throw Error("Final run was not received.");return eR(this,J,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let r={...t,stream:!0},i=await e.createAndRun(r,{...s,signal:this.controller.signal});for await(let e of(this._connected(),i))eR(this,B,"m",et).call(this,e);if(i.controller.signal?.aborted)throw new eL;return this._addRun(eR(this,B,"m",es).call(this))}async _createAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.create(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))eR(this,B,"m",et).call(this,e);if(a.controller.signal?.aborted)throw new eL;return this._addRun(eR(this,B,"m",es).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(e0(t)&&e0(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!e0(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}q=sO,et=function(e){if(!this.ended)switch(ek(this,G,e,"f"),eR(this,B,"m",ei).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":eR(this,B,"m",ec).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eR(this,B,"m",er).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":eR(this,B,"m",en).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},es=function(){if(this.ended)throw new eC("stream has ended, this shouldn't happen");if(!eR(this,J,"f"))throw Error("Final run has not been received");return eR(this,J,"f")},en=function(e){let[t,s]=eR(this,B,"m",eo).call(this,e,eR(this,X,"f"));for(let e of(ek(this,X,t,"f"),eR(this,z,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=eR(this,K,"f")){if(eR(this,V,"f"))switch(eR(this,V,"f").type){case"text":this._emit("textDone",eR(this,V,"f").text,eR(this,X,"f"));break;case"image_file":this._emit("imageFileDone",eR(this,V,"f").image_file,eR(this,X,"f"))}ek(this,K,s.index,"f")}ek(this,V,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==eR(this,K,"f")){let t=e.data.content[eR(this,K,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,eR(this,X,"f"));break;case"text":this._emit("textDone",t.text,eR(this,X,"f"))}}eR(this,X,"f")&&this._emit("messageDone",e.data),ek(this,X,void 0,"f")}},er=function(e){let t=eR(this,B,"m",ea).call(this,e);switch(ek(this,ee,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==eR(this,Y,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(eR(this,Z,"f")&&this._emit("toolCallDone",eR(this,Z,"f")),ek(this,Y,e.index,"f"),ek(this,Z,t.step_details.tool_calls[e.index],"f"),eR(this,Z,"f")&&this._emit("toolCallCreated",eR(this,Z,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ek(this,ee,void 0,"f"),"tool_calls"==e.data.step_details.type&&eR(this,Z,"f")&&(this._emit("toolCallDone",eR(this,Z,"f")),ek(this,Z,void 0,"f")),this._emit("runStepDone",e.data,t)}},ei=function(e){eR(this,F,"f").push(e),this._emit("event",e)},ea=function(e){switch(e.event){case"thread.run.step.created":return eR(this,H,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=eR(this,H,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=q.accumulateDelta(t,s.delta);eR(this,H,"f")[e.data.id]=n}return eR(this,H,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":eR(this,H,"f")[e.data.id]=e.data}if(eR(this,H,"f")[e.data.id])return eR(this,H,"f")[e.data.id];throw Error("No snapshot available")},eo=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=eR(this,B,"m",el).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},el=function(e,t){return q.accumulateDelta(t,e)},ec=function(e){switch(ek(this,Q,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":ek(this,J,e.data,"f"),eR(this,Z,"f")&&(this._emit("toolCallDone",eR(this,Z,"f")),ek(this,Z,void 0,"f"))}};class sk extends tQ{constructor(){super(...arguments),this.steps=new sI(this._client)}create(e,t,s){let{include:n,...r}=t;return this._client.post(t2`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(t2`/threads/${n}/runs/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t2`/threads/${n}/runs/${e}`,{body:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t2`/threads/${e}/runs`,tL,{query:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post(t2`/threads/${n}/runs/${e}/cancel`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return sO.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=sf([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e3(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return sO.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t2`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return sO.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sk.Steps=sI;class sR extends tQ{constructor(){super(...arguments),this.runs=new sk(this._client),this.messages=new sS(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t2`/threads/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t2`/threads/${e}`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(t2`/threads/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return sO.createThreadAssistantStream(e,this._client.beta.threads,t)}}sR.Runs=sk,sR.Messages=sS;class sT extends tQ{constructor(){super(...arguments),this.realtime=new sA(this._client),this.assistants=new s_(this._client),this.threads=new sR(this._client)}}sT.Realtime=sA,sT.Assistants=s_,sT.Threads=sR;class sP extends tQ{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sN extends tQ{retrieve(e,t,s){let{container_id:n}=t;return this._client.get(t2`/containers/${n}/files/${e}/content`,{...s,headers:sf([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sC extends tQ{constructor(){super(...arguments),this.content=new sN(this._client)}create(e,t,s){return this._client.post(t2`/containers/${e}/files`,tB({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get(t2`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(t2`/containers/${e}/files`,tL,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete(t2`/containers/${n}/files/${e}`,{...s,headers:sf([{Accept:"*/*"},s?.headers])})}}sC.Content=sN;class sM extends tQ{constructor(){super(...arguments),this.files=new sC(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(t2`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",tL,{query:e,...t})}delete(e,t){return this._client.delete(t2`/containers/${e}`,{...t,headers:sf([{Accept:"*/*"},t?.headers])})}}sM.Files=sC;class sL extends tQ{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&tS(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(tS(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=s$(t)}),e)))}}class sj extends tQ{retrieve(e,t,s){let{eval_id:n,run_id:r}=t;return this._client.get(t2`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...r}=t;return this._client.getAPIList(t2`/evals/${n}/runs/${e}/output_items`,tL,{query:r,...s})}}class sD extends tQ{constructor(){super(...arguments),this.outputItems=new sj(this._client)}create(e,t,s){return this._client.post(t2`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get(t2`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(t2`/evals/${e}/runs`,tL,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete(t2`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post(t2`/evals/${n}/runs/${e}`,s)}}sD.OutputItems=sj;class sU extends tQ{constructor(){super(...arguments),this.runs=new sD(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(t2`/evals/${e}`,t)}update(e,t,s){return this._client.post(t2`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",tL,{query:e,...t})}delete(e,t){return this._client.delete(t2`/evals/${e}`,t)}}sU.Runs=sD;class sW extends tQ{create(e,t){return this._client.post("/files",tB({body:e,...t},this._client))}retrieve(e,t){return this._client.get(t2`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",tL,{query:e,...t})}delete(e,t){return this._client.delete(t2`/files/${e}`,t)}content(e,t){return this._client.get(t2`/files/${e}/content`,{...t,headers:sf([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let n=new Set(["processed","error","deleted"]),r=Date.now(),i=await this.retrieve(e);for(;!i.status||!n.has(i.status);)if(await e3(t),i=await this.retrieve(e),Date.now()-r>s)throw new eD({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class sB extends tQ{}class sq extends tQ{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class sF extends tQ{constructor(){super(...arguments),this.graders=new sq(this._client)}}sF.Graders=sq;class sH extends tQ{create(e,t,s){return this._client.getAPIList(t2`/fine_tuning/checkpoints/${e}/permissions`,tM,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(t2`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(t2`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}class sz extends tQ{constructor(){super(...arguments),this.permissions=new sH(this._client)}}sz.Permissions=sH;class sX extends tQ{list(e,t={},s){return this._client.getAPIList(t2`/fine_tuning/jobs/${e}/checkpoints`,tL,{query:t,...s})}}class sJ extends tQ{constructor(){super(...arguments),this.checkpoints=new sX(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(t2`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",tL,{query:e,...t})}cancel(e,t){return this._client.post(t2`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(t2`/fine_tuning/jobs/${e}/events`,tL,{query:t,...s})}pause(e,t){return this._client.post(t2`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(t2`/fine_tuning/jobs/${e}/resume`,t)}}sJ.Checkpoints=sX;class sK extends tQ{constructor(){super(...arguments),this.methods=new sB(this._client),this.jobs=new sJ(this._client),this.checkpoints=new sz(this._client),this.alpha=new sF(this._client)}}sK.Methods=sB,sK.Jobs=sJ,sK.Checkpoints=sz,sK.Alpha=sF;class sV extends tQ{}class sY extends tQ{constructor(){super(...arguments),this.graderModels=new sV(this._client)}}sY.GraderModels=sV;class sZ extends tQ{createVariation(e,t){return this._client.post("/images/variations",tB({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",tB({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class sG extends tQ{retrieve(e,t){return this._client.get(t2`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",tM,e)}delete(e,t){return this._client.delete(t2`/models/${e}`,t)}}class sQ extends tQ{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function s0(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){let s=function(e,t){return e.find(e=>"function"===e.type&&e.name===t)}(e.tools??[],t.name);return{...t,...t,parsed_arguments:function(e){return e?.$brand==="auto-parseable-tool"}(s)?s.$parseRaw(t.arguments):s?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s,n;return"output_text"===e.type?{...e,parsed:(s=t,n=e.text,s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(n):JSON.parse(n))}:e});return{...e,content:s}}return e}),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||s1(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function s1(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class s2 extends t8{constructor(e){super(),eu.add(this),eh.set(this,void 0),ed.set(this,void 0),ep.set(this,void 0),ek(this,eh,e,"f")}static createResponse(e,t,s){let n=new s2(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n;let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eR(this,eu,"m",ef).call(this);let i=null;for await(let r of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),n))eR(this,eu,"m",em).call(this,r,i);if(n.controller.signal?.aborted)throw new eL;return eR(this,eu,"m",eg).call(this)}[(eh=new WeakMap,ed=new WeakMap,ep=new WeakMap,eu=new WeakSet,ef=function(){this.ended||ek(this,ed,void 0,"f")},em=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=eR(this,eu,"m",ey).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new eC(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new eC(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new eC(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new eC(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},eg=function(){if(this.ended)throw new eC("stream has ended, this shouldn't happen");let e=eR(this,ed,"f");if(!e)throw new eC("request ended without sending any events");ek(this,ed,void 0,"f");let t=function(e,t){var s;return t&&(s=t,t5(s.text?.format))?s0(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,eR(this,eh,"f"));return ek(this,ep,t,"f"),t},ey=function(e){let t=eR(this,ed,"f");if(!t){if("response.created"!==e.type)throw new eC(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return ek(this,ed,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eC(`missing output at index ${e.output_index}`);"message"===s.type&&s.content.push(e.part);break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eC(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eC(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eC(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eC(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.completed":ek(this,ed,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=eR(this,ep,"f");if(!e)throw new eC("stream ended without producing a ChatCompletion");return e}}class s3 extends tQ{list(e,t={},s){return this._client.getAPIList(t2`/responses/${e}/input_items`,tL,{query:t,...s})}}class s4 extends tQ{constructor(){super(...arguments),this.inputItems=new s3(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s1(e),e))}retrieve(e,t={},s){return this._client.get(t2`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s1(e),e))}delete(e,t){return this._client.delete(t2`/responses/${e}`,{...t,headers:sf([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>s0(t,e))}stream(e,t){return s2.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(t2`/responses/${e}/cancel`,t)}}s4.InputItems=s3;class s6 extends tQ{create(e,t,s){return this._client.post(t2`/uploads/${e}/parts`,tB({body:t,...s},this._client))}}class s8 extends tQ{constructor(){super(...arguments),this.parts=new s6(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(t2`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(t2`/uploads/${e}/complete`,{body:t,...s})}}s8.Parts=s6;let s5=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class s9 extends tQ{create(e,t,s){return this._client.post(t2`/vector_stores/${e}/file_batches`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(t2`/vector_stores/${n}/file_batches/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post(t2`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...r}=t;return this._client.getAPIList(t2`/vector_stores/${n}/file_batches/${e}/files`,tL,{query:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=sf([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e3(a);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let r=Math.min(n?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...s];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(r).fill(a).map(l);return await s5(c),await this.createAndPoll(e,{file_ids:o})}}class s7 extends tQ{create(e,t,s){return this._client.post(t2`/vector_stores/${e}/files`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(t2`/vector_stores/${n}/files/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...r}=t;return this._client.post(t2`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t2`/vector_stores/${e}/files`,tL,{query:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete(t2`/vector_stores/${n}/files/${e}`,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=sf([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let r=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),i=r.data;switch(i.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=r.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e3(a);break;case"failed":case"completed":return i}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList(t2`/vector_stores/${n}/files/${e}/content`,tM,{...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class ne extends tQ{constructor(){super(...arguments),this.files=new s7(this._client),this.fileBatches=new s9(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t2`/vector_stores/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t2`/vector_stores/${e}`,{body:t,...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",tL,{query:e,...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(t2`/vector_stores/${e}`,{...t,headers:sf([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(t2`/vector_stores/${e}/search`,tM,{body:t,method:"post",...s,headers:sf([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}ne.Files=s7,ne.FileBatches=s9;class nt extends tQ{constructor(){super(...arguments),ew.add(this)}async unwrap(e,t,s=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,s,n),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,n=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");eR(this,ew,"m",eb).call(this,s);let r=sf([t]).values,i=eR(this,ew,"m",e_).call(this,r,"webhook-signature"),a=eR(this,ew,"m",e_).call(this,r,"webhook-timestamp"),o=eR(this,ew,"m",e_).call(this,r,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new eV("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>n)throw new eV("Webhook timestamp is too old");if(l>c+n)throw new eV("Webhook timestamp is too new");let u=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),h=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=o?`${o}.${a}.${e}`:`${a}.${e}`,p=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of u)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",p,t,new TextEncoder().encode(d)))return}catch{continue}throw new eV("The given webhook signature does not match the expected signature")}}ew=new WeakSet,eb=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},e_=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s};class ns{constructor({baseURL:e=sE("OPENAI_BASE_URL"),apiKey:t=sE("OPENAI_API_KEY"),organization:s=sE("OPENAI_ORG_ID")??null,project:n=sE("OPENAI_PROJECT_ID")??null,webhookSecret:r=sE("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(ev.add(this),eA.set(this,void 0),this.completions=new sP(this),this.chat=new sd(this),this.embeddings=new sL(this),this.files=new sW(this),this.images=new sZ(this),this.audio=new sw(this),this.moderations=new sQ(this),this.models=new sG(this),this.fineTuning=new sK(this),this.graders=new sY(this),this.vectorStores=new ne(this),this.webhooks=new nt(this),this.beta=new sT(this),this.batches=new sb(this),this.uploads=new s8(this),this.responses=new s4(this),this.evals=new sU(this),this.containers=new sM(this),void 0===t)throw new eC("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:s,project:n,webhookSecret:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&e6())throw new eC("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??ex.DEFAULT_TIMEOUT,this.logger=a.logger??console;let o="warn";this.logLevel=o,this.logLevel=tb(a.logLevel,"ClientOptions.logLevel",this)??tb(sE("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),ek(this,eA,tr,"f"),this._options=a,this.apiKey=t,this.organization=s,this.project=n,this.webhookSecret=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return sf([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,n,r=e,i=function(e=tp){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||tp.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=ti;if(void 0!==e.format){if(!tl(to,e.format))throw TypeError("Unknown format option provided.");n=e.format}let r=to[n],i=tp.filter;if(("function"==typeof e.filter||eG(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in th?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":tp.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||tp.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:tp.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:tp.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:tp.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?tp.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:tp.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:tp.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:tp.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:tp.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:tp.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:tp.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:tp.strictNullHandling}}(t);"function"==typeof i.filter?r=(0,i.filter)("",r):eG(i.filter)&&(s=i.filter);let a=[];if("object"!=typeof r||null===r)return"";let o=th[i.arrayFormat],l="comma"===o&&i.commaRoundTrip;s||(s=Object.keys(r)),i.sort&&s.sort(i.sort);let c=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];(!i.skipNulls||null!==r[t])&&td(a,function e(t,s,n,r,i,a,o,l,c,u,h,d,p,f,m,g,y,w){var b,_;let v,x=t,A=w,S=0,I=!1;for(;void 0!==(A=A.get(tf))&&!I;){let e=A.get(t);if(S+=1,void 0!==e){if(e===S)throw RangeError("Cyclic object value");I=!0}void 0===A.get(tf)&&(S=0)}if("function"==typeof u?x=u(s,x):x instanceof Date?x=p?.(x):"comma"===n&&eG(x)&&(x=tu(x,function(e){return e instanceof Date?p?.(e):e})),null===x){if(a)return c&&!g?c(s,tp.encoder,y,"key",f):s;x=""}if("string"==typeof(b=x)||"number"==typeof b||"boolean"==typeof b||"symbol"==typeof b||"bigint"==typeof b||(_=x)&&"object"==typeof _&&_.constructor&&_.constructor.isBuffer&&_.constructor.isBuffer(_)){if(c){let e=g?s:c(s,tp.encoder,y,"key",f);return[m?.(e)+"="+m?.(c(x,tp.encoder,y,"value",f))]}return[m?.(s)+"="+m?.(String(x))]}let $=[];if(void 0===x)return $;if("comma"===n&&eG(x))g&&c&&(x=tu(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(eG(u))v=u;else{let e=Object.keys(x);v=h?e.sort(h):e}let E=l?String(s).replace(/\./g,"%2E"):String(s),O=r&&eG(x)&&1===x.length?E+"[]":E;if(i&&eG(x)&&0===x.length)return O+"[]";for(let s=0;s<v.length;++s){let b=v[s],_="object"==typeof b&&void 0!==b.value?b.value:x[b];if(o&&null===_)continue;let A=d&&l?b.replace(/\./g,"%2E"):b,I=eG(x)?"function"==typeof n?n(O,A):O:O+(d?"."+A:"["+A+"]");w.set(t,S);let E=new WeakMap;E.set(tf,w),td($,e(_,I,n,r,i,a,o,l,"comma"===n&&g&&eG(x)?null:c,u,h,d,p,f,m,g,y,E))}return $}(r[t],t,o,l,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}let u=a.join(i.delimiter),h=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${e4}`}defaultIdempotencyKey(){return`stainless-node-retry-${eT()}`}makeStatusError(e,t,s,n){return eM.generate(e,t,s,n)}buildURL(e,t,s){let n=!eR(this,ev,"m",eS).call(this)&&s||this.baseURL,r=new URL(eZ(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tP(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);let{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(i,{url:a,options:n});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,u=Date.now();if(tS(this).debug(`[${l}] sending request`,tI({retryOfRequestLogID:s,method:n.method,url:a,options:n,headers:i.headers})),n.signal?.aborted)throw new eL;let h=new AbortController,d=await this.fetchWithTimeout(a,i,o,h).catch(eN),p=Date.now();if(d instanceof Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new eL;let r=eP(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return tS(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),tS(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,tI({retryOfRequestLogID:s,url:a,durationMs:p-u,message:d.message})),this.retryRequest(n,t,s??l);if(tS(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),tS(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,tI({retryOfRequestLogID:s,url:a,durationMs:p-u,message:d.message})),r)throw new eD;throw new ej({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-u}ms`;if(!d.ok){let e=this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await tn(d.body),tS(this).info(`${m} - ${e}`),tS(this).debug(`[${l}] response error (${e})`,tI({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),this.retryRequest(n,t,s??l,d.headers)}let r=e?"error; no more retries left":"error; not retryable";tS(this).info(`${m} - ${r}`);let i=await d.text().catch(e=>eN(e).message),a=e2(i),o=a?void 0:i;throw tS(this).debug(`[${l}] response error (${r})`,tI({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-u})),this.makeStatusError(d.status,a,o,d.headers)}return tS(this).info(m),tS(this).debug(`[${l}] response start`,tI({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),{response:d,options:n,controller:h,requestLogID:l,retryOfRequestLogID:s,startTime:u}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tC(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,n){let{signal:r,method:i,...a}=t||{};r&&r.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,n){let r;let i=n?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n?.get("retry-after");if(a&&!r){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await e3(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:r,query:i,defaultBaseURL:a}=s,o=this.buildURL(r,i,a);"timeout"in s&&e1("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),u=this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:u,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let i=sf([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...e7(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=sf([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:tt(e)}:eR(this,eA,"f").call(this,{body:e,headers:s})}}ex=ns,eA=new WeakMap,ev=new WeakSet,eS=function(){return"https://api.openai.com/v1"!==this.baseURL},ns.OpenAI=ex,ns.DEFAULT_TIMEOUT=6e5,ns.OpenAIError=eC,ns.APIError=eM,ns.APIConnectionError=ej,ns.APIConnectionTimeoutError=eD,ns.APIUserAbortError=eL,ns.NotFoundError=eq,ns.ConflictError=eF,ns.RateLimitError=ez,ns.BadRequestError=eU,ns.AuthenticationError=eW,ns.InternalServerError=eX,ns.PermissionDeniedError=eB,ns.UnprocessableEntityError=eH,ns.InvalidWebhookSignatureError=eV,ns.toFile=tZ,ns.Completions=sP,ns.Chat=sd,ns.Embeddings=sL,ns.Files=sW,ns.Images=sZ,ns.Audio=sw,ns.Moderations=sQ,ns.Models=sG,ns.FineTuning=sK,ns.Graders=sY,ns.VectorStores=ne,ns.Webhooks=nt,ns.Beta=sT,ns.Batches=sb,ns.Uploads=s8,ns.Responses=s4,ns.Evals=sU,ns.Containers=sM},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3636:e=>{"use strict";e.exports=import("puppeteer")},3665:(e,t,s)=>{"use strict";s.a(e,async(e,n)=>{try{s.d(t,{UW:()=>h});var r=s(3636),i=s(9021),a=s.n(i),o=s(3873),l=s.n(o),c=s(4442),u=e([r,c]);async function h(e,t="public/screenshots"){let s=await r.default.launch({headless:!0,args:c.default.args,executablePath:await c.default.executablePath()});try{a().existsSync(t)||a().mkdirSync(t,{recursive:!0});let n=new Date().toISOString().replace(/[:.]/g,"-"),r=`desktop-${n}.png`,i=`mobile-${n}.png`,o=l().join(t,r),c=l().join(t,i),u=await s.newPage();await u.setViewport({width:1920,height:1080});try{await u.goto(e,{waitUntil:"networkidle2",timeout:3e4}),await u.screenshot({path:o,fullPage:!0})}catch(e){throw console.warn("Desktop screenshot failed:",e),e}finally{await u.close()}let h=await s.newPage();await h.setViewport({width:375,height:667});try{await h.goto(e,{waitUntil:"networkidle2",timeout:3e4}),await h.screenshot({path:c,fullPage:!0})}catch(e){throw console.warn("Mobile screenshot failed:",e),e}finally{await h.close()}return{desktop:`/screenshots/${r}`,mobile:`/screenshots/${i}`}}finally{await s.close()}}[r,c]=u.then?(await u)():u,n()}catch(e){n(e)}})},3873:e=>{"use strict";e.exports=require("path")},4442:e=>{"use strict";e.exports=import("@sparticuz/chromium")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6382:(e,t,s)=>{"use strict";s.a(e,async(e,n)=>{try{s.r(t),s.d(t,{POST:()=>o});var r=s(2190),i=s(8430),a=e([i]);async function o(e){try{let t;let{url:s}=await e.json();if(!s)return r.NextResponse.json({error:"URL is required"},{status:400});if(!/^https?:\/\/.+/.test(s))return r.NextResponse.json({error:"Invalid URL format. Please provide a URL starting with http:// or https://"},{status:400});if(process.env.AZURE_OPENAI_API_KEY&&process.env.AZURE_OPENAI_ENDPOINT&&process.env.AZURE_OPENAI_DEPLOYMENT_NAME)try{console.log("\uD83D\uDD0D Using enhanced AI analysis..."),t=await (0,i.k)(s)}catch(n){console.error(" Enhanced AI analysis failed:",n);let e=n instanceof Error?n.message:"Unknown error";if(e.includes("AI cannot analyze this website")||e.includes("content policy")||e.includes("cannot process"))return r.NextResponse.json({error:"AI analysis failed",message:"Unable to analyze this website. This could be due to the website being inaccessible, requiring authentication, or having content that the AI cannot process.",url:s,timestamp:new Date().toISOString()},{status:422});console.log(" AI failed for technical reasons, falling back to basic analysis..."),t=(0,i.K)(s,"AI failed for technical reasons, here is a basic analysis for demonstration purposes.")}else console.log(" Azure OpenAI not configured, using basic analysis..."),t=(0,i.K)(s);return r.NextResponse.json(t)}catch(e){return console.error(" Error analyzing website:",e),r.NextResponse.json({error:"Failed to analyze website"},{status:500})}}i=(a.then?(await a)():a)[0],n()}catch(e){n(e)}})},6487:()=>{},8335:()=>{},8430:(e,t,s)=>{"use strict";s.a(e,async(e,n)=>{try{s.d(t,{K:()=>d,k:()=>u});var r=s(694),i=s(3665),a=s(3636),o=s(4442),l=e([i,a,o]);[i,a,o]=l.then?(await l)():l;let p=null;async function c(e){let t=await a.default.launch({headless:!0,args:o.default.args,executablePath:await o.default.executablePath()});try{let s=await t.newPage();await s.setViewport({width:1920,height:1080}),await s.setUserAgent("Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"),s.setDefaultTimeout(3e4),console.log(` Navigating to: ${e}`);let n=await s.goto(e,{waitUntil:"networkidle0",timeout:3e4});if(!n||!n.ok())throw Error(`Failed to load page: ${n?.status()} ${n?.statusText()}`);console.log(" Page loaded successfully"),await new Promise(e=>setTimeout(e,2e3));let r=await s.content(),i=await s.evaluate(()=>(document.querySelectorAll("script, style, noscript, iframe, svg, img").forEach(e=>e.remove()),(document.body.innerText||document.body.textContent||"").replace(/\s+/g," ").replace(/\n\s*\n/g,"\n").trim())),a=await s.evaluate(()=>({title:document.title,description:document.querySelector('meta[name="description"]')?.getAttribute("content")||"",keywords:document.querySelector('meta[name="keywords"]')?.getAttribute("content")||"",viewport:document.querySelector('meta[name="viewport"]')?.getAttribute("content")||"",robots:document.querySelector('meta[name="robots"]')?.getAttribute("content")||"",ogTitle:document.querySelector('meta[property="og:title"]')?.getAttribute("content")||"",ogDescription:document.querySelector('meta[property="og:description"]')?.getAttribute("content")||"",ogImage:document.querySelector('meta[property="og:image"]')?.getAttribute("content")||"",canonical:document.querySelector('link[rel="canonical"]')?.getAttribute("href")||"",language:document.documentElement.lang||"en",charset:document.characterSet||"UTF-8"})),o=await s.evaluate(()=>{let e=document.querySelectorAll("img"),t=document.querySelectorAll("a"),s=document.querySelectorAll('button, input[type="button"], input[type="submit"]'),n=document.querySelectorAll("form"),r=document.querySelectorAll("h1, h2, h3, h4, h5, h6"),i=document.querySelectorAll("input, textarea, select"),a=document.querySelectorAll("table"),o=document.querySelectorAll("ul, ol");return{imagesWithoutAlt:Array.from(e).filter(e=>!e.alt).length,totalImages:e.length,imageDetails:Array.from(e).map(e=>({src:e.src,alt:e.alt,title:e.title,hasAlt:!!e.alt})),linksWithoutText:Array.from(t).filter(e=>!(e.textContent||"").trim()).length,totalLinks:t.length,linkDetails:Array.from(t).map(e=>({href:e.href,text:(e.textContent||"").trim(),hasText:!!(e.textContent||"").trim()})),buttonsWithoutText:Array.from(s).filter(e=>!(e.textContent||"").trim()&&!e.getAttribute("aria-label")).length,totalButtons:s.length,buttonDetails:Array.from(s).map(e=>({text:(e.textContent||"").trim(),ariaLabel:e.getAttribute("aria-label"),type:e.getAttribute("type"),hasText:!!(e.textContent||"").trim()||!!e.getAttribute("aria-label")})),formsWithoutLabels:Array.from(n).filter(e=>!e.querySelector("label")).length,totalForms:n.length,inputDetails:Array.from(i).map(e=>({type:e.getAttribute("type"),name:e.getAttribute("name"),id:e.getAttribute("id"),hasLabel:!!document.querySelector(`label[for="${e.getAttribute("id")}"]`)||!!e.closest("label")})),headingStructure:Array.from(r).map(e=>({level:e.tagName.toLowerCase(),text:(e.textContent||"").trim()})),totalTables:a.length,totalLists:o.length}}),l=await s.evaluate(()=>{let e=l.getEntriesByType("navigation")[0];return{loadTime:e?e.loadEventEnd-e.loadEventStart:0,domContentLoaded:e?e.domContentLoadedEventEnd-e.domContentLoadedEventStart:0,firstPaint:l.getEntriesByType("paint").find(e=>"first-paint"===e.name)?.startTime||0,firstContentfulPaint:l.getEntriesByType("paint").find(e=>"first-contentful-paint"===e.name)?.startTime||0}}),c=await s.evaluate(()=>({width:window.innerWidth,height:window.innerHeight,devicePixelRatio:window.devicePixelRatio,scrollWidth:document.documentElement.scrollWidth,scrollHeight:document.documentElement.scrollHeight}));return{html:r.substring(0,2e5),visibleText:i.substring(0,5e4),metadata:a,accessibility:o,performance:l,viewport:c}}finally{await t.close()}}async function u(e){if(!process.env.AZURE_OPENAI_API_KEY)throw Error("Azure OpenAI API key is not configured");if(!process.env.AZURE_OPENAI_ENDPOINT)throw Error("Azure OpenAI endpoint is not configured");if(!process.env.AZURE_OPENAI_DEPLOYMENT_NAME)throw Error("Azure OpenAI deployment name is not configured");console.log("\uD83D\uDD27 Azure OpenAI configuration validated"),console.log("\uD83D\uDD27 Endpoint:",process.env.AZURE_OPENAI_ENDPOINT),console.log("\uD83D\uDD27 Deployment:",process.env.AZURE_OPENAI_DEPLOYMENT_NAME),f=0;let t=null,s={desktop:void 0,mobile:void 0};try{console.log("\uD83D\uDCC4 Capturing website content..."),t=await c(e),console.log(" Website content captured successfully"),s=await (0,i.UW)(e).catch(e=>(console.warn("Screenshot capture failed:",e.message),{desktop:void 0,mobile:void 0}))}catch(e){throw console.error(" Failed to capture website content:",e),Error(`Failed to access website: ${e instanceof Error?e.message:"Unknown error"}`)}let n=`You are an expert UX/UI analyst and web accessibility specialist. Your task is to analyze websites and provide comprehensive, specific, and actionable feedback.

IMPORTANT: Be extremely specific and detailed in your analysis, but ONLY based on the data provided. Do NOT make up specific measurements, colors, or visual details you cannot verify from the provided content.

Instead of generic statements like "Low contrast in some areas", provide specific details like:
- "Missing alt text on images (found 5 images without alt attributes)"
- "Navigation menu has 3 links without descriptive text"
- "Contact form is missing proper labels for input fields"
- "Page has poor heading structure with missing H1 and H2 elements"

For visual issues like contrast, colors, or spacing, only mention them if you can see them explicitly in the HTML/CSS data provided. Otherwise, focus on structural, semantic, and content-based issues.

Analyze the provided website content and return a detailed analysis in the following JSON format:

{
  "score": number (0-100),
  "strengths": ["specific strength with details"],
  "improvements": ["specific improvement with context"],
  "recommendations": ["actionable recommendation with reasoning"],
  "details": {
    "accessibility": {
      "score": number (0-100),
      "issues": [
        {
          "id": "unique-identifier",
          "title": "Specific issue title",
          "description": "Detailed description of the issue with specific elements, colors, measurements, etc.",
          "severity": "low|medium|high|critical",
          "category": "accessibility",
          "location": {
            "element": "specific element name (e.g., 'navigation menu', 'contact form')",
            "selector": "CSS selector if applicable",
            "page": "page name or URL path"
          },
          "impact": "How this affects users (e.g., 'Screen reader users cannot understand the purpose of this image')",
          "recommendation": "Specific actionable solution with code examples if applicable",
          "codeExample": "Code snippet showing the fix"
        }
      ]
    },
    "performance": {
      "score": number (0-100),
      "issues": [/* same structure as above */]
    },
    "usability": {
      "score": number (0-100),
      "issues": [/* same structure as above */]
    },
    "design": {
      "score": number (0-100),
      "issues": [/* same structure as above */]
    }
  },
  "metadata": {
    "pageTitle": "Page title",
    "loadTime": estimated_load_time_in_ms,
    "pageSize": estimated_page_size_in_kb,
    "technologies": ["detected technologies"]
  }
}

Guidelines for analysis:
- Accessibility: Check alt text presence, ARIA labels, heading structure, form labels, link descriptions, semantic HTML usage
- Performance: Evaluate based on provided metrics (load times, paint times), code structure, resource optimization opportunities
- Usability: Assess navigation structure, content organization, form usability, mobile responsiveness indicators, user flow
- Design: Review HTML structure for visual hierarchy, semantic markup, content organization, and layout patterns

IMPORTANT: Focus on issues you can actually identify from the provided data. Do not make assumptions about visual appearance, colors, or specific measurements unless they are explicitly mentioned in the HTML/CSS content.

For each issue:
1. Be specific about which element has the problem (based on the HTML structure provided)
2. Provide exact counts, element types, or structural details when possible
3. Explain the impact on users
4. Give actionable recommendations with code examples
5. Assign appropriate severity based on user impact

Remember: Only provide feedback on issues you can actually identify from the provided data. Do not make up visual details, colors, or measurements that aren't explicitly present in the HTML/CSS content.

IMPORTANT: If you cannot analyze the website for any reason (content policy, accessibility, etc.), respond with a JSON object explaining why:
{
  "error": "reason_for_failure",
  "message": "Detailed explanation of why analysis failed"
}`,r=`Please analyze the following website content for: ${e}

WEBSITE CONTENT:
Title: ${t.metadata.title}
Description: ${t.metadata.description}
Language: ${t.metadata.language}

VISIBLE TEXT CONTENT (first 25000 characters):
${t.visibleText.substring(0,25e3)}

ACCESSIBILITY DATA:
- Images without alt text: ${t.accessibility.imagesWithoutAlt}/${t.accessibility.totalImages}
- Links without text: ${t.accessibility.linksWithoutText}/${t.accessibility.totalLinks}
- Buttons without text: ${t.accessibility.buttonsWithoutText}/${t.accessibility.totalButtons}
- Forms without labels: ${t.accessibility.formsWithoutLabels}/${t.accessibility.totalForms}
- Total tables: ${t.accessibility.totalTables}
- Total lists: ${t.accessibility.totalLists}
- Heading structure: ${t.accessibility.headingStructure.map(e=>`${e.level}: ${e.text.substring(0,50)}`).join(", ")}

DETAILED ACCESSIBILITY ANALYSIS:
- Images needing alt text: ${t.accessibility.imageDetails.filter(e=>!e.hasAlt).map(e=>e.src.split("/").pop()).join(", ")}
- Links needing text: ${t.accessibility.linkDetails.filter(e=>!e.hasText).map(e=>e.href).join(", ")}
- Buttons needing text: ${t.accessibility.buttonDetails.filter(e=>!e.hasText).map(e=>e.type||"button").join(", ")}
- Inputs without labels: ${t.accessibility.inputDetails.filter(e=>!e.hasLabel).map(e=>`${e.type} (${e.name||e.id||"unnamed"})`).join(", ")}

PERFORMANCE DATA:
- Load time: ${t.performance.loadTime}ms
- DOM content loaded: ${t.performance.domContentLoaded}ms
- First paint: ${t.performance.firstPaint}ms
- First contentful paint: ${t.performance.firstContentfulPaint}ms

VIEWPORT DATA:
- Width: ${t.viewport.width}px
- Height: ${t.viewport.height}px
- Scroll width: ${t.viewport.scrollWidth}px
- Scroll height: ${t.viewport.scrollHeight}px

HTML STRUCTURE (first 50000 characters):
${t.html.substring(0,5e4)}

Provide a comprehensive UX analysis focusing on accessibility, performance, usability, and design. Consider both desktop and mobile experiences.

IMPORTANT: Be extremely specific in your feedback. Instead of saying "some areas have low contrast", identify exactly which elements, what the colors are, and what the contrast ratio is.`;try{let i;if(!p)throw Error("Azure OpenAI client is not initialized - missing environment variables");console.log("\uD83E\uDD16 Sending request to Azure OpenAI..."),console.log("Model:",process.env.AZURE_OPENAI_DEPLOYMENT_NAME||"gpt-4o"),console.log("URL being analyzed:",e);let a=await p.chat.completions.create({model:process.env.AZURE_OPENAI_DEPLOYMENT_NAME||"gpt-4o",messages:[{role:"system",content:n},{role:"user",content:r}],temperature:.2,max_tokens:8e3});console.log(" Received response from Azure OpenAI");let o=a.choices[0]?.message?.content;if(!o)throw console.error(" No response content from AI model"),Error("No response from AI model");console.log("\uD83D\uDCDD Response length:",o.length),console.log("\uD83D\uDCDD Response preview:",o.substring(0,200)+"...");try{console.log("\uD83D\uDD0D Attempting to parse JSON response...");let e=o.match(/\{[\s\S]*\}/);if(e?(console.log("\uD83D\uDCCB Found JSON match, parsing..."),i=JSON.parse(e[0])):(console.log("\uD83D\uDCCB No JSON match found, trying to parse entire response..."),i=JSON.parse(o)),console.log(" JSON parsing successful"),i.error)throw console.error(" AI returned error response:",i.error),Error(`AI cannot analyze this website: ${i.message||i.error}`)}catch(e){if(console.error(" Failed to parse AI response:",e),console.error("\uD83D\uDCDD Raw response:",o),o.toLowerCase().includes("unfortunately")||o.toLowerCase().includes("cannot")||o.toLowerCase().includes("unable")||o.toLowerCase().includes("sorry"))throw Error(`AI cannot analyze this website: ${o.substring(0,100)}...`);throw Error(`Invalid AI response format: ${e instanceof Error?e.message:"Unknown parsing error"}`)}let l={url:e,score:Math.min(100,Math.max(0,i.score||70)),strengths:i.strengths||[],improvements:i.improvements||[],recommendations:i.recommendations||[],screenshots:s,timestamp:new Date().toISOString(),details:{accessibility:{score:Math.min(100,Math.max(0,i.details?.accessibility?.score||70)),issues:h(i.details?.accessibility?.issues||[],"accessibility")},performance:{score:Math.min(100,Math.max(0,i.details?.performance?.score||70)),issues:h(i.details?.performance?.issues||[],"performance")},usability:{score:Math.min(100,Math.max(0,i.details?.usability?.score||70)),issues:h(i.details?.usability?.issues||[],"usability")},design:{score:Math.min(100,Math.max(0,i.details?.design?.score||70)),issues:h(i.details?.design?.issues||[],"design")}},metadata:{pageTitle:i.metadata?.pageTitle||t.metadata.title,loadTime:i.metadata?.loadTime||t.performance.loadTime,pageSize:i.metadata?.pageSize||Math.round(t.html.length/1024),technologies:i.metadata?.technologies||[]}};return console.log(" AI analysis completed successfully"),l}catch(e){throw console.error(" Enhanced AI analysis failed:",e),console.error("Stack trace:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),Error(`AI analysis failed: ${e instanceof Error?e.message:"Unknown error"}`)}}process.env.AZURE_OPENAI_API_KEY&&process.env.AZURE_OPENAI_ENDPOINT&&process.env.AZURE_OPENAI_DEPLOYMENT_NAME&&(p=new r.Ay({apiKey:process.env.AZURE_OPENAI_API_KEY,baseURL:`${process.env.AZURE_OPENAI_ENDPOINT}/openai/deployments/${process.env.AZURE_OPENAI_DEPLOYMENT_NAME}`,defaultQuery:{"api-version":process.env.AZURE_OPENAI_API_VERSION||"2024-02-15-preview"},defaultHeaders:{"api-key":process.env.AZURE_OPENAI_API_KEY}}));let f=0;function h(e,t){return e.map(e=>(f++,{id:e.id||`issue-${f}`,title:e.title||"Unspecified Issue",description:e.description||"No description provided",severity:["low","medium","high","critical"].includes(e.severity)?e.severity:"medium",category:t,location:e.location||{},impact:e.impact||"Impact not specified",recommendation:e.recommendation||"No recommendation provided",codeExample:e.codeExample||void 0}))}function d(e,t){return{url:e,score:Math.floor(40*Math.random())+60,timestamp:new Date().toISOString(),fallbackReason:t||void 0,strengths:["Clean and modern design aesthetic","Good use of white space and typography","Responsive design works well on mobile devices","Clear navigation structure","Fast loading times"],improvements:["Call-to-action buttons could be more prominent","Color contrast could be improved for better accessibility","Some pages lack clear user guidance","Contact information could be more accessible","Loading states could provide better user feedback"],recommendations:["Implement A/B testing for key conversion elements","Add more interactive elements to increase engagement","Consider adding a chatbot for immediate user support","Optimize images for faster loading","Add breadcrumb navigation for better user orientation"],details:{accessibility:{score:Math.floor(30*Math.random())+70,issues:[{id:"accessibility-contrast-1",title:"Low contrast text in navigation menu",description:"White text (#FFFFFF) on light gray background (#F0F0F0) has insufficient contrast ratio of 2.1:1",severity:"high",category:"accessibility",location:{element:"navigation menu",page:"homepage"},impact:"Users with visual impairments cannot read the navigation text",recommendation:"Change background color to darker gray (#666666) for 4.5:1 contrast ratio"},{id:"accessibility-alt-1",title:"Missing alt text on hero image",description:"Hero banner image 'hero-banner.jpg' lacks descriptive alt text",severity:"medium",category:"accessibility",location:{element:"hero image",page:"homepage"},impact:"Screen reader users cannot understand the image content",recommendation:"Add descriptive alt text: 'alt=\"Company team working together in modern office\"'"}]},performance:{score:Math.floor(25*Math.random())+75,issues:[{id:"performance-images-1",title:"Large unoptimized hero image",description:"Hero image 'hero-banner.jpg' is 2.3MB and not optimized for web",severity:"medium",category:"performance",location:{element:"hero image",page:"homepage"},impact:"Slow page load times, especially on mobile devices",recommendation:"Compress image to under 200KB and use WebP format"},{id:"performance-css-1",title:"Unoptimized CSS delivery",description:"CSS is loaded synchronously and blocks rendering",severity:"low",category:"performance",location:{element:"stylesheet",page:"all"},impact:"Delays visual rendering of the page",recommendation:"Use critical CSS inlining and async loading for non-critical styles"}]},usability:{score:Math.floor(35*Math.random())+65,issues:[{id:"usability-nav-1",title:"Complex navigation structure",description:"Navigation has 3 levels deep with unclear hierarchy",severity:"medium",category:"usability",location:{element:"main navigation",page:"all"},impact:"Users struggle to find desired content quickly",recommendation:"Simplify to 2 levels maximum and add breadcrumbs"},{id:"usability-flow-1",title:"Unclear user flow on homepage",description:"No clear call-to-action or next steps for visitors",severity:"high",category:"usability",location:{element:"homepage content",page:"homepage"},impact:"High bounce rate as users don't know what to do next",recommendation:"Add prominent CTA button and clear value proposition"}]},design:{score:Math.floor(20*Math.random())+80,issues:[{id:"design-spacing-1",title:"Inconsistent spacing between sections",description:"Sections have varying margins (20px, 40px, 30px) instead of consistent spacing",severity:"low",category:"design",location:{element:"page sections",page:"all"},impact:"Visual inconsistency creates poor user experience",recommendation:"Use consistent 32px spacing between all sections"},{id:"design-mobile-1",title:"Poor mobile layout for contact form",description:"Contact form fields are too small (height: 32px) on mobile devices",severity:"medium",category:"design",location:{element:"contact form",page:"contact"},impact:"Difficult to tap and interact with form elements",recommendation:"Increase form field height to 44px minimum for mobile"}]}},metadata:{pageTitle:"Sample Website",loadTime:2500,pageSize:1200,technologies:["React","Next.js","Tailwind CSS"]}}}n()}catch(e){n(e)}})},8848:(e,t,s)=>{"use strict";s.a(e,async(e,n)=>{try{s.r(t),s.d(t,{patchFetch:()=>c,routeModule:()=>u,serverHooks:()=>p,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>d});var r=s(6559),i=s(8088),a=s(7719),o=s(6382),l=e([o]);o=(l.then?(await l)():l)[0];let u=new r.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/analyze-website/route",pathname:"/api/analyze-website",filename:"route",bundlePath:"app/api/analyze-website/route"},resolvedPagePath:"/Users/rolfbekkelund/Documents/Juvo Solutions/Repositories/UX-finall/UX-final/src/app/api/analyze-website/route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:h,workUnitAsyncStorage:d,serverHooks:p}=u;function c(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:d})}n()}catch(e){n(e)}})},9021:e=>{"use strict";e.exports=require("fs")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[447,580],()=>s(8848));module.exports=n})();