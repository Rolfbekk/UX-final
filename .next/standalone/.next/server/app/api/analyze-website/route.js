(()=>{var e={};e.id=414,e.ids=[414],e.modules={253:(e,t,s)=>{let{Readable:r,Writable:n,getStreamError:i}=s(6420),a=s(5945),o=s(4571),l=s(3860),c=a.alloc(1024);class u extends n{constructor(e,t,s){super({mapWritable:p,eagerOpen:!0}),this.written=0,this.header=t,this._callback=s,this._linkname=null,this._isLinkname="symlink"===t.type&&!t.linkname,this._isVoid="file"!==t.type&&"contiguous-file"!==t.type,this._finished=!1,this._pack=e,this._openCallback=null,null===this._pack._stream?this._pack._stream=this:this._pack._pending.push(this)}_open(e){this._openCallback=e,this._pack._stream===this&&this._continueOpen()}_continuePack(e){if(null===this._callback)return;let t=this._callback;this._callback=null,t(e)}_continueOpen(){null===this._pack._stream&&(this._pack._stream=this);let e=this._openCallback;if(this._openCallback=null,null!==e){if(this._pack.destroying)return e(Error("pack stream destroyed"));if(this._pack._finalized)return e(Error("pack stream is already finalized"));this._pack._stream=this,this._isLinkname||this._pack._encode(this.header),this._isVoid&&(this._finish(),this._continuePack(null)),e(null)}}_write(e,t){return this._isLinkname?(this._linkname=this._linkname?a.concat([this._linkname,e]):e,t(null)):this._isVoid?e.byteLength>0?t(Error("No body allowed for this entry")):t():(this.written+=e.byteLength,this._pack.push(e))?t():void(this._pack._drain=t)}_finish(){this._finished||(this._finished=!0,this._isLinkname&&(this.header.linkname=this._linkname?a.toString(this._linkname,"utf-8"):"",this._pack._encode(this.header)),f(this._pack,this.header.size),this._pack._done(this))}_final(e){if(this.written!==this.header.size)return e(Error("Size mismatch"));this._finish(),e(null)}_getError(){return i(this)||Error("tar entry destroyed")}_predestroy(){this._pack.destroy(this._getError())}_destroy(e){this._pack._done(this),this._continuePack(this._finished?null:this._getError()),e()}}class h extends r{constructor(e){super(e),this._drain=d,this._finalized=!1,this._finalizing=!1,this._pending=[],this._stream=null}entry(e,t,s){if(this._finalized||this.destroying)throw Error("already finalized or destroyed");"function"==typeof t&&(s=t,t=null),s||(s=d),e.size&&"symlink"!==e.type||(e.size=0),e.type||(e.type=function(e){switch(e&o.S_IFMT){case o.S_IFBLK:return"block-device";case o.S_IFCHR:return"character-device";case o.S_IFDIR:return"directory";case o.S_IFIFO:return"fifo";case o.S_IFLNK:return"symlink"}return"file"}(e.mode)),e.mode||(e.mode="directory"===e.type?493:420),e.uid||(e.uid=0),e.gid||(e.gid=0),e.mtime||(e.mtime=new Date),"string"==typeof t&&(t=a.from(t));let r=new u(this,e,s);return a.isBuffer(t)?(e.size=t.byteLength,r.write(t),r.end()):r._isVoid,r}finalize(){if(this._stream||this._pending.length>0){this._finalizing=!0;return}this._finalized||(this._finalized=!0,this.push(c),this.push(null))}_done(e){e===this._stream&&(this._stream=null,this._finalizing&&this.finalize(),this._pending.length&&this._pending.shift()._continueOpen())}_encode(e){if(!e.pax){let t=l.encode(e);if(t){this.push(t);return}}this._encodePax(e)}_encodePax(e){let t=l.encodePax({name:e.name,linkname:e.linkname,pax:e.pax}),s={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.byteLength,mtime:e.mtime,type:"pax-header",linkname:e.linkname&&"PaxHeader",uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};this.push(l.encode(s)),this.push(t),f(this,t.byteLength),s.size=e.size,s.type=e.type,this.push(l.encode(s))}_doDrain(){let e=this._drain;this._drain=d,e()}_predestroy(){let e=i(this);for(this._stream&&this._stream.destroy(e);this._pending.length;){let t=this._pending.shift();t.destroy(e),t._continueOpen()}this._doDrain()}_read(e){this._doDrain(),e()}}function d(){}function f(e,t){(t&=511)&&e.push(c.subarray(0,512-t))}function p(e){return a.isBuffer(e)?e:a.from(e)}e.exports=function(e){return new h(e)}},694:(e,t,s)=>{"use strict";var r,n,i,a,o,l,c,u,h,d,f,p,m,g,_,y,b,w,v,x,S,k,A,E,I,O,C,R,T,$,L,P,N,M,F,B,j,U,D,q,W,z,H,X,J,K,V,Y,G,Z,Q,ee,et,es,er,en,ei,ea,eo,el,ec,eu,eh,ed,ef,ep,em,eg,e_,ey,eb,ew,ev,ex,eS,ek;let eA,eE,eI,eO;function eC(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s}function eR(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}s.d(t,{Ay:()=>rs});let eT=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return eT=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^s()&15>>+e/4).toString(16))};function e$(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eL=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eP extends Error{}class eN extends eP{constructor(e,t,s,r){super(`${eN.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.requestID=r?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){if(!e||!r)return new eF({message:s,cause:eL(t)});let n=t?.error;return 400===e?new ej(e,n,s,r):401===e?new eU(e,n,s,r):403===e?new eD(e,n,s,r):404===e?new eq(e,n,s,r):409===e?new eW(e,n,s,r):422===e?new ez(e,n,s,r):429===e?new eH(e,n,s,r):e>=500?new eX(e,n,s,r):new eN(e,n,s,r)}}class eM extends eN{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eF extends eN{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eB extends eF{constructor({message:e}={}){super({message:e??"Request timed out."})}}class ej extends eN{}class eU extends eN{}class eD extends eN{}class eq extends eN{}class eW extends eN{}class ez extends eN{}class eH extends eN{}class eX extends eN{}class eJ extends eP{constructor(){super("Could not parse response content as the length limit was reached")}}class eK extends eP{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class eV extends Error{constructor(e){super(e)}}let eY=/^[a-z][a-z0-9+.-]*:/i,eG=e=>eY.test(e),eZ=e=>(eZ=Array.isArray)(e),eQ=eZ;function e0(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let e1=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eP(`${e} must be an integer`);if(t<0)throw new eP(`${e} must be a positive integer`);return t},e2=e=>{try{return JSON.parse(e)}catch(e){return}},e3=e=>new Promise(t=>setTimeout(t,e)),e6="5.8.3",e4=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,e5=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e6,"X-Stainless-OS":e9(Deno.build.os),"X-Stainless-Arch":e8(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e6,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e6,"X-Stainless-OS":e9(globalThis.process.platform??"unknown"),"X-Stainless-Arch":e8(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,r=s[2]||0,n=s[3]||0;return{browser:e,version:`${t}.${r}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e6,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e6,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},e8=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",e9=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",e7=()=>eA??(eA=e5());function te(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function tt(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return te({start(){},async pull(e){let{done:s,value:r}=await t.next();s?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function ts(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function tr(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let tn=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),ti="RFC3986",ta=e=>String(e),to={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:ta},tl=(e,t)=>(tl=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),tc=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function tu(e,t){if(eZ(e)){let s=[];for(let r=0;r<e.length;r+=1)s.push(t(e[r]));return s}return t(e)}let th={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},td=function(e,t){Array.prototype.push.apply(e,eZ(t)?t:[t])},tf={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,r,n)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,s=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);if(45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===n&&(40===r||41===r)){s[s.length]=t.charAt(e);continue}if(r<128){s[s.length]=tc[r];continue}if(r<2048){s[s.length]=tc[192|r>>6]+tc[128|63&r];continue}if(r<55296||r>=57344){s[s.length]=tc[224|r>>12]+tc[128|r>>6&63]+tc[128|63&r];continue}e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),s[s.length]=tc[240|r>>18]+tc[128|r>>12&63]+tc[128|r>>6&63]+tc[128|63&r]}a+=s.join("")}return a},encodeValuesOnly:!1,format:ti,formatter:ta,indices:!1,serializeDate:e=>(eE??(eE=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},tp={};function tm(e){let t;return(eI??(eI=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tg(e){let t;return(eO??(eO=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class t_{constructor(){r.set(this,void 0),n.set(this,void 0),eC(this,r,new Uint8Array,"f"),eC(this,n,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tm(e):e;eC(this,r,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),r=0;for(let t of e)s.set(t,r),r+=t.length;return s}([eR(this,r,"f"),s]),"f");let i=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eR(this,r,"f"),eR(this,n,"f")));){if(t.carriage&&null==eR(this,n,"f")){eC(this,n,t.index,"f");continue}if(null!=eR(this,n,"f")&&(t.index!==eR(this,n,"f")+1||t.carriage)){i.push(tg(eR(this,r,"f").subarray(0,eR(this,n,"f")-1))),eC(this,r,eR(this,r,"f").subarray(eR(this,n,"f")),"f"),eC(this,n,null,"f");continue}let e=null!==eR(this,n,"f")?t.preceding-1:t.preceding,s=tg(eR(this,r,"f").subarray(0,e));i.push(s),eC(this,r,eR(this,r,"f").subarray(t.index),"f"),eC(this,n,null,"f")}return i}flush(){return eR(this,r,"f").length?this.decode("\n"):[]}}r=new WeakMap,n=new WeakMap,t_.NEWLINE_CHARS=new Set(["\n","\r"]),t_.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let ty={off:0,error:200,warn:300,info:400,debug:500},tb=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(ty,e))return e;tk(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ty))}`)}};function tw(){}function tv(e,t,s){return!t||ty[e]>ty[s]?tw:t[e].bind(t)}let tx={error:tw,warn:tw,info:tw,debug:tw},tS=new WeakMap;function tk(e){let t=e.logger,s=e.logLevel??"off";if(!t)return tx;let r=tS.get(t);if(r&&r[0]===s)return r[1];let n={error:tv("error",t,s),warn:tv("warn",t,s),info:tv("info",t,s),debug:tv("debug",t,s)};return tS.set(t,[s,n]),n}let tA=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class tE{constructor(e,t,s){this.iterator=e,i.set(this,void 0),this.controller=t,eC(this,i,s,"f")}static fromSSEResponse(e,t,s){let r=!1,n=s?tk(s):console;async function*i(){if(r)throw new eP("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let r of tI(e,t))if(!s){if(r.data.startsWith("[DONE]")){s=!0;continue}if(null===r.event||r.event.startsWith("response.")||r.event.startsWith("transcript.")){let t;try{t=JSON.parse(r.data)}catch(e){throw n.error("Could not parse message into JSON:",r.data),n.error("From chunk:",r.raw),e}if(t&&t.error)throw new eN(void 0,t.error,void 0,e.headers);yield t}else{let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if("error"==r.event)throw new eN(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}}s=!0}catch(e){if(e$(e))return;throw e}finally{s||t.abort()}}return new tE(i,t,s)}static fromReadableStream(e,t,s){let r=!1;async function*n(){let t=new t_;for await(let s of ts(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tE(async function*(){if(r)throw new eP("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(e$(e))return;throw e}finally{e||t.abort()}},t,s)}[(i=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=s.next();e.push(r),t.push(r)}return r.shift()}});return[new tE(()=>r(e),this.controller,eR(this,i,"f")),new tE(()=>r(t),this.controller,eR(this,i,"f"))]}toReadableStream(){let e;let t=this;return te({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:r}=await e.next();if(r)return t.close();let n=tm(JSON.stringify(s)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*tI(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eP("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eP("Attempted to iterate over a response with no body")}let s=new tC,r=new t_;for await(let t of tO(ts(e.body)))for(let e of r.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of r.flush()){let t=s.decode(e);t&&(yield t)}}async function*tO(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let r=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?tm(s):s,n=new Uint8Array(t.length+r.length);for(n.set(t),n.set(r,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tC{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,r]=function(e,t){let s=e.indexOf(":");return -1!==s?[e.substring(0,s),t,e.substring(s+t.length)]:[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}async function tR(e,t){let{response:s,requestLogID:r,retryOfRequestLogID:n,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(tk(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller,e):tE.fromSSEResponse(s,t.controller,e);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let r=s.headers.get("content-type"),n=r?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?tT(await s.json(),s):await s.text()})();return tk(e).debug(`[${r}] response parsed`,tA({retryOfRequestLogID:n,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function tT(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class t$ extends Promise{constructor(e,t,s=tR){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,a.set(this,void 0),eC(this,a,e,"f")}_thenUnwrap(e){return new t$(eR(this,a,"f"),this.responsePromise,async(t,s)=>tT(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eR(this,a,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}a=new WeakMap;class tL{constructor(e,t,s,r){o.set(this,void 0),eC(this,o,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eP("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eR(this,o,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(o=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tP extends t${constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tR(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tN extends tL{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tM extends tL{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var e;let t=this.getPaginatedItems(),s=t[t.length-1]?.id;return s?{...this.options,query:{..."object"!=typeof(e=this.options.query)?{}:e??{},after:s}}:null}}let tF=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tB(e,t,s){return tF(),new File(e,t??"unknown_file",s)}function tj(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tU=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tD=async(e,t)=>({...e,body:await tW(e.body,t)}),tq=new WeakMap,tW=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tq.get(t);if(s)return s;let r=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tq.set(t,r),r}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>tJ(s,e,t))),s},tz=e=>e instanceof Blob&&"name"in e,tH=e=>"object"==typeof e&&null!==e&&(e instanceof Response||tU(e)||tz(e)),tX=e=>{if(tH(e))return!0;if(Array.isArray(e))return e.some(tX);if(e&&"object"==typeof e){for(let t in e)if(tX(e[t]))return!0}return!1},tJ=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,tB([await s.blob()],tj(s)));else if(tU(s))e.append(t,tB([await new Response(tt(s)).blob()],tj(s)));else if(tz(s))e.append(t,s,tj(s));else if(Array.isArray(s))await Promise.all(s.map(s=>tJ(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,r])=>tJ(e,`${t}[${s}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},tK=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,tV=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&tK(e),tY=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function tG(e,t,s){if(tF(),tV(e=await e))return e instanceof File?e:tB([await e.arrayBuffer()],e.name);if(tY(e)){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tB(await tZ(r),t,s)}let r=await tZ(e);if(t||(t=tj(e)),!s?.type){let e=r.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tB(r,t,s)}async function tZ(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tK(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tU(e))for await(let s of e)t.push(...await tZ(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class tQ{constructor(e){this._client=e}}function t0(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let t1=Object.freeze(Object.create(null)),t2=((e=t0)=>function(t,...s){let r;if(1===t.length)return t[0];let n=!1,i=[],a=t.reduce((t,r,a)=>{/[?#]/.test(r)&&(n=!0);let o=s[a],l=(n?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??t1)??t1)?.toString)&&(l=o+"",i.push({start:t.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+r+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(o));)i.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let r=" ".repeat(s.start-e),n="^".repeat(s.length);return e=s.start+s.length,t+r+n},"");throw new eP(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(t0);class t3 extends tQ{list(e,t={},s){return this._client.getAPIList(t2`/chat/completions/${e}/messages`,tM,{query:t,...s})}}let t6=e=>e?.role==="assistant",t4=e=>e?.role==="tool";class t5{constructor(){l.add(this),this.controller=new AbortController,c.set(this,void 0),u.set(this,()=>{}),h.set(this,()=>{}),d.set(this,void 0),f.set(this,()=>{}),p.set(this,()=>{}),m.set(this,{}),g.set(this,!1),_.set(this,!1),y.set(this,!1),b.set(this,!1),eC(this,c,new Promise((e,t)=>{eC(this,u,e,"f"),eC(this,h,t,"f")}),"f"),eC(this,d,new Promise((e,t)=>{eC(this,f,e,"f"),eC(this,p,t,"f")}),"f"),eR(this,c,"f").catch(()=>{}),eR(this,d,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},eR(this,l,"m",w).bind(this))},0)}_connected(){this.ended||(eR(this,u,"f").call(this),this._emit("connect"))}get ended(){return eR(this,g,"f")}get errored(){return eR(this,_,"f")}get aborted(){return eR(this,y,"f")}abort(){this.controller.abort()}on(e,t){return(eR(this,m,"f")[e]||(eR(this,m,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eR(this,m,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(eR(this,m,"f")[e]||(eR(this,m,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eC(this,b,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eC(this,b,!0,"f"),await eR(this,d,"f")}_emit(e,...t){if(eR(this,g,"f"))return;"end"===e&&(eC(this,g,!0,"f"),eR(this,f,"f").call(this));let s=eR(this,m,"f")[e];if(s&&(eR(this,m,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eR(this,b,"f")||s?.length||Promise.reject(e),eR(this,h,"f").call(this,e),eR(this,p,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eR(this,b,"f")||s?.length||Promise.reject(e),eR(this,h,"f").call(this,e),eR(this,p,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function t8(e){return e?.$brand==="auto-parseable-response-format"}function t9(e){return e?.$brand==="auto-parseable-tool"}function t7(e,t){let s=e.choices.map(e=>{var s,r;if("length"===e.finish_reason)throw new eJ;if("content_filter"===e.finish_reason)throw new eK;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let s=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:t9(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=t,r=e.message.content,s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(r):JSON.parse(r):null):null}}});return{...e,choices:s}}function se(e){return!!t8(e.response_format)||(e.tools?.some(e=>t9(e)||"function"===e.type&&!0===e.function.strict)??!1)}c=new WeakMap,u=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,_=new WeakMap,y=new WeakMap,b=new WeakMap,l=new WeakSet,w=function(e){if(eC(this,_,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new eM),e instanceof eM)return eC(this,y,!0,"f"),this._emit("abort",e);if(e instanceof eP)return this._emit("error",e);if(e instanceof Error){let t=new eP(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eP(String(e)))};class st extends t5{constructor(){super(...arguments),v.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),t4(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(t6(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eP("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eR(this,v,"m",x).call(this)}async finalMessage(){return await this.done(),eR(this,v,"m",S).call(this)}async finalFunctionToolCall(){return await this.done(),eR(this,v,"m",k).call(this)}async finalFunctionToolCallResult(){return await this.done(),eR(this,v,"m",A).call(this)}async totalUsage(){return await this.done(),eR(this,v,"m",E).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=eR(this,v,"m",S).call(this);t&&this._emit("finalMessage",t);let s=eR(this,v,"m",x).call(this);s&&this._emit("finalContent",s);let r=eR(this,v,"m",k).call(this);r&&this._emit("finalFunctionToolCall",r);let n=eR(this,v,"m",A).call(this);null!=n&&this._emit("finalFunctionToolCallResult",n),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eR(this,v,"m",E).call(this))}async _createChatCompletion(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eR(this,v,"m",I).call(this,t);let n=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(t7(n,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let r="tool",{tool_choice:n="auto",stream:i,...a}=t,o="string"!=typeof n&&n?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(t9(e)){if(!e.$callback)throw new eP("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);let h="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:n,tools:h,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new eP("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:n,arguments:i}=e.function,a=u[n];if(a){if(o&&o!==n){let e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:s,content:e});continue}try{t="function"==typeof a.parse?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:r,tool_call_id:s,content:e});continue}let l=await a.function(t,this),c=eR(this,v,"m",O).call(this,l);if(this._addMessage({role:r,tool_call_id:s,content:c}),o)return}}}}v=new WeakSet,x=function(){return eR(this,v,"m",S).call(this).content??null},S=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(t6(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eP("stream ended without producing a ChatCompletionMessage with role=assistant")},k=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t6(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},A=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t4(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},E=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},I=function(e){if(null!=e.n&&e.n>1)throw new eP("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},O=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class ss extends st{static runTools(e,t,s){let r=new ss,n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,n)),r}_addMessage(e,t=!0){super._addMessage(e,t),t6(e)&&e.content&&this._emit("content",e.content)}}let sr={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class sn extends Error{}class si extends Error{}let sa=(e,t)=>{let s=e.length,r=0,n=e=>{throw new sn(`${e} at position ${r}`)},i=e=>{throw new si(`${e} at position ${r}`)},a=()=>(h(),r>=s&&n("Unexpected end of input"),'"'===e[r])?o():"{"===e[r]?l():"["===e[r]?c():"null"===e.substring(r,r+4)||sr.NULL&t&&s-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||sr.BOOL&t&&s-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||sr.BOOL&t&&s-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||sr.INFINITY&t&&s-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||sr.MINUS_INFINITY&t&&1<s-r&&s-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||sr.NAN&t&&s-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u(),o=()=>{let a=r,o=!1;for(r++;r<s&&('"'!==e[r]||o&&"\\"===e[r-1]);)o="\\"===e[r]&&!o,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(a,++r-Number(o)))}catch(e){i(String(e))}else if(sr.STR&t)try{return JSON.parse(e.substring(a,r-Number(o))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}n("Unterminated string literal")},l=()=>{r++,h();let i={};try{for(;"}"!==e[r];){if(h(),r>=s&&sr.OBJ&t)return i;let n=o();h(),r++;try{let e=a();Object.defineProperty(i,n,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(sr.OBJ&t)return i;throw e}h(),","===e[r]&&r++}}catch(e){if(sr.OBJ&t)return i;n("Expected '}' at end of object")}return r++,i},c=()=>{r++;let s=[];try{for(;"]"!==e[r];)s.push(a()),h(),","===e[r]&&r++}catch(e){if(sr.ARR&t)return s;n("Expected ']' at end of array")}return r++,s},u=()=>{if(0===r){"-"===e&&sr.NUM&t&&n("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(sr.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}i(String(s))}}let a=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=s||sr.NUM&t||n("Unterminated number literal");try{return JSON.parse(e.substring(a,r))}catch(s){"-"===e.substring(a,r)&&sr.NUM&t&&n("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){i(String(e))}}},h=()=>{for(;r<s&&" \n\r	".includes(e[r]);)r++};return a()},so=e=>(function(e,t=sr.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return sa(e.trim(),t)})(e,sr.ALL^sr.NUM);class sl extends st{constructor(e){super(),C.add(this),R.set(this,void 0),T.set(this,void 0),$.set(this,void 0),eC(this,R,e,"f"),eC(this,T,[],"f")}get currentChatCompletionSnapshot(){return eR(this,$,"f")}static fromReadableStream(e){let t=new sl(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let r=new sl(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,s){super._createChatCompletion;let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eR(this,C,"m",L).call(this);let n=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),n))eR(this,C,"m",N).call(this,e);if(n.controller.signal?.aborted)throw new eM;return this._addChatCompletion(eR(this,C,"m",B).call(this))}async _fromReadableStream(e,t){let s;let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eR(this,C,"m",L).call(this),this._connected();let n=tE.fromReadableStream(e,this.controller);for await(let e of n)s&&s!==e.id&&this._addChatCompletion(eR(this,C,"m",B).call(this)),eR(this,C,"m",N).call(this,e),s=e.id;if(n.controller.signal?.aborted)throw new eM;return this._addChatCompletion(eR(this,C,"m",B).call(this))}[(R=new WeakMap,T=new WeakMap,$=new WeakMap,C=new WeakSet,L=function(){this.ended||eC(this,$,void 0,"f")},P=function(e){let t=eR(this,T,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},eR(this,T,"f")[e.index]=t),t},N=function(e){if(this.ended)return;let t=eR(this,C,"m",U).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let r=eR(this,C,"m",P).call(this,e);for(let t of(e.finish_reason&&(eR(this,C,"m",F).call(this,e),null!=r.current_tool_call_index&&eR(this,C,"m",M).call(this,e,r.current_tool_call_index)),s.delta.tool_calls??[]))r.current_tool_call_index!==t.index&&(eR(this,C,"m",F).call(this,e),null!=r.current_tool_call_index&&eR(this,C,"m",M).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):s?.type)}}},M=function(e,t){if(eR(this,C,"m",P).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=eR(this,R,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:t9(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},F=function(e){let t=eR(this,C,"m",P).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=eR(this,C,"m",j).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},B=function(){if(this.ended)throw new eP("stream has ended, this shouldn't happen");let e=eR(this,$,"f");if(!e)throw new eP("request ended without sending any chunks");return eC(this,$,void 0,"f"),eC(this,T,[],"f"),function(e,t){var s;let{id:r,choices:n,created:i,model:a,system_fingerprint:o,...l}=e;return s={...l,id:r,choices:n.map(({message:t,finish_reason:s,index:r,logprobs:n,...i})=>{if(!s)throw new eP(`missing finish_reason for choice ${r}`);let{content:a=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new eP(`missing role for choice ${r}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eP(`missing function_call.arguments for choice ${r}`);if(!l)throw new eP(`missing function_call.name for choice ${r}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:s,index:r,logprobs:n}}return l?{...i,index:r,finish_reason:s,logprobs:n,message:{...c,role:u,content:a,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:n,type:i,id:a,...o}=t,{arguments:l,name:c,...u}=n||{};if(null==a)throw new eP(`missing choices[${r}].tool_calls[${s}].id
${sc(e)}`);if(null==i)throw new eP(`missing choices[${r}].tool_calls[${s}].type
${sc(e)}`);if(null==c)throw new eP(`missing choices[${r}].tool_calls[${s}].function.name
${sc(e)}`);if(null==l)throw new eP(`missing choices[${r}].tool_calls[${s}].function.arguments
${sc(e)}`);return{...o,id:a,type:i,function:{...u,name:c,arguments:l}}})}}:{...i,message:{...c,content:a,role:u,refusal:t.refusal??null},finish_reason:s,index:r,logprobs:n}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&se(t)?t7(s,t):{...s,choices:s.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,eR(this,R,"f"))},j=function(){let e=eR(this,R,"f")?.response_format;return t8(e)?e:null},U=function(e){var t,s,r,n;let i=eR(this,$,"f"),{choices:a,...o}=e;for(let{delta:a,finish_reason:l,index:c,logprobs:u=null,...h}of(i?Object.assign(i,o):i=eC(this,$,{...o,choices:[]},"f"),e.choices)){let e=i.choices[c];if(e||(e=i.choices[c]={finish_reason:l,index:c,message:{},logprobs:u,...h}),u){if(e.logprobs){let{content:r,refusal:n,...i}=u;Object.assign(e.logprobs,i),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),n&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...n))}else e.logprobs=Object.assign({},u)}if(l&&(e.finish_reason=l,eR(this,R,"f")&&se(eR(this,R,"f")))){if("length"===l)throw new eJ;if("content_filter"===l)throw new eK}if(Object.assign(e,h),!a)continue;let{content:o,refusal:d,function_call:f,role:p,tool_calls:m,...g}=a;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&eR(this,C,"m",j).call(this)&&(e.message.parsed=so(e.message.content))),m)for(let{index:t,id:s,type:r,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(n=e.message.tool_calls)[t]??(n[t]={});Object.assign(o,a),s&&(o.id=s),r&&(o.type=r),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e)return!1;let s=e.tools?.find(e=>e.function?.name===t.function.name);return t9(s)||s?.function.strict||!1}(eR(this,R,"f"),o)&&(o.function.parsed_arguments=so(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tE(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sc(e){return JSON.stringify(e)}class su extends sl{static fromReadableStream(e){let t=new su(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let r=new su(t),n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,n)),r}}class sh extends tQ{constructor(){super(...arguments),this.messages=new t3(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(t2`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(t2`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",tM,{query:e,...t})}delete(e,t){return this._client.delete(t2`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(let t of e??[]){if("function"!==t.type)throw new eP(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eP(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>t7(t,e))}runTools(e,t){return e.stream?su.runTools(this._client,e,t):ss.runTools(this._client,e,t)}stream(e,t){return sl.createChatCompletion(this._client,e,t)}}sh.Messages=t3;class sd extends tQ{constructor(){super(...arguments),this.completions=new sh(this._client)}}sd.Completions=sh;let sf=Symbol("brand.privateNullableHeaders"),sp=e=>{let t=new Headers,s=new Set;for(let r of e){let e=new Set;for(let[n,i]of function*(e){let t;if(!e)return;if(sf in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let r of(e instanceof Headers?t=e.entries():eQ(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=eQ(r[1])?r[1]:[r[1]],n=!1;for(let r of t)void 0!==r&&(s&&!n&&(n=!0,yield[e,null]),yield[e,r])}}(r)){let r=n.toLowerCase();e.has(r)||(t.delete(n),e.add(r)),null===i?(t.delete(n),s.add(r)):(t.append(n,i),s.delete(r))}}return{[sf]:!0,values:t,nulls:s}};class sm extends tQ{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:sp([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class sg extends tQ{create(e,t){return this._client.post("/audio/transcriptions",tD({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class s_ extends tQ{create(e,t){return this._client.post("/audio/translations",tD({body:e,...t,__metadata:{model:e.model}},this._client))}}class sy extends tQ{constructor(){super(...arguments),this.transcriptions=new sg(this._client),this.translations=new s_(this._client),this.speech=new sm(this._client)}}sy.Transcriptions=sg,sy.Translations=s_,sy.Speech=sm;class sb extends tQ{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(t2`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",tM,{query:e,...t})}cancel(e,t){return this._client.post(t2`/batches/${e}/cancel`,t)}}class sw extends tQ{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t2`/assistants/${e}`,{...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t2`/assistants/${e}`,{body:t,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",tM,{query:e,...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(t2`/assistants/${e}`,{...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sv extends tQ{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sx extends tQ{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sS extends tQ{constructor(){super(...arguments),this.sessions=new sv(this._client),this.transcriptionSessions=new sx(this._client)}}sS.Sessions=sv,sS.TranscriptionSessions=sx;class sk extends tQ{create(e,t,s){return this._client.post(t2`/threads/${e}/messages`,{body:t,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:r}=t;return this._client.get(t2`/threads/${r}/messages/${e}`,{...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:r,...n}=t;return this._client.post(t2`/threads/${r}/messages/${e}`,{body:n,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t2`/threads/${e}/messages`,tM,{query:t,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:r}=t;return this._client.delete(t2`/threads/${r}/messages/${e}`,{...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sA extends tQ{retrieve(e,t,s){let{thread_id:r,run_id:n,...i}=t;return this._client.get(t2`/threads/${r}/runs/${n}/steps/${e}`,{query:i,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:r,...n}=t;return this._client.getAPIList(t2`/threads/${r}/runs/${e}/steps`,tM,{query:n,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let sE=e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,r=new Uint8Array(s);for(let e=0;e<s;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}},sI=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class sO extends t5{constructor(){super(...arguments),D.add(this),W.set(this,[]),z.set(this,{}),H.set(this,{}),X.set(this,void 0),J.set(this,void 0),K.set(this,void 0),V.set(this,void 0),Y.set(this,void 0),G.set(this,void 0),Z.set(this,void 0),Q.set(this,void 0),ee.set(this,void 0)}[(W=new WeakMap,z=new WeakMap,H=new WeakMap,X=new WeakMap,J=new WeakMap,K=new WeakMap,V=new WeakMap,Y=new WeakMap,G=new WeakMap,Z=new WeakMap,Q=new WeakMap,ee=new WeakMap,D=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new q;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let r=tE.fromReadableStream(e,this.controller);for await(let e of r)eR(this,D,"m",et).call(this,e);if(r.controller.signal?.aborted)throw new eM;return this._addRun(eR(this,D,"m",es).call(this))}toReadableStream(){return new tE(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,r){let n=new q;return n._run(()=>n._runToolAssistantStream(e,t,s,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createToolAssistantStream(e,t,s,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.submitToolOutputs(t,i,{...r,signal:this.controller.signal});for await(let e of(this._connected(),a))eR(this,D,"m",et).call(this,e);if(a.controller.signal?.aborted)throw new eM;return this._addRun(eR(this,D,"m",es).call(this))}static createThreadAssistantStream(e,t,s){let r=new q;return r._run(()=>r._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,s,r){let n=new q;return n._run(()=>n._runAssistantStream(e,t,s,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}currentEvent(){return eR(this,Z,"f")}currentRun(){return eR(this,Q,"f")}currentMessageSnapshot(){return eR(this,X,"f")}currentRunStepSnapshot(){return eR(this,ee,"f")}async finalRunSteps(){return await this.done(),Object.values(eR(this,z,"f"))}async finalMessages(){return await this.done(),Object.values(eR(this,H,"f"))}async finalRun(){if(await this.done(),!eR(this,J,"f"))throw Error("Final run was not received.");return eR(this,J,"f")}async _createThreadAssistantStream(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let n={...t,stream:!0},i=await e.createAndRun(n,{...s,signal:this.controller.signal});for await(let e of(this._connected(),i))eR(this,D,"m",et).call(this,e);if(i.controller.signal?.aborted)throw new eM;return this._addRun(eR(this,D,"m",es).call(this))}async _createAssistantStream(e,t,s,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.create(t,i,{...r,signal:this.controller.signal});for await(let e of(this._connected(),a))eR(this,D,"m",et).call(this,e);if(a.controller.signal?.aborted)throw new eM;return this._addRun(eR(this,D,"m",es).call(this))}static accumulateDelta(e,t){for(let[s,r]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=r;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=r;continue}if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else if(e0(t)&&e0(r))t=this.accumulateDelta(t,r);else if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...r);continue}for(let e of r){if(!e0(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let r=t[s];null==r?t.push(e):t[s]=this.accumulateDelta(r,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${r}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,r){return await this._createAssistantStream(t,e,s,r)}async _runToolAssistantStream(e,t,s,r){return await this._createToolAssistantStream(t,e,s,r)}}q=sO,et=function(e){if(!this.ended)switch(eC(this,Z,e,"f"),eR(this,D,"m",ei).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":eR(this,D,"m",ec).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eR(this,D,"m",en).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":eR(this,D,"m",er).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},es=function(){if(this.ended)throw new eP("stream has ended, this shouldn't happen");if(!eR(this,J,"f"))throw Error("Final run has not been received");return eR(this,J,"f")},er=function(e){let[t,s]=eR(this,D,"m",eo).call(this,e,eR(this,X,"f"));for(let e of(eC(this,X,t,"f"),eR(this,H,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,r=t.content[s.index];if(r&&"text"==r.type)this._emit("textDelta",e,r.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=eR(this,K,"f")){if(eR(this,V,"f"))switch(eR(this,V,"f").type){case"text":this._emit("textDone",eR(this,V,"f").text,eR(this,X,"f"));break;case"image_file":this._emit("imageFileDone",eR(this,V,"f").image_file,eR(this,X,"f"))}eC(this,K,s.index,"f")}eC(this,V,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==eR(this,K,"f")){let t=e.data.content[eR(this,K,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,eR(this,X,"f"));break;case"text":this._emit("textDone",t.text,eR(this,X,"f"))}}eR(this,X,"f")&&this._emit("messageDone",e.data),eC(this,X,void 0,"f")}},en=function(e){let t=eR(this,D,"m",ea).call(this,e);switch(eC(this,ee,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==eR(this,Y,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(eR(this,G,"f")&&this._emit("toolCallDone",eR(this,G,"f")),eC(this,Y,e.index,"f"),eC(this,G,t.step_details.tool_calls[e.index],"f"),eR(this,G,"f")&&this._emit("toolCallCreated",eR(this,G,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eC(this,ee,void 0,"f"),"tool_calls"==e.data.step_details.type&&eR(this,G,"f")&&(this._emit("toolCallDone",eR(this,G,"f")),eC(this,G,void 0,"f")),this._emit("runStepDone",e.data,t)}},ei=function(e){eR(this,W,"f").push(e),this._emit("event",e)},ea=function(e){switch(e.event){case"thread.run.step.created":return eR(this,z,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=eR(this,z,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let r=q.accumulateDelta(t,s.delta);eR(this,z,"f")[e.data.id]=r}return eR(this,z,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":eR(this,z,"f")[e.data.id]=e.data}if(eR(this,z,"f")[e.data.id])return eR(this,z,"f")[e.data.id];throw Error("No snapshot available")},eo=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(let e of r.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=eR(this,D,"m",el).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},el=function(e,t){return q.accumulateDelta(t,e)},ec=function(e){switch(eC(this,Q,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":eC(this,J,e.data,"f"),eR(this,G,"f")&&(this._emit("toolCallDone",eR(this,G,"f")),eC(this,G,void 0,"f"))}};class sC extends tQ{constructor(){super(...arguments),this.steps=new sA(this._client)}create(e,t,s){let{include:r,...n}=t;return this._client.post(t2`/threads/${e}/runs`,{query:{include:r},body:n,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:r}=t;return this._client.get(t2`/threads/${r}/runs/${e}`,{...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:r,...n}=t;return this._client.post(t2`/threads/${r}/runs/${e}`,{body:n,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t2`/threads/${e}/runs`,tM,{query:t,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:r}=t;return this._client.post(t2`/threads/${r}/runs/${e}/cancel`,{...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let r=await this.create(e,t,s);return await this.poll(r.id,{thread_id:e},s)}createAndStream(e,t,s){return sO.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let r=sp([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...r}}).withResponse();switch(n.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e3(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return n}}}stream(e,t,s){return sO.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:r,...n}=t;return this._client.post(t2`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:n,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let r=await this.submitToolOutputs(e,t,s);return await this.poll(r.id,t,s)}submitToolOutputsStream(e,t,s){return sO.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sC.Steps=sA;class sR extends tQ{constructor(){super(...arguments),this.runs=new sC(this._client),this.messages=new sk(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t2`/threads/${e}`,{...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t2`/threads/${e}`,{body:t,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(t2`/threads/${e}`,{...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return sO.createThreadAssistantStream(e,this._client.beta.threads,t)}}sR.Runs=sC,sR.Messages=sk;class sT extends tQ{constructor(){super(...arguments),this.realtime=new sS(this._client),this.assistants=new sw(this._client),this.threads=new sR(this._client)}}sT.Realtime=sS,sT.Assistants=sw,sT.Threads=sR;class s$ extends tQ{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sL extends tQ{retrieve(e,t,s){let{container_id:r}=t;return this._client.get(t2`/containers/${r}/files/${e}/content`,{...s,headers:sp([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sP extends tQ{constructor(){super(...arguments),this.content=new sL(this._client)}create(e,t,s){return this._client.post(t2`/containers/${e}/files`,tD({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:r}=t;return this._client.get(t2`/containers/${r}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(t2`/containers/${e}/files`,tM,{query:t,...s})}delete(e,t,s){let{container_id:r}=t;return this._client.delete(t2`/containers/${r}/files/${e}`,{...s,headers:sp([{Accept:"*/*"},s?.headers])})}}sP.Content=sL;class sN extends tQ{constructor(){super(...arguments),this.files=new sP(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(t2`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",tM,{query:e,...t})}delete(e,t){return this._client.delete(t2`/containers/${e}`,{...t,headers:sp([{Accept:"*/*"},t?.headers])})}}sN.Files=sP;class sM extends tQ{create(e,t){let s=!!e.encoding_format,r=s?e.encoding_format:"base64";s&&tk(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let n=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return s?n:(tk(this._client).debug("embeddings/decoding base64 embeddings from base64"),n._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=sE(t)}),e)))}}class sF extends tQ{retrieve(e,t,s){let{eval_id:r,run_id:n}=t;return this._client.get(t2`/evals/${r}/runs/${n}/output_items/${e}`,s)}list(e,t,s){let{eval_id:r,...n}=t;return this._client.getAPIList(t2`/evals/${r}/runs/${e}/output_items`,tM,{query:n,...s})}}class sB extends tQ{constructor(){super(...arguments),this.outputItems=new sF(this._client)}create(e,t,s){return this._client.post(t2`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:r}=t;return this._client.get(t2`/evals/${r}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(t2`/evals/${e}/runs`,tM,{query:t,...s})}delete(e,t,s){let{eval_id:r}=t;return this._client.delete(t2`/evals/${r}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:r}=t;return this._client.post(t2`/evals/${r}/runs/${e}`,s)}}sB.OutputItems=sF;class sj extends tQ{constructor(){super(...arguments),this.runs=new sB(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(t2`/evals/${e}`,t)}update(e,t,s){return this._client.post(t2`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",tM,{query:e,...t})}delete(e,t){return this._client.delete(t2`/evals/${e}`,t)}}sj.Runs=sB;class sU extends tQ{create(e,t){return this._client.post("/files",tD({body:e,...t},this._client))}retrieve(e,t){return this._client.get(t2`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",tM,{query:e,...t})}delete(e,t){return this._client.delete(t2`/files/${e}`,t)}content(e,t){return this._client.get(t2`/files/${e}/content`,{...t,headers:sp([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let r=new Set(["processed","error","deleted"]),n=Date.now(),i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await e3(t),i=await this.retrieve(e),Date.now()-n>s)throw new eB({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class sD extends tQ{}class sq extends tQ{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class sW extends tQ{constructor(){super(...arguments),this.graders=new sq(this._client)}}sW.Graders=sq;class sz extends tQ{create(e,t,s){return this._client.getAPIList(t2`/fine_tuning/checkpoints/${e}/permissions`,tN,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(t2`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:r}=t;return this._client.delete(t2`/fine_tuning/checkpoints/${r}/permissions/${e}`,s)}}class sH extends tQ{constructor(){super(...arguments),this.permissions=new sz(this._client)}}sH.Permissions=sz;class sX extends tQ{list(e,t={},s){return this._client.getAPIList(t2`/fine_tuning/jobs/${e}/checkpoints`,tM,{query:t,...s})}}class sJ extends tQ{constructor(){super(...arguments),this.checkpoints=new sX(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(t2`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",tM,{query:e,...t})}cancel(e,t){return this._client.post(t2`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(t2`/fine_tuning/jobs/${e}/events`,tM,{query:t,...s})}pause(e,t){return this._client.post(t2`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(t2`/fine_tuning/jobs/${e}/resume`,t)}}sJ.Checkpoints=sX;class sK extends tQ{constructor(){super(...arguments),this.methods=new sD(this._client),this.jobs=new sJ(this._client),this.checkpoints=new sH(this._client),this.alpha=new sW(this._client)}}sK.Methods=sD,sK.Jobs=sJ,sK.Checkpoints=sH,sK.Alpha=sW;class sV extends tQ{}class sY extends tQ{constructor(){super(...arguments),this.graderModels=new sV(this._client)}}sY.GraderModels=sV;class sG extends tQ{createVariation(e,t){return this._client.post("/images/variations",tD({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",tD({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class sZ extends tQ{retrieve(e,t){return this._client.get(t2`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",tN,e)}delete(e,t){return this._client.delete(t2`/models/${e}`,t)}}class sQ extends tQ{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function s0(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){let s=function(e,t){return e.find(e=>"function"===e.type&&e.name===t)}(e.tools??[],t.name);return{...t,...t,parsed_arguments:function(e){return e?.$brand==="auto-parseable-tool"}(s)?s.$parseRaw(t.arguments):s?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s,r;return"output_text"===e.type?{...e,parsed:(s=t,r=e.text,s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(r):JSON.parse(r))}:e});return{...e,content:s}}return e}),r=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||s1(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let e of r.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),r}function s1(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class s2 extends t5{constructor(e){super(),eu.add(this),eh.set(this,void 0),ed.set(this,void 0),ef.set(this,void 0),eC(this,eh,e,"f")}static createResponse(e,t,s){let r=new s2(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,s){let r;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eR(this,eu,"m",ep).call(this);let i=null;for await(let n of("response_id"in t?(r=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):r=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),r))eR(this,eu,"m",em).call(this,n,i);if(r.controller.signal?.aborted)throw new eM;return eR(this,eu,"m",eg).call(this)}[(eh=new WeakMap,ed=new WeakMap,ef=new WeakMap,eu=new WeakSet,ep=function(){this.ended||eC(this,ed,void 0,"f")},em=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},r=eR(this,eu,"m",e_).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=r.output[e.output_index];if(!t)throw new eP(`missing output at index ${e.output_index}`);if("message"===t.type){let r=t.content[e.content_index];if(!r)throw new eP(`missing content at index ${e.content_index}`);if("output_text"!==r.type)throw new eP(`expected content to be 'output_text', got ${r.type}`);s("response.output_text.delta",{...e,snapshot:r.text})}break}case"response.function_call_arguments.delta":{let t=r.output[e.output_index];if(!t)throw new eP(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},eg=function(){if(this.ended)throw new eP("stream has ended, this shouldn't happen");let e=eR(this,ed,"f");if(!e)throw new eP("request ended without sending any events");eC(this,ed,void 0,"f");let t=function(e,t){var s;return t&&(s=t,t8(s.text?.format))?s0(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,eR(this,eh,"f"));return eC(this,ef,t,"f"),t},e_=function(e){let t=eR(this,ed,"f");if(!t){if("response.created"!==e.type)throw new eP(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return eC(this,ed,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eP(`missing output at index ${e.output_index}`);"message"===s.type&&s.content.push(e.part);break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eP(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eP(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eP(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eP(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.completed":eC(this,ed,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=eR(this,ef,"f");if(!e)throw new eP("stream ended without producing a ChatCompletion");return e}}class s3 extends tQ{list(e,t={},s){return this._client.getAPIList(t2`/responses/${e}/input_items`,tM,{query:t,...s})}}class s6 extends tQ{constructor(){super(...arguments),this.inputItems=new s3(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s1(e),e))}retrieve(e,t={},s){return this._client.get(t2`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s1(e),e))}delete(e,t){return this._client.delete(t2`/responses/${e}`,{...t,headers:sp([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>s0(t,e))}stream(e,t){return s2.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(t2`/responses/${e}/cancel`,t)}}s6.InputItems=s3;class s4 extends tQ{create(e,t,s){return this._client.post(t2`/uploads/${e}/parts`,tD({body:t,...s},this._client))}}class s5 extends tQ{constructor(){super(...arguments),this.parts=new s4(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(t2`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(t2`/uploads/${e}/complete`,{body:t,...s})}}s5.Parts=s4;let s8=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let r=[];for(let e of t)"fulfilled"===e.status&&r.push(e.value);return r};class s9 extends tQ{create(e,t,s){return this._client.post(t2`/vector_stores/${e}/file_batches`,{body:t,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:r}=t;return this._client.get(t2`/vector_stores/${r}/file_batches/${e}`,{...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:r}=t;return this._client.post(t2`/vector_stores/${r}/file_batches/${e}/cancel`,{...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let r=await this.create(e,t);return await this.poll(e,r.id,s)}listFiles(e,t,s){let{vector_store_id:r,...n}=t;return this._client.getAPIList(t2`/vector_stores/${r}/file_batches/${e}/files`,tM,{query:n,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let r=sp([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:i}=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse();switch(n.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e3(a);break;case"failed":case"cancelled":case"completed":return n}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},r){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let n=Math.min(r?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...s];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},r);o.push(e.id)}}let c=Array(n).fill(a).map(l);return await s8(c),await this.createAndPoll(e,{file_ids:o})}}class s7 extends tQ{create(e,t,s){return this._client.post(t2`/vector_stores/${e}/files`,{body:t,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:r}=t;return this._client.get(t2`/vector_stores/${r}/files/${e}`,{...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:r,...n}=t;return this._client.post(t2`/vector_stores/${r}/files/${e}`,{body:n,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t2`/vector_stores/${e}/files`,tM,{query:t,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:r}=t;return this._client.delete(t2`/vector_stores/${r}/files/${e}`,{...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let r=await this.create(e,t,s);return await this.poll(e,r.id,s)}async poll(e,t,s){let r=sp([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let n=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse(),i=n.data;switch(i.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=n.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e3(a);break;case"failed":case"completed":return i}}}async upload(e,t,s){let r=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:r.id},s)}async uploadAndPoll(e,t,s){let r=await this.upload(e,t,s);return await this.poll(e,r.id,s)}content(e,t,s){let{vector_store_id:r}=t;return this._client.getAPIList(t2`/vector_stores/${r}/files/${e}/content`,tN,{...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class re extends tQ{constructor(){super(...arguments),this.files=new s7(this._client),this.fileBatches=new s9(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t2`/vector_stores/${e}`,{...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t2`/vector_stores/${e}`,{body:t,...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",tM,{query:e,...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(t2`/vector_stores/${e}`,{...t,headers:sp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(t2`/vector_stores/${e}/search`,tN,{body:t,method:"post",...s,headers:sp([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}re.Files=s7,re.FileBatches=s9;class rt extends tQ{constructor(){super(...arguments),ey.add(this)}async unwrap(e,t,s=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,s,r),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,r=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");eR(this,ey,"m",eb).call(this,s);let n=sp([t]).values,i=eR(this,ey,"m",ew).call(this,n,"webhook-signature"),a=eR(this,ey,"m",ew).call(this,n,"webhook-timestamp"),o=eR(this,ey,"m",ew).call(this,n,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new eV("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>r)throw new eV("Webhook timestamp is too old");if(l>c+r)throw new eV("Webhook timestamp is too new");let u=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),h=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=o?`${o}.${a}.${e}`:`${a}.${e}`,f=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of u)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",f,t,new TextEncoder().encode(d)))return}catch{continue}throw new eV("The given webhook signature does not match the expected signature")}}ey=new WeakSet,eb=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},ew=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s};class rs{constructor({baseURL:e=sI("OPENAI_BASE_URL"),apiKey:t=sI("OPENAI_API_KEY"),organization:s=sI("OPENAI_ORG_ID")??null,project:r=sI("OPENAI_PROJECT_ID")??null,webhookSecret:n=sI("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(ev.add(this),eS.set(this,void 0),this.completions=new s$(this),this.chat=new sd(this),this.embeddings=new sM(this),this.files=new sU(this),this.images=new sG(this),this.audio=new sy(this),this.moderations=new sQ(this),this.models=new sZ(this),this.fineTuning=new sK(this),this.graders=new sY(this),this.vectorStores=new re(this),this.webhooks=new rt(this),this.beta=new sT(this),this.batches=new sb(this),this.uploads=new s5(this),this.responses=new s6(this),this.evals=new sj(this),this.containers=new sN(this),void 0===t)throw new eP("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:s,project:r,webhookSecret:n,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&e4())throw new eP("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??ex.DEFAULT_TIMEOUT,this.logger=a.logger??console;let o="warn";this.logLevel=o,this.logLevel=tb(a.logLevel,"ClientOptions.logLevel",this)??tb(sI("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eC(this,eS,tn,"f"),this._options=a,this.apiKey=t,this.organization=s,this.project=r,this.webhookSecret=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return sp([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,r,n=e,i=function(e=tf){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||tf.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=ti;if(void 0!==e.format){if(!tl(to,e.format))throw TypeError("Unknown format option provided.");r=e.format}let n=to[r],i=tf.filter;if(("function"==typeof e.filter||eZ(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in th?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":tf.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||tf.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:tf.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:tf.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:tf.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?tf.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:tf.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:tf.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:tf.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:tf.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:tf.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:tf.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:tf.strictNullHandling}}(t);"function"==typeof i.filter?n=(0,i.filter)("",n):eZ(i.filter)&&(s=i.filter);let a=[];if("object"!=typeof n||null===n)return"";let o=th[i.arrayFormat],l="comma"===o&&i.commaRoundTrip;s||(s=Object.keys(n)),i.sort&&s.sort(i.sort);let c=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];(!i.skipNulls||null!==n[t])&&td(a,function e(t,s,r,n,i,a,o,l,c,u,h,d,f,p,m,g,_,y){var b,w;let v,x=t,S=y,k=0,A=!1;for(;void 0!==(S=S.get(tp))&&!A;){let e=S.get(t);if(k+=1,void 0!==e){if(e===k)throw RangeError("Cyclic object value");A=!0}void 0===S.get(tp)&&(k=0)}if("function"==typeof u?x=u(s,x):x instanceof Date?x=f?.(x):"comma"===r&&eZ(x)&&(x=tu(x,function(e){return e instanceof Date?f?.(e):e})),null===x){if(a)return c&&!g?c(s,tf.encoder,_,"key",p):s;x=""}if("string"==typeof(b=x)||"number"==typeof b||"boolean"==typeof b||"symbol"==typeof b||"bigint"==typeof b||(w=x)&&"object"==typeof w&&w.constructor&&w.constructor.isBuffer&&w.constructor.isBuffer(w)){if(c){let e=g?s:c(s,tf.encoder,_,"key",p);return[m?.(e)+"="+m?.(c(x,tf.encoder,_,"value",p))]}return[m?.(s)+"="+m?.(String(x))]}let E=[];if(void 0===x)return E;if("comma"===r&&eZ(x))g&&c&&(x=tu(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(eZ(u))v=u;else{let e=Object.keys(x);v=h?e.sort(h):e}let I=l?String(s).replace(/\./g,"%2E"):String(s),O=n&&eZ(x)&&1===x.length?I+"[]":I;if(i&&eZ(x)&&0===x.length)return O+"[]";for(let s=0;s<v.length;++s){let b=v[s],w="object"==typeof b&&void 0!==b.value?b.value:x[b];if(o&&null===w)continue;let S=d&&l?b.replace(/\./g,"%2E"):b,A=eZ(x)?"function"==typeof r?r(O,S):O:O+(d?"."+S:"["+S+"]");y.set(t,k);let I=new WeakMap;I.set(tp,y),td(E,e(w,A,r,n,i,a,o,l,"comma"===r&&g&&eZ(x)?null:c,u,h,d,f,p,m,g,_,I))}return E}(n[t],t,o,l,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}let u=a.join(i.delimiter),h=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${e6}`}defaultIdempotencyKey(){return`stainless-node-retry-${eT()}`}makeStatusError(e,t,s,r){return eN.generate(e,t,s,r)}buildURL(e,t,s){let r=!eR(this,ev,"m",ek).call(this)&&s||this.baseURL,n=new URL(eG(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new t$(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:n-t});await this.prepareRequest(i,{url:a,options:r});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,u=Date.now();if(tk(this).debug(`[${l}] sending request`,tA({retryOfRequestLogID:s,method:r.method,url:a,options:r,headers:i.headers})),r.signal?.aborted)throw new eM;let h=new AbortController,d=await this.fetchWithTimeout(a,i,o,h).catch(eL),f=Date.now();if(d instanceof Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new eM;let n=e$(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return tk(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),tk(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,tA({retryOfRequestLogID:s,url:a,durationMs:f-u,message:d.message})),this.retryRequest(r,t,s??l);if(tk(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),tk(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,tA({retryOfRequestLogID:s,url:a,durationMs:f-u,message:d.message})),n)throw new eB;throw new eF({cause:d})}let p=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${p}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${f-u}ms`;if(!d.ok){let e=this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await tr(d.body),tk(this).info(`${m} - ${e}`),tk(this).debug(`[${l}] response error (${e})`,tA({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-u})),this.retryRequest(r,t,s??l,d.headers)}let n=e?"error; no more retries left":"error; not retryable";tk(this).info(`${m} - ${n}`);let i=await d.text().catch(e=>eL(e).message),a=e2(i),o=a?void 0:i;throw tk(this).debug(`[${l}] response error (${n})`,tA({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-u})),this.makeStatusError(d.status,a,o,d.headers)}return tk(this).info(m),tk(this).debug(`[${l}] response start`,tA({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-u})),{response:d,options:r,controller:h,requestLogID:l,retryOfRequestLogID:s,startTime:u}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tP(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,r){let{signal:n,method:i,...a}=t||{};n&&n.addEventListener("abort",()=>r.abort());let o=setTimeout(()=>r.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,r){let n;let i=r?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(n=e)}let a=r?.get("retry-after");if(a&&!n){let e=parseFloat(a);n=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await e3(n),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:r,path:n,query:i,defaultBaseURL:a}=s,o=this.buildURL(n,i,a);"timeout"in s&&e1("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),u=this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:u,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:r}){let n={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey);let i=sp([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...e7(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=sp([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:tt(e)}:eR(this,eS,"f").call(this,{body:e,headers:s})}}ex=rs,eS=new WeakMap,ev=new WeakSet,ek=function(){return"https://api.openai.com/v1"!==this.baseURL},rs.OpenAI=ex,rs.DEFAULT_TIMEOUT=6e5,rs.OpenAIError=eP,rs.APIError=eN,rs.APIConnectionError=eF,rs.APIConnectionTimeoutError=eB,rs.APIUserAbortError=eM,rs.NotFoundError=eq,rs.ConflictError=eW,rs.RateLimitError=eH,rs.BadRequestError=ej,rs.AuthenticationError=eU,rs.InternalServerError=eX,rs.PermissionDeniedError=eD,rs.UnprocessableEntityError=ez,rs.InvalidWebhookSignatureError=eV,rs.toFile=tG,rs.Completions=s$,rs.Chat=sd,rs.Embeddings=sM,rs.Files=sU,rs.Images=sG,rs.Audio=sy,rs.Moderations=sQ,rs.Models=sZ,rs.FineTuning=sK,rs.Graders=sY,rs.VectorStores=re,rs.Webhooks=rt,rs.Beta=sT,rs.Batches=sb,rs.Uploads=s5,rs.Responses=s6,rs.Evals=sj,rs.Containers=sN},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1118:(e,t,s)=>{var r;e.exports=function(){if(!r){try{r=s(8794)("follow-redirects")}catch(e){}"function"!=typeof r&&(r=function(){})}r.apply(null,arguments)}},1584:(e,t,s)=>{var r=s(5624),n=function(){},i=global.Bare?queueMicrotask:process.nextTick.bind(process),a=function(e,t,s){if("function"==typeof t)return a(e,null,t);t||(t={}),s=r(s||n);var o=e._writableState,l=e._readableState,c=t.readable||!1!==t.readable&&e.readable,u=t.writable||!1!==t.writable&&e.writable,h=!1,d=function(){e.writable||f()},f=function(){u=!1,c||s.call(e)},p=function(){c=!1,u||s.call(e)},m=function(t){s.call(e,t?Error("exited with error code: "+t):null)},g=function(t){s.call(e,t)},_=function(){i(y)},y=function(){if(!h&&(c&&!(l&&l.ended&&!l.destroyed)||u&&!(o&&o.ended&&!o.destroyed)))return s.call(e,Error("premature close"))},b=function(){e.req.on("finish",f)};return e.setHeader&&"function"==typeof e.abort?(e.on("complete",f),e.on("abort",_),e.req?b():e.on("request",b)):u&&!o&&(e.on("end",d),e.on("close",d)),e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length&&e.on("exit",m),e.on("end",p),e.on("finish",f),!1!==t.error&&e.on("error",g),e.on("close",_),function(){h=!0,e.removeListener("complete",f),e.removeListener("abort",_),e.removeListener("request",b),e.req&&e.req.removeListener("finish",f),e.removeListener("end",d),e.removeListener("close",d),e.removeListener("finish",f),e.removeListener("exit",m),e.removeListener("end",p),e.removeListener("error",g),e.removeListener("close",_)}};e.exports=a},1630:e=>{"use strict";e.exports=require("http")},1704:(e,t,s)=>{let r=s(5945);e.exports=class{constructor(e){this.encoding=e}get remaining(){return 0}decode(e){return r.toString(e,this.encoding)}flush(){return""}}},1820:e=>{"use strict";e.exports=require("os")},2297:(e,t,s)=>{e.exports=function(e){function t(e){let s,n,i;let a=null;function o(...e){if(!o.enabled)return;let r=Number(new Date);o.diff=r-(s||r),o.prev=s,o.curr=r,s=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let n=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(s,r)=>{if("%%"===s)return"%";n++;let i=t.formatters[r];if("function"==typeof i){let t=e[n];s=i.call(o,t),e.splice(n,1),n--}return s}),t.formatArgs.call(o,e),(o.log||t.log).apply(o,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=r,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(n!==t.namespaces&&(n=t.namespaces,i=t.enabled(e)),i),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function r(e,s){let r=t(this.namespace+(void 0===s?":":s)+e);return r.log=this.log,r}function n(e,t){let s=0,r=0,n=-1,i=0;for(;s<e.length;)if(r<t.length&&(t[r]===e[s]||"*"===t[r]))"*"===t[r]?(n=r,i=s):s++,r++;else{if(-1===n)return!1;r=n+1,s=++i}for(;r<t.length&&"*"===t[r];)r++;return r===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){let e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){for(let s of(t.save(e),t.namespaces=e,t.names=[],t.skips=[],("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean)))"-"===s[0]?t.skips.push(s.slice(1)):t.names.push(s)},t.enabled=function(e){for(let s of t.skips)if(n(e,s))return!1;for(let s of t.names)if(n(e,s))return!0;return!1},t.humanize=s(4072),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(s=>{t[s]=e[s]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t)|0;return t.colors[Math.abs(s)%t.colors.length]},t.enable(t.load()),t}},2412:e=>{"use strict";e.exports=require("assert")},2754:(e,t,s)=>{t.extract=s(4271),t.pack=s(253)},2794:(e,t,s)=>{let r=s(5945);e.exports=class{constructor(){this.codePoint=0,this.bytesSeen=0,this.bytesNeeded=0,this.lowerBoundary=128,this.upperBoundary=191}get remaining(){return this.bytesSeen}decode(e){if(0===this.bytesNeeded){let t=!0;for(let s=Math.max(0,e.byteLength-4),r=e.byteLength;s<r&&t;s++)t=e[s]<=127;if(t)return r.toString(e,"utf8")}let t="";for(let s=0,r=e.byteLength;s<r;s++){let r=e[s];if(0===this.bytesNeeded){r<=127?t+=String.fromCharCode(r):(this.bytesSeen=1,r>=194&&r<=223?(this.bytesNeeded=2,this.codePoint=31&r):r>=224&&r<=239?(224===r?this.lowerBoundary=160:237===r&&(this.upperBoundary=159),this.bytesNeeded=3,this.codePoint=15&r):r>=240&&r<=244?(240===r&&(this.lowerBoundary=144),244===r&&(this.upperBoundary=143),this.bytesNeeded=4,this.codePoint=7&r):t+="");continue}if(r<this.lowerBoundary||r>this.upperBoundary){this.codePoint=0,this.bytesNeeded=0,this.bytesSeen=0,this.lowerBoundary=128,this.upperBoundary=191,t+="";continue}this.lowerBoundary=128,this.upperBoundary=191,this.codePoint=this.codePoint<<6|63&r,this.bytesSeen++,this.bytesSeen===this.bytesNeeded&&(t+=String.fromCodePoint(this.codePoint),this.codePoint=0,this.bytesNeeded=0,this.bytesSeen=0)}return t}flush(){let e=this.bytesNeeded>0?"":"";return this.codePoint=0,this.bytesNeeded=0,this.bytesSeen=0,this.lowerBoundary=128,this.upperBoundary=191,e}}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3215:(e,t,s)=>{"use strict";s.d(t,{A:()=>y});let r=require("node:fs"),n=require("node:os"),i=require("node:path"),a=require("node:url");var o=s(6373),l=s(9629);let c=(e,t)=>new Promise((s,n)=>{(0,r.access)(e,i=>{if(i){n(i);return}(0,r.symlink)(e,t,e=>{if(e){n(e);return}s()})})}),u=(e,t)=>new Promise((s,n)=>{let i=(0,r.createWriteStream)(t);i.once("error",n),o.https.get(e,e=>{if(200!==e.statusCode){i.close(),n(Error(`Unexpected status code: ${e.statusCode?.toFixed(0)??"UNK"}.`));return}e.pipe(i),i.once("finish",()=>{i.close(),s()}),e.once("error",e=>{i.close(),n(e)})}).on("error",e=>{i.close(),n(e)})}),h=e=>{try{return new URL(e),!0}catch{return!1}},d=e=>{let t=process.env.AWS_EXECUTION_ENV??"",s=process.env.AWS_LAMBDA_JS_RUNTIME??"",r=process.env.CODEBUILD_BUILD_IMAGE??"";return!!(t.includes("20.x")||t.includes("22.x")||s.includes("20.x")||s.includes("22.x")||r.includes("nodejs20")||r.includes("nodejs22"))||!!process.env.VERCEL&&!!(e>=20)},f=async e=>{new URL(e).maxBodyLength=0x3c00000;let t=(0,i.join)((0,n.tmpdir)(),"chromium-pack");return new Promise((s,n)=>{let i=(0,l.o)(t),a=e=>{(0,r.rm)(t,{force:!0,recursive:!0},()=>{n(e)})};i.once("error",a),i.once("finish",()=>{s(t)});let c=o.https.get(e,e=>{if(200!==e.statusCode){n(Error(`Unexpected status code: ${e.statusCode?.toFixed(0)??"UNK"}.`));return}e.pipe(i),e.once("error",a)});c.once("error",a),c.setTimeout(6e4,()=>{c.destroy(),a(Error("Request timeout"))})})},p=require("node:zlib"),m=e=>{let t=e.includes("swiftshader")?(0,n.tmpdir)():(0,i.join)((0,n.tmpdir)(),(0,i.basename)(e).replace(/\.(?:t(?:ar(?:\.(?:br|gz))?|br|gz)|br|gz)$/i,""));return new Promise((s,n)=>{let i;if(e.includes("swiftshader")){if((0,r.existsSync)(`${t}/libGLESv2.so`)){s(t);return}}else if((0,r.existsSync)(t)){s(t);return}let a=/br$/i.test(e),o=/gz$/i.test(e),c=/\.t(?:ar(?:\.(?:br|gz))?|br|gz)$/i.test(e),u=(0,r.createReadStream)(e,{highWaterMark:4194304}),h=e=>{n(e)};if(u.once("error",h),c?(i=(0,l.o)(t)).once("finish",()=>{s(t)}):(i=(0,r.createWriteStream)(t,{mode:448})).once("close",()=>{s(t)}),i.once("error",h),a||o){let e=a?(0,p.createBrotliDecompress)({chunkSize:2097152}):(0,p.createUnzip)({chunkSize:2097152});e.once("error",h),u.pipe(e).pipe(i)}else u.pipe(i)})},g=Number.parseInt(process.versions.node.split(".")[0]??"");d(g)&&(e=>{process.env.FONTCONFIG_PATH??=(0,i.join)((0,n.tmpdir)(),"fonts"),process.env.HOME??=(0,n.tmpdir)(),void 0===process.env.LD_LIBRARY_PATH?process.env.LD_LIBRARY_PATH=e:process.env.LD_LIBRARY_PATH.startsWith(e)||(process.env.LD_LIBRARY_PATH=[e,...new Set(process.env.LD_LIBRARY_PATH.split(":"))].join(":"))})((0,i.join)((0,n.tmpdir)(),"al2023","lib"));class _{static get args(){let e=["--ignore-gpu-blocklist","--in-process-gpu"];return this.graphics?e.push("--use-gl=angle","--use-angle=swiftshader","--enable-unsafe-swiftshader"):e.push("--disable-webgl"),["--ash-no-nudges","--disable-domain-reliability","--disable-print-preview","--disk-cache-size=33554432","--no-default-browser-check","--no-pings","--single-process","--font-render-hinting=none","--disable-features=AudioServiceOutOfProcess,IsolateOrigins,site-per-process","--enable-features=SharedArrayBuffer",...e,"--allow-running-insecure-content","--disable-setuid-sandbox","--disable-site-isolation-trials","--disable-web-security","--headless='shell'","--no-sandbox","--no-zygote"]}static get graphics(){return this.graphicsMode}static set setGraphicsMode(e){if("boolean"!=typeof e)throw TypeError(`Graphics mode must be a boolean, you entered '${String(e)}'`);this.graphicsMode=e}static graphicsMode=!0;static async executablePath(e){if((0,r.existsSync)((0,i.join)((0,n.tmpdir)(),"chromium")))return(0,i.join)((0,n.tmpdir)(),"chromium");if(e&&h(e))return this.executablePath(await f(e));if(e??=(0,i.join)((0,i.dirname)((0,a.fileURLToPath)("file:///Users/rolfbekkelund/Documents/Juvo%20Solutions/Repositories/UX-finall/UX-final/node_modules/@sparticuz/chromium-min/build/esm/paths.esm.js")),"..","..","bin"),!(0,r.existsSync)(e))throw Error(`The input directory "${e}" does not exist. Please provide the location of the brotli files.`);let t=[m((0,i.join)(e,"chromium.br")),m((0,i.join)(e,"fonts.tar.br")),m((0,i.join)(e,"swiftshader.tar.br"))];return d(g)&&t.push(m((0,i.join)(e,"al2023.tar.br"))),(await Promise.all(t)).shift()}static async font(e){let t=process.env.FONTCONFIG_PATH??(0,i.join)(process.env.HOME??(0,n.tmpdir)(),".fonts");(0,r.existsSync)(t)||(0,r.mkdirSync)(t),/^https?:\/\//i.test(e)||(e=`file://${e}`);let s=new a.URL(e),o=s.pathname.split("/").pop();if(!o)throw Error(`Invalid font name: ${s.pathname}`);let l=`${t}/${o}`;if((0,r.existsSync)(l))return o;if("file:"===s.protocol)try{return await c(s.pathname,l),o}catch(e){throw Error(`Failed to create symlink for font: ${JSON.stringify(e)}`)}else try{return await u(e,l),o}catch(e){throw Error(`Failed to download font: ${JSON.stringify(e)}`)}}}let y=_},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3432:e=>{e.exports=function e(t,s){if(t&&s)return e(t)(s);if("function"!=typeof t)throw TypeError("need wrapper function");return Object.keys(t).forEach(function(e){r[e]=t[e]}),r;function r(){for(var e=Array(arguments.length),s=0;s<e.length;s++)e[s]=arguments[s];var r=t.apply(this,e),n=e[e.length-1];return"function"==typeof r&&r!==n&&Object.keys(n).forEach(function(e){r[e]=n[e]}),r}}},3535:e=>{e.exports=class{constructor(e){if(!(e>0)||(e-1&e)!=0)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}}},3637:e=>{"use strict";e.exports=(e,t=process.argv)=>{let s=e.startsWith("-")?"":1===e.length?"-":"--",r=t.indexOf(s+e),n=t.indexOf("--");return -1!==r&&(-1===n||r<n)}},3665:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.d(t,{UW:()=>h});var n=s(8856),i=s(9021),a=s.n(i),o=s(3873),l=s.n(o),c=s(3215),u=e([n]);async function h(e,t="public/screenshots"){let s=await n.default.launch({args:c.A.args,executablePath:await c.A.executablePath(),headless:!0});try{a().existsSync(t)||a().mkdirSync(t,{recursive:!0});let r=new Date().toISOString().replace(/[:.]/g,"-"),n=`desktop-${r}.png`,i=`mobile-${r}.png`,o=l().join(t,n),c=l().join(t,i),u=await s.newPage();await u.setViewport({width:1920,height:1080});try{await u.goto(e,{waitUntil:"networkidle2",timeout:3e4}),await u.screenshot({path:o,fullPage:!0})}catch(e){throw console.warn("Desktop screenshot failed:",e),e}finally{await u.close()}let h=await s.newPage();await h.setViewport({width:375,height:667});try{await h.goto(e,{waitUntil:"networkidle2",timeout:3e4}),await h.screenshot({path:c,fullPage:!0})}catch(e){throw console.warn("Mobile screenshot failed:",e),e}finally{await h.close()}return{desktop:`/screenshots/${n}`,mobile:`/screenshots/${i}`}}finally{await s.close()}}n=(u.then?(await u)():u)[0],r()}catch(e){r(e)}})},3860:(e,t,s)=>{let r=s(5945),n=r.from([117,115,116,97,114,0]),i=r.from([48,48]),a=r.from([117,115,116,97,114,32]),o=r.from([32,0]);function l(e,t,s,r){for(;s<r;s++)if(e[s]===t)return s;return r}function c(e){let t=256;for(let s=0;s<148;s++)t+=e[s];for(let s=156;s<512;s++)t+=e[s];return t}function u(e,t){return(e=e.toString(8)).length>t?"7777777777777777777".slice(0,t)+" ":"0000000000000000000".slice(0,t-e.length)+e+" "}function h(e,t,s){if(128&(e=e.subarray(t,t+s))[t=0])return function(e){let t,s;if(128===e[0])t=!0;else{if(255!==e[0])return null;t=!1}let r=[];for(s=e.length-1;s>0;s--){let n=e[s];t?r.push(n):r.push(255-n)}let n=0,i=r.length;for(s=0;s<i;s++)n+=r[s]*Math.pow(256,s);return t?n:-1*n}(e);{for(var n,i,a;t<e.length&&32===e[t];)t++;let s=(n=l(e,32,t,e.length),i=e.length,a=e.length,"number"!=typeof n?a:(n=~~n)>=i?i:n>=0||(n+=i)>=0?n:0);for(;t<s&&0===e[t];)t++;return s===t?0:parseInt(r.toString(e.subarray(t,s)),8)}}function d(e,t,s,n){return r.toString(e.subarray(t,l(e,0,t,t+s)),n)}function f(e){let t=r.byteLength(e),s=Math.floor(Math.log(t)/Math.log(10))+1;return t+s>=Math.pow(10,s)&&s++,t+s+e}t.decodeLongPath=function(e,t){return d(e,0,e.length,t)},t.encodePax=function(e){let t="";e.name&&(t+=f(" path="+e.name+"\n")),e.linkname&&(t+=f(" linkpath="+e.linkname+"\n"));let s=e.pax;if(s)for(let e in s)t+=f(" "+e+"="+s[e]+"\n");return r.from(t)},t.decodePax=function(e){let t={};for(;e.length;){let s=0;for(;s<e.length&&32!==e[s];)s++;let n=parseInt(r.toString(e.subarray(0,s)),10);if(!n)break;let i=r.toString(e.subarray(s+1,n-1)),a=i.indexOf("=");if(-1===a)break;t[i.slice(0,a)]=i.slice(a+1),e=e.subarray(n)}return t},t.encode=function(e){var t,s,a;let o=r.alloc(512),l=e.name,h="";if(5===e.typeflag&&"/"!==l[l.length-1]&&(l+="/"),r.byteLength(l)!==l.length)return null;for(;r.byteLength(l)>100;){let e=l.indexOf("/");if(-1===e)return null;h+=h?"/"+l.slice(0,e):l.slice(0,e),l=l.slice(e+1)}return r.byteLength(l)>100||r.byteLength(h)>155||e.linkname&&r.byteLength(e.linkname)>100?null:(r.write(o,l),r.write(o,u(4095&e.mode,6),100),r.write(o,u(e.uid,6),108),r.write(o,u(e.gid,6),116),t=e.size,s=o,a=124,t.toString(8).length>11?function(e,t,s){t[s]=128;for(let r=11;r>0;r--)t[s+r]=255&e,e=Math.floor(e/256)}(t,s,124):r.write(s,u(t,11),a),r.write(o,u(e.mtime.getTime()/1e3|0,11),136),o[156]=48+function(e){switch(e){case"file":break;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72}return 0}(e.type),e.linkname&&r.write(o,e.linkname,157),r.copy(n,o,257),r.copy(i,o,263),e.uname&&r.write(o,e.uname,265),e.gname&&r.write(o,e.gname,297),r.write(o,u(e.devmajor||0,6),329),r.write(o,u(e.devminor||0,6),337),h&&r.write(o,h,345),r.write(o,u(c(o),6),148),o)},t.decode=function(e,t,s){var i,l;let u=0===e[156]?0:e[156]-48,f=d(e,0,100,t),p=h(e,100,8),m=h(e,108,8),g=h(e,116,8),_=h(e,124,12),y=h(e,136,12),b=function(e){switch(e){case 0:return"file";case 1:return"link";case 2:return"symlink";case 3:return"character-device";case 4:return"block-device";case 5:return"directory";case 6:return"fifo";case 7:return"contiguous-file";case 72:return"pax-header";case 55:return"pax-global-header";case 27:return"gnu-long-link-path";case 28:case 30:return"gnu-long-path"}return null}(u),w=0===e[157]?null:d(e,157,100,t),v=d(e,265,32),x=d(e,297,32),S=h(e,329,8),k=h(e,337,8),A=c(e);if(256===A)return null;if(A!==h(e,148,8))throw Error("Invalid tar header. Maybe the tar is corrupted or it needs to be gunzipped?");if(i=e,r.equals(n,i.subarray(257,263)))e[345]&&(f=d(e,345,155,t)+"/"+f);else{if(l=e,r.equals(a,l.subarray(257,263))&&r.equals(o,l.subarray(263,265)));else if(!s)throw Error("Invalid tar header: unknown format.")}return 0===u&&f&&"/"===f[f.length-1]&&(u=5),{name:f,mode:p,uid:m,gid:g,size:_,mtime:new Date(1e3*y),type:b,linkname:w,uname:v,gname:x,devmajor:S,devminor:k,pax:null}}},3873:e=>{"use strict";e.exports=require("path")},3997:e=>{"use strict";e.exports=require("tty")},4072:e=>{function t(e,t,s,r){return Math.round(e/s)+" "+r+(t>=1.5*s?"s":"")}e.exports=function(e,s){s=s||{};var r,n,i,a,o=typeof e;if("string"===o&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return 864e5*s;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*s;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*s;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===o&&isFinite(e)){return s.long?(n=Math.abs(r=e))>=864e5?t(r,n,864e5,"day"):n>=36e5?t(r,n,36e5,"hour"):n>=6e4?t(r,n,6e4,"minute"):n>=1e3?t(r,n,1e3,"second"):r+" ms":(a=Math.abs(i=e))>=864e5?Math.round(i/864e5)+"d":a>=36e5?Math.round(i/36e5)+"h":a>=6e4?Math.round(i/6e4)+"m":a>=1e3?Math.round(i/1e3)+"s":i+"ms"}throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},4271:(e,t,s)=>{let{Writable:r,Readable:n,getStreamError:i}=s(6420),a=s(7031),o=s(5945),l=s(3860),c=o.alloc(0);class u{constructor(){this.buffered=0,this.shifted=0,this.queue=new a,this._offset=0}push(e){this.buffered+=e.byteLength,this.queue.push(e)}shiftFirst(e){return 0===this._buffered?null:this._next(e)}shift(e){if(e>this.buffered)return null;if(0===e)return c;let t=this._next(e);if(e===t.byteLength)return t;let s=[t];for(;(e-=t.byteLength)>0;)t=this._next(e),s.push(t);return o.concat(s)}_next(e){let t=this.queue.peek(),s=t.byteLength-this._offset;if(e>=s){let e=this._offset?t.subarray(this._offset,t.byteLength):t;return this.queue.shift(),this._offset=0,this.buffered-=s,this.shifted+=s,e}return this.buffered-=e,this.shifted+=e,t.subarray(this._offset,this._offset+=e)}}class h extends n{constructor(e,t,s){super(),this.header=t,this.offset=s,this._parent=e}_read(e){0===this.header.size&&this.push(null),this._parent._stream===this&&this._parent._update(),e(null)}_predestroy(){this._parent.destroy(i(this))}_detach(){this._parent._stream===this&&(this._parent._stream=null,this._parent._missing=p(this.header.size),this._parent._update())}_destroy(e){this._detach(),e(null)}}class d extends r{constructor(e){super(e),e||(e={}),this._buffer=new u,this._offset=0,this._header=null,this._stream=null,this._missing=0,this._longHeader=!1,this._callback=f,this._locked=!1,this._finished=!1,this._pax=null,this._paxGlobal=null,this._gnuLongPath=null,this._gnuLongLinkPath=null,this._filenameEncoding=e.filenameEncoding||"utf-8",this._allowUnknownFormat=!!e.allowUnknownFormat,this._unlockBound=this._unlock.bind(this)}_unlock(e){if(this._locked=!1,e){this.destroy(e),this._continueWrite(e);return}this._update()}_consumeHeader(){if(this._locked)return!1;this._offset=this._buffer.shifted;try{this._header=l.decode(this._buffer.shift(512),this._filenameEncoding,this._allowUnknownFormat)}catch(e){return this._continueWrite(e),!1}if(!this._header)return!0;switch(this._header.type){case"gnu-long-path":case"gnu-long-link-path":case"pax-global-header":case"pax-header":return this._longHeader=!0,this._missing=this._header.size,!0}return(this._locked=!0,this._applyLongHeaders(),0===this._header.size||"directory"===this._header.type)?this.emit("entry",this._header,this._createStream(),this._unlockBound):(this._stream=this._createStream(),this._missing=this._header.size,this.emit("entry",this._header,this._stream,this._unlockBound)),!0}_applyLongHeaders(){this._gnuLongPath&&(this._header.name=this._gnuLongPath,this._gnuLongPath=null),this._gnuLongLinkPath&&(this._header.linkname=this._gnuLongLinkPath,this._gnuLongLinkPath=null),this._pax&&(this._pax.path&&(this._header.name=this._pax.path),this._pax.linkpath&&(this._header.linkname=this._pax.linkpath),this._pax.size&&(this._header.size=parseInt(this._pax.size,10)),this._header.pax=this._pax,this._pax=null)}_decodeLongHeader(e){switch(this._header.type){case"gnu-long-path":this._gnuLongPath=l.decodeLongPath(e,this._filenameEncoding);break;case"gnu-long-link-path":this._gnuLongLinkPath=l.decodeLongPath(e,this._filenameEncoding);break;case"pax-global-header":this._paxGlobal=l.decodePax(e);break;case"pax-header":this._pax=null===this._paxGlobal?l.decodePax(e):Object.assign({},this._paxGlobal,l.decodePax(e))}}_consumeLongHeader(){this._longHeader=!1,this._missing=p(this._header.size);let e=this._buffer.shift(this._header.size);try{this._decodeLongHeader(e)}catch(e){return this._continueWrite(e),!1}return!0}_consumeStream(){let e=this._buffer.shiftFirst(this._missing);if(null===e)return!1;this._missing-=e.byteLength;let t=this._stream.push(e);return 0===this._missing?(this._stream.push(null),t&&this._stream._detach(),t&&!1===this._locked):t}_createStream(){return new h(this,this._header,this._offset)}_update(){for(;this._buffer.buffered>0&&!this.destroying;){if(this._missing>0){if(null!==this._stream){if(!1===this._consumeStream())return;continue}if(!0===this._longHeader){if(this._missing>this._buffer.buffered)break;if(!1===this._consumeLongHeader())return!1;continue}let e=this._buffer.shiftFirst(this._missing);null!==e&&(this._missing-=e.byteLength);continue}if(this._buffer.buffered<512)break;if(null!==this._stream||!1===this._consumeHeader())return}this._continueWrite(null)}_continueWrite(e){let t=this._callback;this._callback=f,t(e)}_write(e,t){this._callback=t,this._buffer.push(e),this._update()}_final(e){this._finished=0===this._missing&&0===this._buffer.buffered,e(this._finished?null:Error("Unexpected end of data"))}_predestroy(){this._continueWrite(null)}_destroy(e){this._stream&&this._stream.destroy(i(this)),e(null)}[Symbol.asyncIterator](){let e=null,t=null,s=null,r=null,n=null,i=this;return this.on("entry",function(e,i,a){n=a,i.on("error",f),t?(t({value:i,done:!1}),t=s=null):r=i}),this.on("error",t=>{e=t}),this.on("close",function(){a(e),t&&(e?s(e):t({value:void 0,done:!0}),t=s=null)}),{[Symbol.asyncIterator](){return this},next:()=>new Promise(o),return:()=>l(null),throw:e=>l(e)};function a(e){if(!n)return;let t=n;n=null,t(e)}function o(n,o){if(e)return o(e);if(r){n({value:r,done:!1}),r=null;return}t=n,s=o,a(null),i._finished&&t&&(t({value:void 0,done:!0}),t=s=null)}function l(e){return i.destroy(e),a(e),new Promise((t,s)=>{if(i.destroyed)return t({value:void 0,done:!0});i.once("close",function(){e?s(e):t({value:void 0,done:!0})})})}}}function f(){}function p(e){return(e&=511)&&512-e}e.exports=function(e){return new d(e)}},4571:(e,t,s)=>{let r={S_IFMT:61440,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960};try{e.exports=s(9021).constants||r}catch{e.exports=r}},4686:(e,t,s)=>{var r,n=s(5624),i=s(1584);try{r=s(9021)}catch(e){}var a=function(){},o="undefined"!=typeof process&&/^v?\.0/.test(process.version),l=function(e){return"function"==typeof e},c=function(e,t,s,c){c=n(c);var u=!1;e.on("close",function(){u=!0}),i(e,{readable:t,writable:s},function(e){if(e)return c(e);u=!0,c()});var h=!1;return function(t){if(!u&&!h){if(h=!0,o&&r&&(e instanceof(r.ReadStream||a)||e instanceof(r.WriteStream||a))&&l(e.close))return e.close(a);if(e.setHeader&&l(e.abort))return e.abort();if(l(e.destroy))return e.destroy();c(t||Error("stream was destroyed"))}}},u=function(e){e()},h=function(e,t){return e.pipe(t)};e.exports=function(){var e,t=Array.prototype.slice.call(arguments),s=l(t[t.length-1]||a)&&t.pop()||a;if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw Error("pump requires two streams per minimum");var r=t.map(function(n,i){var a=i<t.length-1;return c(n,a,i>0,function(t){e||(e=t),t&&r.forEach(u),a||(r.forEach(u),s(e))})});return t.reduce(h)}},4735:e=>{"use strict";e.exports=require("events")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5566:(e,t,s)=>{"use strict";let r;let n=s(1820),i=s(3997),a=s(3637),{env:o}=process;function l(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function c(e,t){if(0===r)return 0;if(a("color=16m")||a("color=full")||a("color=truecolor"))return 3;if(a("color=256"))return 2;if(e&&!t&&void 0===r)return 0;let s=r||0;if("dumb"===o.TERM)return s;if("win32"===process.platform){let e=n.release().split(".");return Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in o)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(e=>e in o)||"codeship"===o.CI_NAME?1:s;if("TEAMCITY_VERSION"in o)return+!!/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(o.TEAMCITY_VERSION);if("truecolor"===o.COLORTERM)return 3;if("TERM_PROGRAM"in o){let e=parseInt((o.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(o.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(o.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(o.TERM)||"COLORTERM"in o?1:s}a("no-color")||a("no-colors")||a("color=false")||a("color=never")?r=0:(a("color")||a("colors")||a("color=true")||a("color=always"))&&(r=1),"FORCE_COLOR"in o&&(r="true"===o.FORCE_COLOR?1:"false"===o.FORCE_COLOR?0:0===o.FORCE_COLOR.length?1:Math.min(parseInt(o.FORCE_COLOR,10),3)),e.exports={supportsColor:function(e){return l(c(e,e&&e.isTTY))},stdout:l(c(!0,i.isatty(1))),stderr:l(c(!0,i.isatty(2)))}},5591:e=>{"use strict";e.exports=require("https")},5624:(e,t,s)=>{var r=s(3432);function n(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function i(e){var t=function(){if(t.called)throw Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)};return t.onceError=(e.name||"Function wrapped with `once`")+" shouldn't be called more than once",t.called=!1,t}e.exports=r(n),e.exports.strict=r(i),n.proto=n(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return n(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return i(this)},configurable:!0})})},5945:e=>{function t(e){return Buffer.isBuffer(e)?e:Buffer.from(e.buffer,e.byteOffset,e.byteLength)}e.exports={isBuffer:function(e){return Buffer.isBuffer(e)||e instanceof Uint8Array},isEncoding:function(e){return Buffer.isEncoding(e)},alloc:function(e,t,s){return Buffer.alloc(e,t,s)},allocUnsafe:function(e){return Buffer.allocUnsafe(e)},allocUnsafeSlow:function(e){return Buffer.allocUnsafeSlow(e)},byteLength:function(e,t){return Buffer.byteLength(e,t)},compare:function(e,t){return Buffer.compare(e,t)},concat:function(e,t){return Buffer.concat(e,t)},copy:function(e,s,r,n,i){return t(e).copy(s,r,n,i)},equals:function(e,s){return t(e).equals(s)},fill:function(e,s,r,n,i){return t(e).fill(s,r,n,i)},from:function(e,t,s){return Buffer.from(e,t,s)},includes:function(e,s,r,n){return t(e).includes(s,r,n)},indexOf:function(e,s,r,n){return t(e).indexOf(s,r,n)},lastIndexOf:function(e,s,r,n){return t(e).lastIndexOf(s,r,n)},swap16:function(e){return t(e).swap16()},swap32:function(e){return t(e).swap32()},swap64:function(e){return t(e).swap64()},toBuffer:t,toString:function(e,s,r,n){return t(e).toString(s,r,n)},write:function(e,s,r,n,i){return t(e).write(s,r,n,i)},writeDoubleLE:function(e,s,r){return t(e).writeDoubleLE(s,r)},writeFloatLE:function(e,s,r){return t(e).writeFloatLE(s,r)},writeUInt32LE:function(e,s,r){return t(e).writeUInt32LE(s,r)},writeInt32LE:function(e,s,r){return t(e).writeInt32LE(s,r)},readDoubleLE:function(e,s){return t(e).readDoubleLE(s)},readFloatLE:function(e,s){return t(e).readFloatLE(s)},readUInt32LE:function(e,s){return t(e).readUInt32LE(s)},readInt32LE:function(e,s){return t(e).readInt32LE(s)},writeDoubleBE:function(e,s,r){return t(e).writeDoubleBE(s,r)},writeFloatBE:function(e,s,r){return t(e).writeFloatBE(s,r)},writeUInt32BE:function(e,s,r){return t(e).writeUInt32BE(s,r)},writeInt32BE:function(e,s,r){return t(e).writeInt32BE(s,r)},readDoubleBE:function(e,s){return t(e).readDoubleBE(s)},readFloatBE:function(e,s){return t(e).readFloatBE(s)},readUInt32BE:function(e,s){return t(e).readUInt32BE(s)},readInt32BE:function(e,s){return t(e).readInt32BE(s)}}},5946:(e,t,s)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let s="color: "+this.color;t.splice(1,0,s,"color: inherit");let r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(n=r))}),t.splice(n,0,s)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){let e;return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=s(2297)(t);let{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},6300:(e,t,s)=>{let r=s(3997),n=s(8354);t.init=function(e){e.inspectOpts={};let s=Object.keys(t.inspectOpts);for(let r=0;r<s.length;r++)e.inspectOpts[s[r]]=t.inspectOpts[s[r]]},t.log=function(...e){return process.stderr.write(n.formatWithOptions(t.inspectOpts,...e)+"\n")},t.formatArgs=function(s){let{namespace:r,useColors:n}=this;if(n){let t=this.color,n="\x1b[3"+(t<8?t:"8;5;"+t),i=`  ${n};1m${r} \u001B[0m`;s[0]=i+s[0].split("\n").join("\n"+i),s.push(n+"m+"+e.exports.humanize(this.diff)+"\x1b[0m")}else s[0]=(t.inspectOpts.hideDate?"":new Date().toISOString()+" ")+r+" "+s[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?!!t.inspectOpts.colors:r.isatty(process.stderr.fd)},t.destroy=n.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{let e=s(5566);e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let s=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase()),r=process.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[s]=r,e},{}),e.exports=s(2297)(t);let{formatters:i}=e.exports;i.o=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts).split("\n").map(e=>e.trim()).join(" ")},i.O=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts)}},6373:(e,t,s)=>{var r=s(9551),n=r.URL,i=s(1630),a=s(5591),o=s(7910).Writable,l=s(2412),c=s(1118);!function(){var e="undefined"!=typeof process,t="undefined"!=typeof window&&"undefined"!=typeof document,s=R(Error.captureStackTrace);e||!t&&s||console.warn("The follow-redirects package should be excluded from browser builds.")}();var u=!1;try{l(new n(""))}catch(e){u="ERR_INVALID_URL"===e.code}var h=["auth","host","hostname","href","path","pathname","port","protocol","query","search","hash"],d=["abort","aborted","connect","error","socket","timeout"],f=Object.create(null);d.forEach(function(e){f[e]=function(t,s,r){this._redirectable.emit(e,t,s,r)}});var p=I("ERR_INVALID_URL","Invalid URL",TypeError),m=I("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),g=I("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded",m),_=I("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),y=I("ERR_STREAM_WRITE_AFTER_END","write after end"),b=o.prototype.destroy||x;function w(e,t){o.call(this),this._sanitizeOptions(e),this._options=e,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t&&this.on("response",t);var s=this;this._onNativeResponse=function(e){try{s._processResponse(e)}catch(e){s.emit("error",e instanceof m?e:new m({cause:e}))}},this._performRequest()}function v(e){var t={maxRedirects:21,maxBodyLength:0xa00000},s={};return Object.keys(e).forEach(function(r){var i=r+":",a=s[i]=e[r],o=t[r]=Object.create(a);Object.defineProperties(o,{request:{value:function(e,r,a){var o;return(o=e,n&&o instanceof n)?e=A(e):C(e)?e=A(S(e)):(a=r,r=k(e),e={protocol:i}),R(r)&&(a=r,r=null),(r=Object.assign({maxRedirects:t.maxRedirects,maxBodyLength:t.maxBodyLength},e,r)).nativeProtocols=s,C(r.host)||C(r.hostname)||(r.hostname="::1"),l.equal(r.protocol,i,"protocol mismatch"),c("options",r),new w(r,a)},configurable:!0,enumerable:!0,writable:!0},get:{value:function(e,t,s){var r=o.request(e,t,s);return r.end(),r},configurable:!0,enumerable:!0,writable:!0}})}),t}function x(){}function S(e){var t;if(u)t=new n(e);else if(!C((t=k(r.parse(e))).protocol))throw new p({input:e});return t}function k(e){if(/^\[/.test(e.hostname)&&!/^\[[:0-9a-f]+\]$/i.test(e.hostname)||/^\[/.test(e.host)&&!/^\[[:0-9a-f]+\](:\d+)?$/i.test(e.host))throw new p({input:e.href||e});return e}function A(e,t){var s=t||{};for(var r of h)s[r]=e[r];return s.hostname.startsWith("[")&&(s.hostname=s.hostname.slice(1,-1)),""!==s.port&&(s.port=Number(s.port)),s.path=s.search?s.pathname+s.search:s.pathname,s}function E(e,t){var s;for(var r in t)e.test(r)&&(s=t[r],delete t[r]);return null==s?void 0:String(s).trim()}function I(e,t,s){function r(s){R(Error.captureStackTrace)&&Error.captureStackTrace(this,this.constructor),Object.assign(this,s||{}),this.code=e,this.message=this.cause?t+": "+this.cause.message:t}return r.prototype=new(s||Error),Object.defineProperties(r.prototype,{constructor:{value:r,enumerable:!1},name:{value:"Error ["+e+"]",enumerable:!1}}),r}function O(e,t){for(var s of d)e.removeListener(s,f[s]);e.on("error",x),e.destroy(t)}function C(e){return"string"==typeof e||e instanceof String}function R(e){return"function"==typeof e}w.prototype=Object.create(o.prototype),w.prototype.abort=function(){O(this._currentRequest),this._currentRequest.abort(),this.emit("abort")},w.prototype.destroy=function(e){return O(this._currentRequest,e),b.call(this,e),this},w.prototype.write=function(e,t,s){var r;if(this._ending)throw new y;if(!C(e)&&!("object"==typeof(r=e)&&"length"in r))throw TypeError("data should be a string, Buffer or Uint8Array");if(R(t)&&(s=t,t=null),0===e.length){s&&s();return}this._requestBodyLength+e.length<=this._options.maxBodyLength?(this._requestBodyLength+=e.length,this._requestBodyBuffers.push({data:e,encoding:t}),this._currentRequest.write(e,t,s)):(this.emit("error",new _),this.abort())},w.prototype.end=function(e,t,s){if(R(e)?(s=e,e=t=null):R(t)&&(s=t,t=null),e){var r=this,n=this._currentRequest;this.write(e,t,function(){r._ended=!0,n.end(null,null,s)}),this._ending=!0}else this._ended=this._ending=!0,this._currentRequest.end(null,null,s)},w.prototype.setHeader=function(e,t){this._options.headers[e]=t,this._currentRequest.setHeader(e,t)},w.prototype.removeHeader=function(e){delete this._options.headers[e],this._currentRequest.removeHeader(e)},w.prototype.setTimeout=function(e,t){var s=this;function r(t){t.setTimeout(e),t.removeListener("timeout",t.destroy),t.addListener("timeout",t.destroy)}function n(t){s._timeout&&clearTimeout(s._timeout),s._timeout=setTimeout(function(){s.emit("timeout"),i()},e),r(t)}function i(){s._timeout&&(clearTimeout(s._timeout),s._timeout=null),s.removeListener("abort",i),s.removeListener("error",i),s.removeListener("response",i),s.removeListener("close",i),t&&s.removeListener("timeout",t),s.socket||s._currentRequest.removeListener("socket",n)}return t&&this.on("timeout",t),this.socket?n(this.socket):this._currentRequest.once("socket",n),this.on("socket",r),this.on("abort",i),this.on("error",i),this.on("response",i),this.on("close",i),this},["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(e){w.prototype[e]=function(t,s){return this._currentRequest[e](t,s)}}),["aborted","connection","socket"].forEach(function(e){Object.defineProperty(w.prototype,e,{get:function(){return this._currentRequest[e]}})}),w.prototype._sanitizeOptions=function(e){if(e.headers||(e.headers={}),e.host&&(e.hostname||(e.hostname=e.host),delete e.host),!e.pathname&&e.path){var t=e.path.indexOf("?");t<0?e.pathname=e.path:(e.pathname=e.path.substring(0,t),e.search=e.path.substring(t))}},w.prototype._performRequest=function(){var e=this._options.protocol,t=this._options.nativeProtocols[e];if(!t)throw TypeError("Unsupported protocol "+e);if(this._options.agents){var s=e.slice(0,-1);this._options.agent=this._options.agents[s]}var n=this._currentRequest=t.request(this._options,this._onNativeResponse);for(var i of(n._redirectable=this,d))n.on(i,f[i]);if(this._currentUrl=/^\//.test(this._options.path)?r.format(this._options):this._options.path,this._isRedirect){var a=0,o=this,l=this._requestBodyBuffers;!function e(t){if(n===o._currentRequest){if(t)o.emit("error",t);else if(a<l.length){var s=l[a++];n.finished||n.write(s.data,s.encoding,e)}else o._ended&&n.end()}}()}},w.prototype._processResponse=function(e){var t,s,i,a,o,h,d=e.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:e.headers,statusCode:d});var f=e.headers.location;if(!f||!1===this._options.followRedirects||d<300||d>=400){e.responseUrl=this._currentUrl,e.redirects=this._redirects,this.emit("response",e),this._requestBodyBuffers=[];return}if(O(this._currentRequest),e.destroy(),++this._redirectCount>this._options.maxRedirects)throw new g;var p=this._options.beforeRedirect;p&&(h=Object.assign({Host:e.req.getHeader("host")},this._options.headers));var m=this._options.method;(301!==d&&302!==d||"POST"!==this._options.method)&&(303!==d||/^(?:GET|HEAD)$/.test(this._options.method))||(this._options.method="GET",this._requestBodyBuffers=[],E(/^content-/i,this._options.headers));var _=E(/^host$/i,this._options.headers),y=S(this._currentUrl),b=_||y.host,w=/^\w+:/.test(f)?this._currentUrl:r.format(Object.assign(y,{host:b})),v=(t=f,s=w,u?new n(t,s):S(r.resolve(s,t)));if(c("redirecting to",v.href),this._isRedirect=!0,A(v,this._options),(v.protocol===y.protocol||"https:"===v.protocol)&&(v.host===b||(i=v.host,a=b,l(C(i)&&C(a)),(o=i.length-a.length-1)>0&&"."===i[o]&&i.endsWith(a)))||E(/^(?:(?:proxy-)?authorization|cookie)$/i,this._options.headers),R(p)){var x={headers:e.headers,statusCode:d},k={url:w,method:m,headers:h};p(this._options,x,k),this._sanitizeOptions(this._options)}this._performRequest()},e.exports=v({http:i,https:a}),e.exports.wrap=v},6382:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{POST:()=>o});var n=s(2190),i=s(8430),a=e([i]);async function o(e){try{let t;let{url:s}=await e.json();if(!s)return n.NextResponse.json({error:"URL is required"},{status:400});if(!/^https?:\/\/.+/.test(s))return n.NextResponse.json({error:"Invalid URL format. Please provide a URL starting with http:// or https://"},{status:400});if(process.env.AZURE_OPENAI_API_KEY&&process.env.AZURE_OPENAI_ENDPOINT&&process.env.AZURE_OPENAI_DEPLOYMENT_NAME)try{console.log("\uD83D\uDD0D Using enhanced AI analysis..."),t=await (0,i.k)(s)}catch(r){console.error(" Enhanced AI analysis failed:",r);let e=r instanceof Error?r.message:"Unknown error";if(e.includes("AI cannot analyze this website")||e.includes("content policy")||e.includes("cannot process"))return n.NextResponse.json({error:"AI analysis failed",message:"Unable to analyze this website. This could be due to the website being inaccessible, requiring authentication, or having content that the AI cannot process.",url:s,timestamp:new Date().toISOString()},{status:422});console.log(" AI failed for technical reasons, falling back to basic analysis..."),t=(0,i.K)(s,"AI failed for technical reasons, here is a basic analysis for demonstration purposes.")}else console.log(" Azure OpenAI not configured, using basic analysis..."),t=(0,i.K)(s);return n.NextResponse.json(t)}catch(e){return console.error(" Error analyzing website:",e),n.NextResponse.json({error:"Failed to analyze website"},{status:500})}}i=(a.then?(await a)():a)[0],r()}catch(e){r(e)}})},6420:(e,t,s)=>{let{EventEmitter:r}=s(4735),n=Error("Stream was destroyed"),i=Error("Premature close"),a=s(7031),o=s(9370),l="undefined"==typeof queueMicrotask?e=>global.process.nextTick(e):queueMicrotask,c=0x1ffffcff,u=0x1ffdfeff,h=0x200800f,d=17423,f=16527,p=1167,m=12431,g=214047,_=17422,y=32879,b=0x880000f,w=6553615,v=0x1024000f,x=0x8a4000f,S=0x8c0000e,k=0x218000f,A=0x880000e,E=Symbol.asyncIterator||Symbol("asyncIterator");class I{constructor(e,{highWaterMark:t=16384,map:s=null,mapWritable:r,byteLength:n,byteLengthWritable:i}={}){this.stream=e,this.queue=new a,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=i||n||Z,this.map=r||s,this.afterWrite=P.bind(this),this.afterUpdateNextTick=F.bind(this)}get ended(){return(8388608&this.stream._duplexState)!=0}push(e){return(this.stream._duplexState&A)==0&&((null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark)?(this.stream._duplexState|=2097152,!0):(this.stream._duplexState|=6291456,!1))}shift(){let e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=0x1fdfffff),e}end(e){"function"==typeof e?this.stream.once("finish",e):null!=e&&this.push(e),this.stream._duplexState=(0x8000000|this.stream._duplexState)&0x1fefffff}autoBatch(e,t){let s=[],r=this.stream;for(s.push(e);(r._duplexState&v)==2359296;)s.push(r._writableState.shift());if((15&r._duplexState)!=0)return t(null);r._writev(s,t)}update(){let e=this.stream;e._duplexState|=524288;do{for(;(e._duplexState&v)==2097152;){let t=this.shift();e._duplexState|=0x4040000,e._write(t,this.afterWrite)}(1310720&e._duplexState)==0&&this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=0x1ff7ffff}updateNonPrimary(){let e=this.stream;if((e._duplexState&x)==0x8000000){e._duplexState=262144|e._duplexState,e._final($.bind(this));return}if((14&e._duplexState)==4){(0x2008000&e._duplexState)==0&&(e._duplexState|=262160,e._destroy(L.bind(this)));return}(e._duplexState&h)==1&&(e._duplexState=(262160|e._duplexState)&0x1ffffffe,e._open(B.bind(this)))}continueUpdate(){return(0x2000000&this.stream._duplexState)!=0&&(this.stream._duplexState&=0x1dffffff,!0)}updateCallback(){(this.stream._duplexState&k)==1048576?this.update():this.updateNextTick()}updateNextTick(){(0x2000000&this.stream._duplexState)==0&&(this.stream._duplexState|=0x2000000,(524288&this.stream._duplexState)==0&&l(this.afterUpdateNextTick))}}class O{constructor(e,{highWaterMark:t=16384,map:s=null,mapReadable:r,byteLength:n,byteLengthReadable:i}={}){this.stream=e,this.queue=new a,this.highWaterMark=0===t?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=i||n||Z,this.map=r||s,this.pipeTo=null,this.afterRead=N.bind(this),this.afterUpdateNextTick=M.bind(this)}get ended(){return(16384&this.stream._duplexState)!=0}pipe(e,t){if(null!==this.pipeTo)throw Error("Can only pipe to one destination");if("function"!=typeof t&&(t=null),this.stream._duplexState|=512,this.pipeTo=e,this.pipeline=new R(this.stream,e,t),t&&this.stream.on("error",Q),G(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",Q),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{let t=this.pipeline.done.bind(this.pipeline,e),s=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",t),e.on("close",s),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",T.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){let t=this.stream;return null===e?(this.highWaterMark=0,t._duplexState=(1024|t._duplexState)&0x1ffeffbf,!1):(null!==this.map&&null===(e=this.map(e))?t._duplexState&=0x1ffeffff:(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=(128|t._duplexState)&0x1ffeffff),this.buffered<this.highWaterMark)}shift(){let e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=0x1fffdf7f),e}unshift(e){let t=[null!==this.map?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let e=0;e<t.length-1;e++){let s=t[e];this.buffered+=this.byteLength(s),this.queue.push(s)}this.push(t[t.length-1])}read(){let e=this.stream;if((e._duplexState&f)==128){let t=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=c),(2048&e._duplexState)!=0&&e.emit("data",t),t}return!1===this.readAhead&&(e._duplexState|=131072,this.updateNextTick()),null}drain(){let e=this.stream;for(;(e._duplexState&f)==128&&(768&e._duplexState)!=0;){let t=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=c),(2048&e._duplexState)!=0&&e.emit("data",t)}}update(){let e=this.stream;e._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(e._duplexState&g)==131072;)e._duplexState|=65552,e._read(this.afterRead),this.drain();(e._duplexState&m)==4224&&(e._duplexState|=8192,e.emit("readable")),(80&e._duplexState)==0&&this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=0x1fffffdf}updateNonPrimary(){let e=this.stream;if((e._duplexState&p)==1024&&(e._duplexState=(16384|e._duplexState)&0x1ffffbff,e.emit("end"),(8405006&e._duplexState)==8404992&&(e._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),(14&e._duplexState)==4){(0x2008000&e._duplexState)==0&&(e._duplexState|=262160,e._destroy(L.bind(this)));return}(e._duplexState&h)==1&&(e._duplexState=(262160|e._duplexState)&0x1ffffffe,e._open(B.bind(this)))}continueUpdate(){return(32768&this.stream._duplexState)!=0&&(this.stream._duplexState&=0x1fff7fff,!0)}updateCallback(){(this.stream._duplexState&y)==64?this.update():this.updateNextTick()}updateNextTickIfOpen(){(32769&this.stream._duplexState)==0&&(this.stream._duplexState|=32768,(32&this.stream._duplexState)==0&&l(this.afterUpdateNextTick))}updateNextTick(){(32768&this.stream._duplexState)==0&&(this.stream._duplexState|=32768,(32&this.stream._duplexState)==0&&l(this.afterUpdateNextTick))}}class C{constructor(e){this.data=null,this.afterTransform=j.bind(e),this.afterFinal=null}}class R{constructor(e,t,s){this.from=e,this.to=t,this.afterPipe=s,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){if(t&&(this.error=t),e===this.to&&(this.to=null,null!==this.from)){(16384&this.from._duplexState)!=0&&this.pipeToFinished||this.from.destroy(this.error||Error("Writable stream closed prematurely"));return}if(e===this.from&&(this.from=null,null!==this.to)){(16384&e._duplexState)==0&&this.to.destroy(this.error||Error("Readable stream closed before ending"));return}null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function T(){this.stream._duplexState|=512,this.updateCallback()}function $(e){let t=this.stream;e&&t.destroy(e),(14&t._duplexState)==0&&(t._duplexState|=8388608,t.emit("finish")),(8405006&t._duplexState)==8404992&&(t._duplexState|=4),t._duplexState&=0x17fbffff,(524288&t._duplexState)==0?this.update():this.updateNextTick()}function L(e){let t=this.stream;e||this.error===n||(e=this.error),e&&t.emit("error",e),t._duplexState|=8,t.emit("close");let s=t._readableState,r=t._writableState;if(null!==s&&null!==s.pipeline&&s.pipeline.done(t,e),null!==r){for(;null!==r.drains&&r.drains.length>0;)r.drains.shift().resolve(!1);null!==r.pipeline&&r.pipeline.done(t,e)}}function P(e){let t=this.stream;e&&t.destroy(e),t._duplexState&=0x1bfbffff,null!==this.drains&&function(e){for(let t=0;t<e.length;t++)0==--e[t].writes&&(e.shift().resolve(!0),t--)}(this.drains),(t._duplexState&w)==4194304&&(t._duplexState&=0x1fbfffff,(0x1000000&t._duplexState)==0x1000000&&t.emit("drain")),this.updateCallback()}function N(e){e&&this.stream.destroy(e),this.stream._duplexState&=0x1fffffef,!1===this.readAhead&&(256&this.stream._duplexState)==0&&(this.stream._duplexState&=0x1ffdffff),this.updateCallback()}function M(){(32&this.stream._duplexState)==0&&(this.stream._duplexState&=0x1fff7fff,this.update())}function F(){(524288&this.stream._duplexState)==0&&(this.stream._duplexState&=0x1dffffff,this.update())}function B(e){let t=this.stream;e&&t.destroy(e),(4&t._duplexState)==0&&((t._duplexState&d)==0&&(t._duplexState|=64),(t._duplexState&b)==0&&(t._duplexState|=1048576),t.emit("open")),t._duplexState&=0x1ffbffef,null!==t._writableState&&t._writableState.updateCallback(),null!==t._readableState&&t._readableState.updateCallback()}function j(e,t){null!=t&&this.push(t),this._writableState.afterWrite(e)}function U(e){null!==this._readableState&&("data"===e&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===e&&(this._duplexState|=4096,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===e&&(this._duplexState|=0x1000000,this._writableState.updateNextTick())}class D extends r{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",ee.bind(this))),this.on("newListener",U)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return(8&this._duplexState)!=0}get destroying(){return(14&this._duplexState)!=0}destroy(e){(14&this._duplexState)==0&&(e||(e=n),this._duplexState=(4|this._duplexState)&0x1fefffbf,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=e),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=2,this._predestroy(),this._duplexState&=0x1ffffffd,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}}class q extends D{constructor(e){super(e),this._duplexState|=8519681,this._readableState=new O(this,e),e&&(!1===this._readableState.readAhead&&(this._duplexState&=0x1ffdffff),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){let t=new o(e),s=this._readableState.map||V;return this._readableState.map=function(e){let r=t.push(e);return""===r&&(0!==e.byteLength||t.remaining>0)?null:s(r)},this}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTickIfOpen(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTickIfOpen(),this._readableState.unshift(e)}resume(){return this._duplexState|=131328,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?u:0x1ffffeff,this}static _fromAsyncIterator(e,t){let s;let r=new q({...t,read(t){e.next().then(n).then(t.bind(null,null)).catch(t)},predestroy(){s=e.return()},destroy(e){if(!s)return e(null);s.then(e.bind(null,null)).catch(e)}});return r;function n(e){e.done?r.push(null):r.push(e.value)}}static from(e,t){var s;if(G(s=e)&&s.readable)return e;if(e[E])return this._fromAsyncIterator(e[E](),t);Array.isArray(e)||(e=void 0===e?[]:[e]);let r=0;return new q({...t,read(t){this.push(r===e.length?null:e[r++]),t(null)}})}static isBackpressured(e){return(e._duplexState&_)!=0||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return(256&e._duplexState)==0}[E](){let e=this,t=null,s=null,r=null;return this.on("error",e=>{t=e}),this.on("readable",function(){null!==s&&i(e.read())}),this.on("close",function(){null!==s&&i(null)}),{[E](){return this},next:()=>new Promise(function(t,n){s=t,r=n;let a=e.read();null!==a?i(a):(8&e._duplexState)!=0&&i(null)}),return:()=>a(null),throw:e=>a(e)};function i(i){null!==r&&(t?r(t):null===i&&(16384&e._duplexState)==0?r(n):s({value:i,done:null===i}),r=s=null)}function a(t){return e.destroy(t),new Promise((s,r)=>{if(8&e._duplexState)return s({value:void 0,done:!0});e.once("close",function(){t?r(t):s({value:void 0,done:!0})})})}}}class W extends D{constructor(e){super(e),this._duplexState|=16385,this._writableState=new I(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=0x10000000}uncork(){this._duplexState&=0xfffffff,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return(e._duplexState&S)!=0}static drained(e){var t;if(e.destroyed)return Promise.resolve(!1);let s=e._writableState,r=((t=e)._writev!==W.prototype._writev&&t._writev!==z.prototype._writev?Math.min(1,s.queue.length):s.queue.length)+(0x4000000&e._duplexState?1:0);return 0===r?Promise.resolve(!0):(null===s.drains&&(s.drains=[]),new Promise(e=>{s.drains.push({writes:r,resolve:e})}))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class z extends q{constructor(e){super(e),this._duplexState=1|131072&this._duplexState,this._writableState=new I(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=0x10000000}uncork(){this._duplexState&=0xfffffff,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class H extends z{constructor(e){super(e),this._transformState=new C(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(null!==this._transformState.data){let t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}destroy(e){super.destroy(e),null!==this._transformState.data&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(e,t){t(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush(J.bind(this))}}class X extends H{}function J(e,t){let s=this._transformState.afterFinal;if(e)return s(e);null!=t&&this.push(t),this.push(null),s(null)}function K(e,...t){let s=Array.isArray(e)?[...e,...t]:[e,...t],r=s.length&&"function"==typeof s[s.length-1]?s.pop():null;if(s.length<2)throw Error("Pipeline requires at least 2 streams");let n=s[0],a=null,o=null;for(let e=1;e<s.length;e++)a=s[e],G(n)?n.pipe(a,l):(function(e,t,s,r){e.on("error",r),e.on("close",function(){if(t&&e._readableState&&!e._readableState.ended||s&&e._writableState&&!e._writableState.ended)return r(i)})}(n,!0,e>1,l),n.pipe(a)),n=a;if(r){let e=!1,t=G(a)||!!(a._writableState&&a._writableState.autoDestroy);a.on("error",e=>{null===o&&(o=e)}),a.on("finish",()=>{e=!0,t||r(o)}),t&&a.on("close",()=>r(o||(e?null:i)))}return a;function l(e){if(e&&!o)for(let t of(o=e,s))t.destroy(e)}}function V(e){return e}function Y(e){return!!e._readableState||!!e._writableState}function G(e){return"number"==typeof e._duplexState&&Y(e)}function Z(e){return"object"==typeof e&&null!==e&&"number"==typeof e.byteLength?e.byteLength:1024}function Q(){}function ee(){this.destroy(Error("Stream aborted."))}e.exports={pipeline:K,pipelinePromise:function(...e){return new Promise((t,s)=>K(...e,e=>{if(e)return s(e);t()}))},isStream:Y,isStreamx:G,isEnded:function(e){return!!e._readableState&&e._readableState.ended},isFinished:function(e){return!!e._writableState&&e._writableState.ended},isDisturbed:function(e){return(1&e._duplexState)!=1||(0x2008000&e._duplexState)!=0},getStreamError:function(e,t={}){let s=e._readableState&&e._readableState.error||e._writableState&&e._writableState.error;return t.all||s!==n?s:null},Stream:D,Writable:W,Readable:q,Duplex:z,Transform:H,PassThrough:X}},6487:()=>{},7031:(e,t,s)=>{let r=s(3535);e.exports=class{constructor(e){this.hwm=e||16,this.head=new r(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){let t=this.head;this.head=t.next=new r(2*this.head.buffer.length),this.head.push(e)}}shift(){0!==this.length&&this.length--;let e=this.tail.shift();if(void 0===e&&this.tail.next){let e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){let e=this.tail.peek();return void 0===e&&this.tail.next?this.tail.next.peek():e}isEmpty(){return 0===this.length}}},7910:e=>{"use strict";e.exports=require("stream")},8335:()=>{},8354:e=>{"use strict";e.exports=require("util")},8430:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.d(t,{K:()=>d,k:()=>u});var n=s(694),i=s(3665),a=s(8856),o=s(3215),l=e([i,a]);[i,a]=l.then?(await l)():l;let f=0,p=null;async function c(e){console.log("\uD83D\uDD27 Launching Puppeteer browser with @sparticuz/chromium-min...");let t=await a.default.launch({args:o.A.args,executablePath:await o.A.executablePath(),headless:!0});console.log(" Browser launched successfully");try{let s=await t.newPage();await s.setViewport({width:1920,height:1080}),await s.setUserAgent("Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"),s.setDefaultTimeout(3e4),console.log(` Navigating to: ${e}`);let r=await s.goto(e,{waitUntil:"networkidle0",timeout:3e4});if(!r||!r.ok())throw Error(`Failed to load page: ${r?.status()} ${r?.statusText()}`);console.log(" Page loaded successfully"),await new Promise(e=>setTimeout(e,2e3));let n=await s.content(),i=await s.evaluate(()=>(document.querySelectorAll("script, style, noscript, iframe, svg, img").forEach(e=>e.remove()),(document.body.innerText||document.body.textContent||"").replace(/\s+/g," ").replace(/\n\s*\n/g,"\n").trim())),a=await s.evaluate(()=>({title:document.title,description:document.querySelector('meta[name="description"]')?.getAttribute("content")||"",keywords:document.querySelector('meta[name="keywords"]')?.getAttribute("content")||"",viewport:document.querySelector('meta[name="viewport"]')?.getAttribute("content")||"",robots:document.querySelector('meta[name="robots"]')?.getAttribute("content")||"",ogTitle:document.querySelector('meta[property="og:title"]')?.getAttribute("content")||"",ogDescription:document.querySelector('meta[property="og:description"]')?.getAttribute("content")||"",ogImage:document.querySelector('meta[property="og:image"]')?.getAttribute("content")||"",canonical:document.querySelector('link[rel="canonical"]')?.getAttribute("href")||"",language:document.documentElement.lang||"en",charset:document.characterSet||"UTF-8"})),o=await s.evaluate(()=>{let e=document.querySelectorAll("img"),t=document.querySelectorAll("a"),s=document.querySelectorAll('button, input[type="button"], input[type="submit"]'),r=document.querySelectorAll("form"),n=document.querySelectorAll("h1, h2, h3, h4, h5, h6"),i=document.querySelectorAll("input, textarea, select"),a=document.querySelectorAll("table"),o=document.querySelectorAll("ul, ol");return{imagesWithoutAlt:Array.from(e).filter(e=>!e.alt).length,totalImages:e.length,imageDetails:Array.from(e).map(e=>({src:e.src,alt:e.alt,title:e.title,hasAlt:!!e.alt})),linksWithoutText:Array.from(t).filter(e=>!(e.textContent||"").trim()).length,totalLinks:t.length,linkDetails:Array.from(t).map(e=>({href:e.href,text:(e.textContent||"").trim(),hasText:!!(e.textContent||"").trim()})),buttonsWithoutText:Array.from(s).filter(e=>!(e.textContent||"").trim()&&!e.getAttribute("aria-label")).length,totalButtons:s.length,buttonDetails:Array.from(s).map(e=>({text:(e.textContent||"").trim(),ariaLabel:e.getAttribute("aria-label"),type:e.getAttribute("type"),hasText:!!(e.textContent||"").trim()||!!e.getAttribute("aria-label")})),formsWithoutLabels:Array.from(r).filter(e=>!e.querySelector("label")).length,totalForms:r.length,inputDetails:Array.from(i).map(e=>({type:e.getAttribute("type"),name:e.getAttribute("name"),id:e.getAttribute("id"),hasLabel:!!document.querySelector(`label[for="${e.getAttribute("id")}"]`)||!!e.closest("label")})),headingStructure:Array.from(n).map(e=>({level:e.tagName.toLowerCase(),text:(e.textContent||"").trim()})),totalTables:a.length,totalLists:o.length}}),l=await s.evaluate(()=>{let e=l.getEntriesByType("navigation")[0];return{loadTime:e?e.loadEventEnd-e.loadEventStart:0,domContentLoaded:e?e.domContentLoadedEventEnd-e.domContentLoadedEventStart:0,firstPaint:l.getEntriesByType("paint").find(e=>"first-paint"===e.name)?.startTime||0,firstContentfulPaint:l.getEntriesByType("paint").find(e=>"first-contentful-paint"===e.name)?.startTime||0}}),c=await s.evaluate(()=>({width:window.innerWidth,height:window.innerHeight,devicePixelRatio:window.devicePixelRatio,scrollWidth:document.documentElement.scrollWidth,scrollHeight:document.documentElement.scrollHeight}));return{html:n.substring(0,2e5),visibleText:i.substring(0,5e4),metadata:a,accessibility:o,performance:l,viewport:c}}finally{await t.close()}}async function u(e){if(!process.env.AZURE_OPENAI_API_KEY)throw Error("Azure OpenAI API key is not configured");if(!process.env.AZURE_OPENAI_ENDPOINT)throw Error("Azure OpenAI endpoint is not configured");if(!process.env.AZURE_OPENAI_DEPLOYMENT_NAME)throw Error("Azure OpenAI deployment name is not configured");console.log("\uD83D\uDD27 Azure OpenAI configuration validated"),console.log("\uD83D\uDD27 Endpoint:",process.env.AZURE_OPENAI_ENDPOINT),console.log("\uD83D\uDD27 Deployment:",process.env.AZURE_OPENAI_DEPLOYMENT_NAME),f=0;let t=null,s={desktop:void 0,mobile:void 0};try{console.log("\uD83D\uDCC4 Capturing website content..."),console.log("\uD83D\uDD27 Using puppeteer-core with @sparticuz/chromium"),t=await c(e),console.log(" Website content captured successfully"),s=await (0,i.UW)(e).catch(e=>(console.warn("Screenshot capture failed:",e.message),{desktop:void 0,mobile:void 0}))}catch(e){throw console.error(" Failed to capture website content:",e),Error(`Failed to access website: ${e instanceof Error?e.message:"Unknown error"}`)}let r=`You are an expert UX/UI analyst and web accessibility specialist. Your task is to analyze websites and provide comprehensive, specific, and actionable feedback.

IMPORTANT: Be extremely specific and detailed in your analysis, but ONLY based on the data provided. Do NOT make up specific measurements, colors, or visual details you cannot verify from the provided content.

Instead of generic statements like "Low contrast in some areas", provide specific details like:
- "Missing alt text on images (found 5 images without alt attributes)"
- "Navigation menu has 3 links without descriptive text"
- "Contact form is missing proper labels for input fields"
- "Page has poor heading structure with missing H1 and H2 elements"

For visual issues like contrast, colors, or spacing, only mention them if you can see them explicitly in the HTML/CSS data provided. Otherwise, focus on structural, semantic, and content-based issues.

Analyze the provided website content and return a detailed analysis in the following JSON format:

{
  "score": number (0-100),
  "strengths": ["specific strength with details"],
  "improvements": ["specific improvement with context"],
  "recommendations": ["actionable recommendation with reasoning"],
  "details": {
    "accessibility": {
      "score": number (0-100),
      "issues": [
        {
          "id": "unique-identifier",
          "title": "Specific issue title",
          "description": "Detailed description of the issue with specific elements, colors, measurements, etc.",
          "severity": "low|medium|high|critical",
          "category": "accessibility",
          "location": {
            "element": "specific element name (e.g., 'navigation menu', 'contact form')",
            "selector": "CSS selector if applicable",
            "page": "page name or URL path"
          },
          "impact": "How this affects users (e.g., 'Screen reader users cannot understand the purpose of this image')",
          "recommendation": "Specific actionable solution with code examples if applicable",
          "codeExample": "Code snippet showing the fix"
        }
      ]
    },
    "performance": {
      "score": number (0-100),
      "issues": [/* same structure as above */]
    },
    "usability": {
      "score": number (0-100),
      "issues": [/* same structure as above */]
    },
    "design": {
      "score": number (0-100),
      "issues": [/* same structure as above */]
    }
  },
  "metadata": {
    "pageTitle": "Page title",
    "loadTime": estimated_load_time_in_ms,
    "pageSize": estimated_page_size_in_kb,
    "technologies": ["detected technologies"]
  }
}

Guidelines for analysis:
- Accessibility: Check alt text presence, ARIA labels, heading structure, form labels, link descriptions, semantic HTML usage
- Performance: Evaluate based on provided metrics (load times, paint times), code structure, resource optimization opportunities
- Usability: Assess navigation structure, content organization, form usability, mobile responsiveness indicators, user flow
- Design: Review HTML structure for visual hierarchy, semantic markup, content organization, and layout patterns

IMPORTANT: Focus on issues you can actually identify from the provided data. Do not make assumptions about visual appearance, colors, or specific measurements unless they are explicitly mentioned in the HTML/CSS content.

For each issue:
1. Be specific about which element has the problem (based on the HTML structure provided)
2. Provide exact counts, element types, or structural details when possible
3. Explain the impact on users
4. Give actionable recommendations with code examples
5. Assign appropriate severity based on user impact

Remember: Only provide feedback on issues you can actually identify from the provided data. Do not make up visual details, colors, or measurements that aren't explicitly present in the HTML/CSS content.

IMPORTANT: If you cannot analyze the website for any reason (content policy, accessibility, etc.), respond with a JSON object explaining why:
{
  "error": "reason_for_failure",
  "message": "Detailed explanation of why analysis failed"
}`,n=`Please analyze the following website content for: ${e}

WEBSITE CONTENT:
Title: ${t.metadata.title}
Description: ${t.metadata.description}
Language: ${t.metadata.language}

VISIBLE TEXT CONTENT (first 25000 characters):
${t.visibleText.substring(0,25e3)}

ACCESSIBILITY DATA:
- Images without alt text: ${t.accessibility.imagesWithoutAlt}/${t.accessibility.totalImages}
- Links without text: ${t.accessibility.linksWithoutText}/${t.accessibility.totalLinks}
- Buttons without text: ${t.accessibility.buttonsWithoutText}/${t.accessibility.totalButtons}
- Forms without labels: ${t.accessibility.formsWithoutLabels}/${t.accessibility.totalForms}
- Total tables: ${t.accessibility.totalTables}
- Total lists: ${t.accessibility.totalLists}
- Heading structure: ${t.accessibility.headingStructure.map(e=>`${e.level}: ${e.text.substring(0,50)}`).join(", ")}

DETAILED ACCESSIBILITY ANALYSIS:
- Images needing alt text: ${t.accessibility.imageDetails.filter(e=>!e.hasAlt).map(e=>e.src.split("/").pop()).join(", ")}
- Links needing text: ${t.accessibility.linkDetails.filter(e=>!e.hasText).map(e=>e.href).join(", ")}
- Buttons needing text: ${t.accessibility.buttonDetails.filter(e=>!e.hasText).map(e=>e.type||"button").join(", ")}
- Inputs without labels: ${t.accessibility.inputDetails.filter(e=>!e.hasLabel).map(e=>`${e.type} (${e.name||e.id||"unnamed"})`).join(", ")}

PERFORMANCE DATA:
- Load time: ${t.performance.loadTime}ms
- DOM content loaded: ${t.performance.domContentLoaded}ms
- First paint: ${t.performance.firstPaint}ms
- First contentful paint: ${t.performance.firstContentfulPaint}ms

VIEWPORT DATA:
- Width: ${t.viewport.width}px
- Height: ${t.viewport.height}px
- Scroll width: ${t.viewport.scrollWidth}px
- Scroll height: ${t.viewport.scrollHeight}px

HTML STRUCTURE (first 50000 characters):
${t.html.substring(0,5e4)}

Provide a comprehensive UX analysis focusing on accessibility, performance, usability, and design. Consider both desktop and mobile experiences.

IMPORTANT: Be extremely specific in your feedback. Instead of saying "some areas have low contrast", identify exactly which elements, what the colors are, and what the contrast ratio is.`;try{let i;if(!p)throw Error("Azure OpenAI client is not initialized - missing environment variables");console.log("\uD83E\uDD16 Sending request to Azure OpenAI..."),console.log("Model:",process.env.AZURE_OPENAI_DEPLOYMENT_NAME||"gpt-4o"),console.log("URL being analyzed:",e);let a=await p.chat.completions.create({model:process.env.AZURE_OPENAI_DEPLOYMENT_NAME||"gpt-4o",messages:[{role:"system",content:r},{role:"user",content:n}],temperature:.2,max_tokens:8e3});console.log(" Received response from Azure OpenAI");let o=a.choices[0]?.message?.content;if(!o)throw console.error(" No response content from AI model"),Error("No response from AI model");console.log("\uD83D\uDCDD Response length:",o.length),console.log("\uD83D\uDCDD Response preview:",o.substring(0,200)+"...");try{console.log("\uD83D\uDD0D Attempting to parse JSON response...");let e=o.match(/\{[\s\S]*\}/);if(e?(console.log("\uD83D\uDCCB Found JSON match, parsing..."),i=JSON.parse(e[0])):(console.log("\uD83D\uDCCB No JSON match found, trying to parse entire response..."),i=JSON.parse(o)),console.log(" JSON parsing successful"),i.error)throw console.error(" AI returned error response:",i.error),Error(`AI cannot analyze this website: ${i.message||i.error}`)}catch(e){if(console.error(" Failed to parse AI response:",e),console.error("\uD83D\uDCDD Raw response:",o),o.toLowerCase().includes("unfortunately")||o.toLowerCase().includes("cannot")||o.toLowerCase().includes("unable")||o.toLowerCase().includes("sorry"))throw Error(`AI cannot analyze this website: ${o.substring(0,100)}...`);throw Error(`Invalid AI response format: ${e instanceof Error?e.message:"Unknown parsing error"}`)}let l={url:e,score:Math.min(100,Math.max(0,i.score||70)),strengths:i.strengths||[],improvements:i.improvements||[],recommendations:i.recommendations||[],screenshots:s,timestamp:new Date().toISOString(),details:{accessibility:{score:Math.min(100,Math.max(0,i.details?.accessibility?.score||70)),issues:h(i.details?.accessibility?.issues||[],"accessibility")},performance:{score:Math.min(100,Math.max(0,i.details?.performance?.score||70)),issues:h(i.details?.performance?.issues||[],"performance")},usability:{score:Math.min(100,Math.max(0,i.details?.usability?.score||70)),issues:h(i.details?.usability?.issues||[],"usability")},design:{score:Math.min(100,Math.max(0,i.details?.design?.score||70)),issues:h(i.details?.design?.issues||[],"design")}},metadata:{pageTitle:i.metadata?.pageTitle||t.metadata.title,loadTime:i.metadata?.loadTime||t.performance.loadTime,pageSize:i.metadata?.pageSize||Math.round(t.html.length/1024),technologies:i.metadata?.technologies||[]}};return console.log(" AI analysis completed successfully"),l}catch(e){throw console.error(" Enhanced AI analysis failed:",e),console.error("Stack trace:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),Error(`AI analysis failed: ${e instanceof Error?e.message:"Unknown error"}`)}}function h(e,t){return e.map(e=>(f++,{id:e.id||`issue-${f}`,title:e.title||"Unspecified Issue",description:e.description||"No description provided",severity:["low","medium","high","critical"].includes(e.severity)?e.severity:"medium",category:t,location:e.location||{},impact:e.impact||"Impact not specified",recommendation:e.recommendation||"No recommendation provided",codeExample:e.codeExample||void 0}))}function d(e,t){return{url:e,score:Math.floor(40*Math.random())+60,timestamp:new Date().toISOString(),fallbackReason:t||void 0,strengths:["Clean and modern design aesthetic","Good use of white space and typography","Responsive design works well on mobile devices","Clear navigation structure","Fast loading times"],improvements:["Call-to-action buttons could be more prominent","Color contrast could be improved for better accessibility","Some pages lack clear user guidance","Contact information could be more accessible","Loading states could provide better user feedback"],recommendations:["Implement A/B testing for key conversion elements","Add more interactive elements to increase engagement","Consider adding a chatbot for immediate user support","Optimize images for faster loading","Add breadcrumb navigation for better user orientation"],details:{accessibility:{score:Math.floor(30*Math.random())+70,issues:[{id:"accessibility-contrast-1",title:"Low contrast text in navigation menu",description:"White text (#FFFFFF) on light gray background (#F0F0F0) has insufficient contrast ratio of 2.1:1",severity:"high",category:"accessibility",location:{element:"navigation menu",page:"homepage"},impact:"Users with visual impairments cannot read the navigation text",recommendation:"Change background color to darker gray (#666666) for 4.5:1 contrast ratio"},{id:"accessibility-alt-1",title:"Missing alt text on hero image",description:"Hero banner image 'hero-banner.jpg' lacks descriptive alt text",severity:"medium",category:"accessibility",location:{element:"hero image",page:"homepage"},impact:"Screen reader users cannot understand the image content",recommendation:"Add descriptive alt text: 'alt=\"Company team working together in modern office\"'"}]},performance:{score:Math.floor(25*Math.random())+75,issues:[{id:"performance-images-1",title:"Large unoptimized hero image",description:"Hero image 'hero-banner.jpg' is 2.3MB and not optimized for web",severity:"medium",category:"performance",location:{element:"hero image",page:"homepage"},impact:"Slow page load times, especially on mobile devices",recommendation:"Compress image to under 200KB and use WebP format"},{id:"performance-css-1",title:"Unoptimized CSS delivery",description:"CSS is loaded synchronously and blocks rendering",severity:"low",category:"performance",location:{element:"stylesheet",page:"all"},impact:"Delays visual rendering of the page",recommendation:"Use critical CSS inlining and async loading for non-critical styles"}]},usability:{score:Math.floor(35*Math.random())+65,issues:[{id:"usability-nav-1",title:"Complex navigation structure",description:"Navigation has 3 levels deep with unclear hierarchy",severity:"medium",category:"usability",location:{element:"main navigation",page:"all"},impact:"Users struggle to find desired content quickly",recommendation:"Simplify to 2 levels maximum and add breadcrumbs"},{id:"usability-flow-1",title:"Unclear user flow on homepage",description:"No clear call-to-action or next steps for visitors",severity:"high",category:"usability",location:{element:"homepage content",page:"homepage"},impact:"High bounce rate as users don't know what to do next",recommendation:"Add prominent CTA button and clear value proposition"}]},design:{score:Math.floor(20*Math.random())+80,issues:[{id:"design-spacing-1",title:"Inconsistent spacing between sections",description:"Sections have varying margins (20px, 40px, 30px) instead of consistent spacing",severity:"low",category:"design",location:{element:"page sections",page:"all"},impact:"Visual inconsistency creates poor user experience",recommendation:"Use consistent 32px spacing between all sections"},{id:"design-mobile-1",title:"Poor mobile layout for contact form",description:"Contact form fields are too small (height: 32px) on mobile devices",severity:"medium",category:"design",location:{element:"contact form",page:"contact"},impact:"Difficult to tap and interact with form elements",recommendation:"Increase form field height to 44px minimum for mobile"}]}},metadata:{pageTitle:"Sample Website",loadTime:2500,pageSize:1200,technologies:["React","Next.js","Tailwind CSS"]}}}process.env.AZURE_OPENAI_API_KEY&&process.env.AZURE_OPENAI_ENDPOINT&&process.env.AZURE_OPENAI_DEPLOYMENT_NAME&&(p=new n.Ay({apiKey:process.env.AZURE_OPENAI_API_KEY,baseURL:`${process.env.AZURE_OPENAI_ENDPOINT}/openai/deployments/${process.env.AZURE_OPENAI_DEPLOYMENT_NAME}`,defaultQuery:{"api-version":process.env.AZURE_OPENAI_API_VERSION||"2024-02-15-preview"},defaultHeaders:{"api-key":process.env.AZURE_OPENAI_API_KEY}})),r()}catch(e){r(e)}})},8794:(e,t,s)=>{"undefined"==typeof process||"renderer"===process.type||process.__nwjs?e.exports=s(5946):e.exports=s(6300)},8848:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{patchFetch:()=>c,routeModule:()=>u,serverHooks:()=>f,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>d});var n=s(6559),i=s(8088),a=s(7719),o=s(6382),l=e([o]);o=(l.then?(await l)():l)[0];let u=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/analyze-website/route",pathname:"/api/analyze-website",filename:"route",bundlePath:"app/api/analyze-website/route"},resolvedPagePath:"/Users/rolfbekkelund/Documents/Juvo Solutions/Repositories/UX-finall/UX-final/src/app/api/analyze-website/route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:h,workUnitAsyncStorage:d,serverHooks:f}=u;function c(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:d})}r()}catch(e){r(e)}})},8856:e=>{"use strict";e.exports=import("puppeteer-core")},9021:e=>{"use strict";e.exports=require("fs")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9370:(e,t,s)=>{let r=s(1704),n=s(2794);e.exports=class{constructor(e="utf8"){switch(this.encoding=function(e){switch(e=e.toLowerCase()){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:throw Error("Unknown encoding: "+e)}}(e),this.encoding){case"utf8":this.decoder=new n;break;case"utf16le":case"base64":throw Error("Unsupported encoding: "+this.encoding);default:this.decoder=new r(this.encoding)}}get remaining(){return this.decoder.remaining}push(e){return"string"==typeof e?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush()}}},9551:e=>{"use strict";e.exports=require("url")},9629:(e,t,s)=>{let r=s(2754),n=s(4686),i=s(9021),a=s(3873),o=(global.Bare?global.Bare.platform:process.platform)==="win32";function l(){}function c(e){return e}t.o=function(e,t){e||(e="."),t||(t={}),e=a.resolve(e);let s=t.fs||i,u=t.ignore||t.filter||l,h=t.mapStream||c,d=!1!==t.chown&&!o&&0===(!global.Bare&&process.getuid?process.getuid():-1),f=t.extract||r.extract(),p=[],m=new Date,g="number"==typeof t.umask?~t.umask:~(!global.Bare&&process.umask?process.umask():0),_=!1!==t.strict,y=!1!==t.validateSymlinks,b=t.map||l,w="number"==typeof t.dmode?t.dmode:0,v="number"==typeof t.fmode?t.fmode:0;return t.strip&&(b=function(e,t){return function(s){s.name=s.name.split("/").slice(t).join("/");let r=s.linkname;return r&&("link"===s.type||a.isAbsolute(r))&&(s.linkname=r.split("/").slice(t).join("/")),e(s)}}(b,t.strip)),t.readable&&(w|=parseInt(555,8),v|=parseInt(444,8)),t.writable&&(w|=parseInt(333,8),v|=parseInt(222,8)),f.on("entry",function(r,l,c){(r=b(r)||r).name=function(e){return o?e.replace(/\\/g,"/").replace(/[:?<>|]/g,"_"):e}(r.name);let f=a.join(e,a.join("/",r.name));if(u(f,r))return l.resume(),c();let g=a.join(f,".")===a.join(e,".")?e:a.dirname(f);function w(e){var n,i,a;if(e)return c(e);n=f,i=r,a=function(e){return e?c(e):o?c():void S(f,r,c)},!1===t.utimes?a():"directory"===i.type?s.utimes(n,m,i.mtime,a):"symlink"===i.type?x(n,a):s.utimes(n,m,i.mtime,function(e){if(e)return a(e);x(n,a)})}function v(t){return t.startsWith(e)}function A(){let e=s.createWriteStream(f),t=h(l,r);e.on("error",function(e){t.destroy(e)}),n(t,e,function(t){if(t)return c(t);e.on("close",w)})}(function e(t,s,r,n){if(s===r)return n(null,!0);t.lstat(s,function(i,o){return i&&"ENOENT"!==i.code&&"EPERM"!==i.code?n(i):i||o.isDirectory()?e(t,a.join(s,".."),r,n):void n(null,!1)})})(s,g,a.join(e,"."),function(n,u){return n?c(n):u?"directory"===r.type?(p.push([f,r.mtime]),k(f,{fs:s,own:d,uid:r.uid,gid:r.gid,mode:r.mode},w)):void k(g,{fs:s,own:d,uid:r.uid,gid:r.gid,mode:493},function(n){if(n)return c(n);switch(r.type){case"file":return A();case"link":return function(){if(o)return c();s.unlink(f,function(){let n=a.join(e,a.join("/",r.linkname));i.realpath(n,function(e,r){if(e||!v(r))return c(Error(f+" is not a valid hardlink"));s.link(r,f,function(e){if(e&&"EPERM"===e.code&&t.hardlinkAsFilesFallback)return l=s.createReadStream(r),A();w(e)})})})}();case"symlink":return function(){if(o)return c();s.unlink(f,function(){if(!v(a.resolve(a.dirname(f),r.linkname))&&y)return c(Error(f+" is not a valid symlink"));s.symlink(r.linkname,f,w)})}()}if(_)return c(Error("unsupported type for "+f+" ("+r.type+")"));l.resume(),c()}):c(Error(g+" is not a valid path"))})}),t.finish&&f.on("finish",t.finish),f;function x(e,t){let r;for(;(r=p.length?p[p.length-1]:null)&&e.slice(0,r[0].length)!==r[0];)p.pop();if(!r)return t();s.utimes(r[0],m,r[1],t)}function S(e,t,r){let n="symlink"===t.type,i=n?s.lchmod:s.chmod,a=n?s.lchown:s.chown;if(!i)return r();let o=(t.mode|("directory"===t.type?w:v))&g;function l(t){return t?r(t):i?void i.call(s,e,o,r):r()}a&&d?a.call(s,e,t.uid,t.gid,l):l(null)}function k(e,t,r){s.stat(e,function(n){return n?"ENOENT"!==n.code?r(n):void s.mkdir(e,{mode:t.mode,recursive:!0},function(s,n){if(s)return r(s);S(e,t,r)}):r(null)})}}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[447,580],()=>s(8848));module.exports=r})();